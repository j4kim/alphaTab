function $CombineDelegates(t,e){if(null==t)return e;if(null==e)return t;var n=$CreateMulticastDelegateFunction();if(n.delegates=[],t.isMulticastDelegate)for(a=0;a<t.delegates.length;a++)n.delegates.push(t.delegates[a]);else n.delegates.push(t);if(e.isMulticastDelegate)for(var a=0;a<e.delegates.length;a++)n.delegates.push(e.delegates[a]);else n.delegates.push(e);return n}function $CreateMulticastDelegateFunction(){var t=null,e=function(){for(var e=void 0,n=0;n<t.delegates.length;n++)e=t.delegates[n].apply(null,arguments);return e};return e.isMulticastDelegate=!0,t=e,e}function $RemoveDelegate(t,e){if(null==e||null==t)return t;if(t.isMulticastDelegate){if(e.isMulticastDelegate)throw new Error("Multicast to multicast delegate removal is not implemented yet");for(var n=$CreateMulticastDelegateFunction(),a=0;a<t.delegates.length;a++){var i=t.delegates[a];i!=e&&(null==n.delegates&&(n.delegates=[]),n.delegates.push(i))}return null==n.delegates?null:1==n.delegates.length?n.delegates[0]:n}if(e.isMulticastDelegate)throw new Error("single to multicast delegate removal is not supported");return t==e?null:t}var $StaticConstructors=[],$StaticConstructor=function(t){$StaticConstructors.push(t)};if(void 0===$Inherit)var $Inherit=function(t,e){if(void 0===Object.getOwnPropertyNames){for(var n in e.prototype)void 0!==t.prototype[n]&&t.prototype[n]!=Object.prototype[n]||(t.prototype[n]=e.prototype[n]);for(var n in e)void 0===t[n]&&(t[n]=e[n]);t.$baseCtor=e}else{for(var a=Object.getOwnPropertyNames(e.prototype),i=0;i<a.length;i++)void 0===Object.getOwnPropertyDescriptor(t.prototype,a[i])&&Object.defineProperty(t.prototype,a[i],Object.getOwnPropertyDescriptor(e.prototype,a[i]));for(var n in e)void 0===t[n]&&(t[n]=e[n]);t.$baseCtor=e}};if(void 0===$CreateException)var $CreateException=function(t,e){null==e&&(e=new Error),null==t&&(t=new System.Exception.ctor),e.message=t.message;for(var n in t)e[n]=t[n];return e};if(void 0===$CreateDelegate){if(void 0===$iKey)var $iKey=0;if(void 0===$pKey)var $pKey=String.fromCharCode(1);var $CreateDelegate=function(t,e){if(null==t||null==e)return e;if(e.target==t&&e.func==e)return e;null==t.$delegateCache&&(t.$delegateCache={}),null==e.$key&&(e.$key=$pKey+String(++$iKey));var n;return null!=t.$delegateCache&&(n=t.$delegateCache[e.$key]),null==n&&((n=function(){return e.apply(t,arguments)}).func=e,n.target=t,n.isDelegate=!0,null!=t.$delegateCache&&(t.$delegateCache[e.$key]=n)),n}}if(void 0===$CreateAnonymousDelegate)var $CreateAnonymousDelegate=function(t,e){if(null==t||null==e)return e;var n=function(){return e.apply(t,arguments)};return n.func=e,n.target=t,n.isDelegate=!0,n};var Int16Array=Int16Array||Array,Uint8Array=Uint8Array||Array,Int32Array=Int32Array||Array,Float32Array=Float32Array||Array,AlphaSynth=AlphaSynth||{};AlphaSynth.Main=AlphaSynth.Main||{},AlphaSynth.Main.AlphaSynthApi=function(){},AlphaSynth.Main.AlphaSynthApi.Create=function(t){var e=!!window.ScriptProcessorNode,n=!!window.Worker,a=!!window.ForceFlash;if(null!=t&&0!=t.length){if(t.lastIndexOf(".js")!=t.length-".js".length&&(t.lastIndexOf("/")!=t.length-"/".length&&(t+="/"),t+="AlphaSynth.js"),0==!t.indexOf("http")&&0==!t.indexOf("https")){var i=new Array;i.push(window.location.protocol),i.push("//"),i.push(window.location.hostname),window.location.port&&(i.push(":"),i.push(window.location.port)),i.push(t),t=i.join("")}}else t=AlphaSynth.Platform.Platform.ScriptFile;if(e&&!a)return AlphaSynth.Util.Logger.Info("Will use webworkers for synthesizing and web audio api for playback"),new AlphaSynth.Main.AlphaSynthWebWorkerApi(new AlphaSynth.Main.AlphaSynthWebAudioOutput,t);if(n)return AlphaSynth.Util.Logger.Info("Will use webworkers for synthesizing and flash for playback"),new AlphaSynth.Main.AlphaSynthWebWorkerApi(new AlphaSynth.Main.AlphaSynthFlashOutput(t),t);throw AlphaSynth.Util.Logger.Error("Incompatible browser"),$CreateException(new System.Exception.ctor$$String("Incompatible browser"),new Error)},AlphaSynth.Main.AlphaSynthFlashOutput=function(t){this._alphaSynthRoot=null,this._id=null,this._swfId=null,this._swfContainer=null,this._playbackSpeed=0,this.Ready=null,this.SampleRequest=null,this.Finished=null,this.SamplesPlayed=null,this._alphaSynthRoot=t;var e=this._alphaSynthRoot.lastIndexOf("/");-1!=e&&(this._alphaSynthRoot=this._alphaSynthRoot.substr(0,e+1))},AlphaSynth.Main.AlphaSynthFlashOutput.prototype={get_SampleRate:function(){return 44100},Open:function(){this._playbackSpeed=1,this._id="alphaSynthFlashPlayer"+AlphaSynth.Main.AlphaSynthFlashOutput.NextId,this._swfId=this._id+"swf",AlphaSynth.Main.AlphaSynthFlashOutput.Lookup[this._id]=this,AlphaSynth.Main.AlphaSynthFlashOutput.NextId++,this._swfContainer=document.createElement("div"),this._swfContainer.className="alphaSynthFlashPlayer",this._swfContainer.setAttribute("id",this._id),document.body.appendChild(this._swfContainer),(0,swfobject.embedSWF)(this._alphaSynthRoot+"AlphaSynth.FlashOutput.swf",this._id,"1px","1px","9.0.0",null,{id:this._id,sampleRate:44100},{allowScriptAccess:"always"},{id:this._swfId})},Play:function(){document.getElementById(this._swfId).AlphaSynthPlay()},Pause:function(){document.getElementById(this._swfId).AlphaSynthPause()},SequencerFinished:function(){document.getElementById(this._swfId).AlphaSynthSequencerFinished()},AddSamples:function(t){var e=new Uint8Array(t.buffer),n=String.fromCharCode,a=window.btoa(n.apply(null,e));document.getElementById(this._swfId).AlphaSynthAddSamples(a)},ResetSamples:function(){document.getElementById(this._swfId).AlphaSynthResetSamples()},add_Ready:function(t){this.Ready=$CombineDelegates(this.Ready,t)},remove_Ready:function(t){this.Ready=$RemoveDelegate(this.Ready,t)},add_SampleRequest:function(t){this.SampleRequest=$CombineDelegates(this.SampleRequest,t)},remove_SampleRequest:function(t){this.SampleRequest=$RemoveDelegate(this.SampleRequest,t)},add_Finished:function(t){this.Finished=$CombineDelegates(this.Finished,t)},remove_Finished:function(t){this.Finished=$RemoveDelegate(this.Finished,t)},add_SamplesPlayed:function(t){this.SamplesPlayed=$CombineDelegates(this.SamplesPlayed,t)},remove_SamplesPlayed:function(t){this.SamplesPlayed=$RemoveDelegate(this.SamplesPlayed,t)}},$StaticConstructor(function(){AlphaSynth.Main.AlphaSynthFlashOutput.PreferredSampleRate=44100,AlphaSynth.Main.AlphaSynthFlashOutput.Id="alphaSynthFlashPlayer",AlphaSynth.Main.AlphaSynthFlashOutput.Lookup=null,AlphaSynth.Main.AlphaSynthFlashOutput.NextId=0,AlphaSynth.Main.AlphaSynthFlashOutput.Lookup={}}),AlphaSynth.Main.AlphaSynthFlashOutput.OnReady=function(t){AlphaSynth.Main.AlphaSynthFlashOutput.Lookup.hasOwnProperty(t)&&AlphaSynth.Main.AlphaSynthFlashOutput.Lookup[t].Ready()},AlphaSynth.Main.AlphaSynthFlashOutput.OnSampleRequest=function(t){AlphaSynth.Main.AlphaSynthFlashOutput.Lookup.hasOwnProperty(t)&&AlphaSynth.Main.AlphaSynthFlashOutput.Lookup[t].SampleRequest()},AlphaSynth.Main.AlphaSynthFlashOutput.OnFinished=function(t){AlphaSynth.Main.AlphaSynthFlashOutput.Lookup.hasOwnProperty(t)&&null!=AlphaSynth.Main.AlphaSynthFlashOutput.Lookup[t].Finished&&AlphaSynth.Main.AlphaSynthFlashOutput.Lookup[t].Finished()},AlphaSynth.Main.AlphaSynthFlashOutput.OnSamplesPlayed=function(t,e){AlphaSynth.Main.AlphaSynthFlashOutput.Lookup.hasOwnProperty(t)&&AlphaSynth.Main.AlphaSynthFlashOutput.Lookup[t].SamplesPlayed(e)},AlphaSynth.Main.AlphaSynthWebAudioOutput=function(){this._context=null,this._buffer=null,this._source=null,this._audioNode=null,this._circularBuffer=null,this._finished=!1,this.Ready=null,this.SamplesPlayed=null,this.SampleRequest=null,this.Finished=null},AlphaSynth.Main.AlphaSynthWebAudioOutput.prototype={get_SampleRate:function(){return 0|this._context.sampleRate},Open:function(){this._finished=!1,this._circularBuffer=new AlphaSynth.Ds.CircularSampleBuffer(40960),window.AudioContext=window.AudioContext||window.webkitAudioContext,this._context=new AudioContext;var t=this._context;if("suspended"==t.state){var e=null;e=$CreateAnonymousDelegate(this,function(n){t.resume(),window.setTimeout($CreateAnonymousDelegate(this,function(){"running"==t.state&&document.body.removeEventListener("touchend",e,!1)}),0)}),document.body.addEventListener("touchend",e,!1)}this._buffer=this._context.createBuffer(2,4096,this._context.sampleRate),this._audioNode=this._context.createScriptProcessor(4096,0,2),this._audioNode.onaudioprocess=$CreateDelegate(this,this.GenerateSound),this.Ready()},Play:function(){this.RequestBuffers(),this._finished=!1,this._source=this._context.createBufferSource(),this._source.buffer=this._buffer,this._source.loop=!0,this._source.connect(this._audioNode,0,0),this._source.start(0),this._audioNode.connect(this._context.destination,0,0)},Pause:function(){null!=this._source&&(this._source.stop(0),this._source.disconnect(0)),this._source=null,this._audioNode.disconnect(0)},SequencerFinished:function(){this._finished=!0},AddSamples:function(t){this._circularBuffer.Write(t,0,t.length)},ResetSamples:function(){this._circularBuffer.Clear()},RequestBuffers:function(){if(this._circularBuffer.get_Count()<20480&&null!=this.SampleRequest)for(var t=0;t<5;t++)this.SampleRequest()},GenerateSound:function(t){var e=t,n=e.outputBuffer.getChannelData(0),a=e.outputBuffer.getChannelData(1),i=n.length+a.length;if(this._circularBuffer.get_Count()<i)this._finished&&this.Finished();else{var h=new Float32Array(i);this._circularBuffer.Read(h,0,h.length);for(var s=0,o=0;o<n.length;o++)n[o]=h[s++],a[o]=h[s++];this.SamplesPlayed(n.length)}this._finished||this.RequestBuffers()},add_Ready:function(t){this.Ready=$CombineDelegates(this.Ready,t)},remove_Ready:function(t){this.Ready=$RemoveDelegate(this.Ready,t)},add_SamplesPlayed:function(t){this.SamplesPlayed=$CombineDelegates(this.SamplesPlayed,t)},remove_SamplesPlayed:function(t){this.SamplesPlayed=$RemoveDelegate(this.SamplesPlayed,t)},add_SampleRequest:function(t){this.SampleRequest=$CombineDelegates(this.SampleRequest,t)},remove_SampleRequest:function(t){this.SampleRequest=$RemoveDelegate(this.SampleRequest,t)},add_Finished:function(t){this.Finished=$CombineDelegates(this.Finished,t)},remove_Finished:function(t){this.Finished=$RemoveDelegate(this.Finished,t)}},$StaticConstructor(function(){AlphaSynth.Main.AlphaSynthWebAudioOutput.BufferSize=4096,AlphaSynth.Main.AlphaSynthWebAudioOutput.BufferCount=10}),AlphaSynth.Main.AlphaSynthWebWorker=function(t){this._player=null,this._main=null,this._main=t,this._main.addEventListener("message",$CreateDelegate(this,this.HandleMessage),!1),this._player=new AlphaSynth.AlphaSynth,this._player.add_PositionChanged($CreateDelegate(this,this.OnPositionChanged)),this._player.add_PlayerStateChanged($CreateDelegate(this,this.OnPlayerStateChanged)),this._player.add_Finished($CreateDelegate(this,this.OnFinished)),this._player.add_SoundFontLoaded($CreateDelegate(this,this.OnSoundFontLoaded)),this._player.add_SoundFontLoadFailed($CreateDelegate(this,this.OnSoundFontLoadFailed)),this._player.add_SoundFontLoadFailed($CreateDelegate(this,this.OnSoundFontLoadFailed)),this._player.add_MidiLoaded($CreateDelegate(this,this.OnMidiLoaded)),this._player.add_MidiLoadFailed($CreateDelegate(this,this.OnMidiLoadFailed)),this._player.add_ReadyForPlayback($CreateDelegate(this,this.OnReadyForPlayback)),this._main.postMessage({cmd:"alphaSynth.ready"})},AlphaSynth.Main.AlphaSynthWebWorker.prototype={HandleMessage:function(t){var e=t.data;switch(e.cmd){case"alphaSynth.setLogLevel":AlphaSynth.Util.Logger.LogLevel=e.value;break;case"alphaSynth.setMasterVolume":this._player.set_MasterVolume(e.value);break;case"alphaSynth.setMetronomeVolume":this._player.set_MetronomeVolume(e.value);break;case"alphaSynth.setPlaybackSpeed":this._player.set_PlaybackSpeed(e.value);break;case"alphaSynth.setTickPosition":this._player.set_TickPosition(e.value);break;case"alphaSynth.setTimePosition":this._player.set_TimePosition(e.value);break;case"alphaSynth.setPlaybackRange":this._player.set_PlaybackRange(e.value);break;case"alphaSynth.setIsLooping":this._player.set_IsLooping(e.value);break;case"alphaSynth.play":this._player.Play();break;case"alphaSynth.pause":this._player.Pause();break;case"alphaSynth.playPause":this._player.PlayPause();break;case"alphaSynth.stop":this._player.Stop();break;case"alphaSynth.loadSoundFontBytes":this._player.LoadSoundFont(e.data);break;case"alphaSynth.loadMidiBytes":this._player.LoadMidi(e.data);break;case"alphaSynth.setChannelMute":this._player.SetChannelMute(e.channel,e.mute);break;case"alphaSynth.setChannelSolo":this._player.SetChannelSolo(e.channel,e.solo);break;case"alphaSynth.setChannelVolume":this._player.SetChannelVolume(e.channel,e.volume);break;case"alphaSynth.setChannelProgram":this._player.SetChannelProgram(e.channel,e.program);break;case"alphaSynth.resetChannelStates":this._player.ResetChannelStates();break;case"get_TempoChanges":this._main.postMessage({cmd:"returnTempoChanges",tempoChanges:this._player._sequencer._tempoChanges,endTime:this._player._sequencer._endTime})}},OnPositionChanged:function(t,e){this._main.postMessage({cmd:"alphaSynth.positionChanged",currentTime:e.CurrentTime,endTime:e.EndTime,currentTick:e.CurrentTick,endTick:e.EndTick})},OnPlayerStateChanged:function(t,e){this._main.postMessage({cmd:"alphaSynth.playerStateChanged",state:e.State})},OnFinished:function(t){this._main.postMessage({cmd:"alphaSynth.finished",isLooping:t})},OnSoundFontLoaded:function(t,e){this._main.postMessage({cmd:"alphaSynth.soundFontLoaded"})},OnSoundFontLoadFailed:function(t,e){this._main.postMessage({cmd:"alphaSynth.soundFontLoadFailed"})},OnMidiLoaded:function(t,e){this._main.postMessage({cmd:"alphaSynth.midiLoaded"})},OnMidiLoadFailed:function(t,e){this._main.postMessage({cmd:"alphaSynth.midiLoaded"})},OnReadyForPlayback:function(t,e){this._main.postMessage({cmd:"alphaSynth.readyForPlayback"})},SendLog:function(t,e){this._main.postMessage({cmd:"alphaSynth.log",level:t,message:e})}},$StaticConstructor(function(){if(AlphaSynth.Main.AlphaSynthWebWorker.CmdPrefix="alphaSynth.",AlphaSynth.Main.AlphaSynthWebWorker.CmdInitialize="alphaSynth.initialize",AlphaSynth.Main.AlphaSynthWebWorker.CmdSetLogLevel="alphaSynth.setLogLevel",AlphaSynth.Main.AlphaSynthWebWorker.CmdSetMasterVolume="alphaSynth.setMasterVolume",AlphaSynth.Main.AlphaSynthWebWorker.CmdSetMetronomeVolume="alphaSynth.setMetronomeVolume",AlphaSynth.Main.AlphaSynthWebWorker.CmdSetPlaybackSpeed="alphaSynth.setPlaybackSpeed",AlphaSynth.Main.AlphaSynthWebWorker.CmdSetTickPosition="alphaSynth.setTickPosition",AlphaSynth.Main.AlphaSynthWebWorker.CmdSetTimePosition="alphaSynth.setTimePosition",AlphaSynth.Main.AlphaSynthWebWorker.CmdSetPlaybackRange="alphaSynth.setPlaybackRange",AlphaSynth.Main.AlphaSynthWebWorker.CmdSetIsLooping="alphaSynth.setIsLooping",AlphaSynth.Main.AlphaSynthWebWorker.CmdPlay="alphaSynth.play",AlphaSynth.Main.AlphaSynthWebWorker.CmdPause="alphaSynth.pause",AlphaSynth.Main.AlphaSynthWebWorker.CmdPlayPause="alphaSynth.playPause",AlphaSynth.Main.AlphaSynthWebWorker.CmdStop="alphaSynth.stop",AlphaSynth.Main.AlphaSynthWebWorker.CmdLoadSoundFontBytes="alphaSynth.loadSoundFontBytes",AlphaSynth.Main.AlphaSynthWebWorker.CmdLoadMidiBytes="alphaSynth.loadMidiBytes",AlphaSynth.Main.AlphaSynthWebWorker.CmdSetChannelMute="alphaSynth.setChannelMute",AlphaSynth.Main.AlphaSynthWebWorker.CmdSetChannelSolo="alphaSynth.setChannelSolo",AlphaSynth.Main.AlphaSynthWebWorker.CmdSetChannelVolume="alphaSynth.setChannelVolume",AlphaSynth.Main.AlphaSynthWebWorker.CmdSetChannelProgram="alphaSynth.setChannelProgram",AlphaSynth.Main.AlphaSynthWebWorker.CmdResetChannelStates="alphaSynth.resetChannelStates",AlphaSynth.Main.AlphaSynthWebWorker.CmdReady="alphaSynth.ready",AlphaSynth.Main.AlphaSynthWebWorker.CmdReadyForPlayback="alphaSynth.readyForPlayback",AlphaSynth.Main.AlphaSynthWebWorker.CmdPositionChanged="alphaSynth.positionChanged",AlphaSynth.Main.AlphaSynthWebWorker.CmdPlayerStateChanged="alphaSynth.playerStateChanged",AlphaSynth.Main.AlphaSynthWebWorker.CmdFinished="alphaSynth.finished",AlphaSynth.Main.AlphaSynthWebWorker.CmdSoundFontLoaded="alphaSynth.soundFontLoaded",AlphaSynth.Main.AlphaSynthWebWorker.CmdSoundFontLoadFailed="alphaSynth.soundFontLoadFailed",AlphaSynth.Main.AlphaSynthWebWorker.CmdMidiLoaded="alphaSynth.midiLoaded",AlphaSynth.Main.AlphaSynthWebWorker.CmdMidiLoadFailed="alphaSynth.midiLoadFailed",AlphaSynth.Main.AlphaSynthWebWorker.CmdLog="alphaSynth.log",!self.document){var t=self;t.addEventListener("message",function(e){var n=e.data;switch(n.cmd){case"alphaSynth.initialize":AlphaSynth.Player.WebWorkerOutput.PreferredSampleRate=n.sampleRate,new AlphaSynth.Main.AlphaSynthWebWorker(t)}},!1)}}),AlphaSynth.Main.AlphaSynthWebWorkerApi=function(t,e){this._synth=null,this._output=null,this._events=null,this._workerIsReadyForPlayback=!1,this._workerIsReady=!1,this._outputIsReady=!1,this._state=AlphaSynth.PlayerState.Paused,this._logLevel=AlphaSynth.Util.LogLevel.None,this._masterVolume=0,this._metronomeVolume=0,this._playbackSpeed=0,this._isSoundFontLoaded=!1,this._isMidiLoaded=!1,this._tickPosition=0,this._timePosition=0,this._isLooping=!1,this._playbackRange=null,this._output=t,this._output.add_Ready($CreateDelegate(this,this.OnOutputReady)),this._output.add_SamplesPlayed($CreateDelegate(this,this.OnOutputSamplesPlayed)),this._output.add_SampleRequest($CreateDelegate(this,this.OnOutputSampleRequest)),this._output.add_Finished($CreateDelegate(this,this.OnOutputFinished)),this._events={},this._output.Open();try{this._synth=new Worker(e)}catch(t){try{var n="importScripts('"+e+"')",a=new Blob([n]);this._synth=new Worker(window.URL.createObjectURL(a))}catch(t){AlphaSynth.Util.Logger.Error("Failed to create WebWorker: "+t)}}this._synth.addEventListener("message",$CreateDelegate(this,this.HandleWorkerMessage),!1),this._synth.postMessage({cmd:"alphaSynth.initialize",sampleRate:this._output.get_SampleRate()}),this.set_MasterVolume(1),this.set_PlaybackSpeed(1),this.set_MetronomeVolume(0)},AlphaSynth.Main.AlphaSynthWebWorkerApi.prototype={get_IsReady:function(){return this._workerIsReady&&this._outputIsReady},get_IsReadyForPlayback:function(){return this._workerIsReadyForPlayback},get_State:function(){return this._state},get_LogLevel:function(){return AlphaSynth.Util.Logger.LogLevel},set_LogLevel:function(t){AlphaSynth.Util.Logger.LogLevel=t,this._synth.postMessage({cmd:"alphaSynth.setLogLevel",value:t})},get_MasterVolume:function(){return this._masterVolume},set_MasterVolume:function(t){t=AlphaSynth.Synthesis.SynthHelper.ClampF(t,0,10),this._masterVolume=t,this._synth.postMessage({cmd:"alphaSynth.setMasterVolume",value:t})},get_MetronomeVolume:function(){return this._metronomeVolume},set_MetronomeVolume:function(t){t=AlphaSynth.Synthesis.SynthHelper.ClampF(t,0,10),this._metronomeVolume=t,this._synth.postMessage({cmd:"alphaSynth.setMetronomeVolume",value:t})},get_PlaybackSpeed:function(){return this._playbackSpeed},set_PlaybackSpeed:function(t){t=AlphaSynth.Synthesis.SynthHelper.ClampD(t,.125,8),this._playbackSpeed=t,this._synth.postMessage({cmd:"alphaSynth.setPlaybackSpeed",value:t})},get_TickPosition:function(){return this._tickPosition},set_TickPosition:function(t){t<0&&(t=0),this._tickPosition=t,this._synth.postMessage({cmd:"alphaSynth.setTickPosition",value:t})},get_TimePosition:function(){return this._timePosition},set_TimePosition:function(t){t<0&&(t=0),this._timePosition=t,this._synth.postMessage({cmd:"alphaSynth.setTimePosition",value:t})},get_IsLooping:function(){return this._isLooping},set_IsLooping:function(t){this._isLooping=t,this._synth.postMessage({cmd:"alphaSynth.setIsLooping",value:t})},get_PlaybackRange:function(){return this._playbackRange},set_PlaybackRange:function(t){null!=t&&(t.StartTick<0&&(t.StartTick=0),t.EndTick<0&&(t.EndTick=0)),this._playbackRange=t,this._synth.postMessage({cmd:"alphaSynth.setPlaybackRange",value:t})},Play:function(){this._synth.postMessage({cmd:"alphaSynth.play"})},Pause:function(){this._synth.postMessage({cmd:"alphaSynth.pause"})},PlayPause:function(){this._synth.postMessage({cmd:"alphaSynth.playPause"})},Stop:function(){this._synth.postMessage({cmd:"alphaSynth.stop"})},LoadSoundFont:function(t){if("string"==typeof t){var e=t;AlphaSynth.Util.Logger.Info("Start loading Soundfont from url "+e);var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=$CreateAnonymousDelegate(this,function(t){var e=new Uint8Array(n.response);this._synth.postMessage({cmd:"alphaSynth.loadSoundFontBytes",data:e})}),n.onerror=$CreateAnonymousDelegate(this,function(t){AlphaSynth.Util.Logger.Error("Loading failed: "+t.message),this.TriggerEvent("soundFontLoadFailed",null)}),n.onprogress=$CreateAnonymousDelegate(this,function(t){AlphaSynth.Util.Logger.Debug("Soundfont downloading: "+t.loaded+"/"+t.total+" bytes"),this.TriggerEvent("soundFontLoad",[{loaded:t.loaded,total:t.total}])}),n.send()}else this._synth.postMessage({cmd:"alphaSynth.loadSoundFontBytes",data:t})},LoadMidi:function(t){if("string"==typeof t){var e=t;AlphaSynth.Util.Logger.Info("Start loading midi from url "+e);var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=$CreateAnonymousDelegate(this,function(t){var e=new Uint8Array(n.response);this._synth.postMessage({cmd:"alphaSynth.loadMidiBytes",data:e})}),n.onerror=$CreateAnonymousDelegate(this,function(t){AlphaSynth.Util.Logger.Error("Loading failed: "+t.message),this.TriggerEvent("midiLoadFailed",null)}),n.onprogress=$CreateAnonymousDelegate(this,function(t){AlphaSynth.Util.Logger.Debug("Midi downloading: "+t.loaded+"/"+t.total+" bytes"),this.TriggerEvent("midiLoad",[{loaded:t.loaded,total:t.total}])}),n.send()}else this._synth.postMessage({cmd:"alphaSynth.loadMidiBytes",data:t})},SetChannelMute:function(t,e){this._synth.postMessage({cmd:"alphaSynth.setChannelMute",channel:t,mute:e})},ResetChannelStates:function(){this._synth.postMessage({cmd:"alphaSynth.resetChannelStates"})},SetChannelSolo:function(t,e){this._synth.postMessage({cmd:"alphaSynth.setChannelSolo",channel:t,solo:e})},SetChannelVolume:function(t,e){e=AlphaSynth.Synthesis.SynthHelper.ClampD(e,0,10),this._synth.postMessage({cmd:"alphaSynth.setChannelVolume",channel:t,volume:e})},SetChannelProgram:function(t,e){e=AlphaSynth.Synthesis.SynthHelper.ClampB(e,0,127),this._synth.postMessage({cmd:"alphaSynth.setChannelProgram",channel:t,program:e})},get_TempoChanges:function(){this._synth.postMessage({cmd:"get_TempoChanges"})},HandleWorkerMessage:function(t){var e=t.data;switch(e.cmd){case"returnTempoChanges":this.TriggerEvent("tempoChanges",[e]);break;case"alphaSynth.ready":this._workerIsReady=!0,this.CheckReady();break;case"alphaSynth.readyForPlayback":this._workerIsReadyForPlayback=!0,this.CheckReadyForPlayback();break;case"alphaSynth.positionChanged":this._timePosition=e.currentTime,this._tickPosition=e.currentTick,this.TriggerEvent("positionChanged",[e]);break;case"alphaSynth.playerStateChanged":this._state=e.state,this.TriggerEvent("playerStateChanged",[e]);break;case"alphaSynth.finished":this.TriggerEvent("finished",null);break;case"alphaSynth.soundFontLoaded":this.TriggerEvent("soundFontLoaded",null);break;case"alphaSynth.soundFontLoadFailed":this.TriggerEvent("soundFontLoadFailed",null);break;case"alphaSynth.midiLoaded":this._isMidiLoaded=!0,this.CheckReadyForPlayback(),this.TriggerEvent("midiFileLoaded",null);break;case"alphaSynth.midiLoadFailed":this._isSoundFontLoaded=!0,this.CheckReadyForPlayback(),this.TriggerEvent("midiFileLoadFailed",null);break;case"alphaSynth.log":AlphaSynth.Util.Logger.Log(e.level,e.message);break;case"alphaSynth.output.sequencerFinished":this._output.SequencerFinished();break;case"alphaSynth.output.addSamples":this._output.AddSamples(e.samples);break;case"alphaSynth.output.play":this._output.Play();break;case"alphaSynth.output.pause":this._output.Pause();break;case"alphaSynth.output.resetSamples":this._output.ResetSamples()}},CheckReady:function(){this.get_IsReady()&&this.TriggerEvent("ready",null)},CheckReadyForPlayback:function(){this.get_IsReadyForPlayback()&&this.TriggerEvent("readyForPlayback",null)},On:function(t,e){this._events.hasOwnProperty(t)||(this._events[t]=[]),this._events[t].push(e)},TriggerEvent:function(t,e){var n=this._events[t];if(null!=n)for(var a=0;a<n.length;a++)n[a].apply(null,e)},OnOutputSampleRequest:function(){this._synth.postMessage({cmd:"alphaSynth.output.sampleRequest"})},OnOutputFinished:function(){this._synth.postMessage({cmd:"alphaSynth.output.finished"})},OnOutputSamplesPlayed:function(t){this._synth.postMessage({cmd:"alphaSynth.output.samplesPlayed",samples:t})},OnOutputReady:function(){this._outputIsReady=!0,this.CheckReady()}},AlphaSynth.Platform=AlphaSynth.Platform||{},AlphaSynth.Platform.Platform=function(){},AlphaSynth.Platform.Platform.CreateOutput=function(){return new AlphaSynth.Player.WebWorkerOutput},$StaticConstructor(function(){AlphaSynth.Platform.Platform.ScriptFile=null,AlphaSynth.Platform.Platform.PlatformInit()}),AlphaSynth.Platform.Platform.PlatformInit=function(){if(self.document){var t=document.currentScript;if(!t)try{var e=new Error,n=e.stack;if(!n)throw $CreateException(e,new Error);AlphaSynth.Platform.Platform.ScriptFile=AlphaSynth.Platform.Platform.ScriptFileFromStack(n)}catch(e){(n=e.stack)?AlphaSynth.Platform.Platform.ScriptFile=AlphaSynth.Platform.Platform.ScriptFileFromStack(n):t=document.querySelector("script[data-alphasynth]")}null!=AlphaSynth.Platform.Platform.ScriptFile&&0!=AlphaSynth.Platform.Platform.ScriptFile.length||(t?AlphaSynth.Platform.Platform.ScriptFile=t.src:console.warn("Could not automatically find alphaSynth script file for worker, please add the data-alphasynth attribute to the script tag that includes alphaSynth or provide it when initializing alphaSynth"))}},AlphaSynth.Platform.Platform.ScriptFileFromStack=function(t){var e=t.match("(data:text\\/javascript(?:;[^,]+)?,.+?|(?:|blob:)(?:http[s]?|file):\\/\\/[\\/]?.+?\\/[^:\\)]*?)(?::\\d+)(?::\\d+)?");return e||(e=t.match("^(?:|[^:@]*@|.+\\)@(?=data:text\\/javascript|blob|http[s]?|file)|.+?\\s+(?: at |@)(?:[^:\\(]+ )*[\\(]?)(data:text\\/javascript(?:;[^,]+)?,.+?|(?:|blob:)(?:http[s]?|file):\\/\\/[\\/]?.+?\\/[^:\\)]*?)(?::\\d+)(?::\\d+)?"))||(e=t.match("\\)@(data:text\\/javascript(?:;[^,]+)?,.+?|(?:|blob:)(?:http[s]?|file):\\/\\/[\\/]?.+?\\/[^:\\)]*?)(?::\\d+)(?::\\d+)?"))?e[1]:null},AlphaSynth.Platform.Std=function(){},$StaticConstructor(function(){AlphaSynth.Platform.Std.IsLittleEndian=!0}),AlphaSynth.Platform.Std.ParseInt=function(t){var e=parseInt(t);return isNaN(e)&&(e=0),e},AlphaSynth.Platform.Std.StringFromCharCode=function(t){return""},AlphaSynth.Platform.Std.Random=function(){return Math.random()},AlphaSynth.Platform.Std.BlockCopy=function(t,e,n,a,i){},AlphaSynth.Platform.Std.ArrayCopy=function(t,e,n,a,i){for(var h=0;h<i;h++)n[a+h]=t[e+h]},AlphaSynth.Platform.Std.Reverse=function(t){for(var e=0,n=t.length-1;e<n;){var a=t[e];t[e]=t[n],t[n]=a,e++,n--}},AlphaSynth.Platform.TypeUtils=function(){},$StaticConstructor(function(){AlphaSynth.Platform.TypeUtils.IsLittleEndian=!0,AlphaSynth.Platform.TypeUtils.Int16=new Int16Array(1)}),AlphaSynth.Platform.TypeUtils.ToUInt32=function(t){return 0|t},AlphaSynth.Platform.TypeUtils.ToInt16=function(t){return AlphaSynth.Platform.TypeUtils.Int16[0]=0|t,AlphaSynth.Platform.TypeUtils.Int16[0]},AlphaSynth.Platform.TypeUtils.ToUInt16=function(t){return 0|t},AlphaSynth.Platform.TypeUtils.ToUInt8=function(t){return t},AlphaSynth.Platform.TypeUtils.ClearIntArray=function(t){for(var e=0;e<t.length;e++)t[e]=0},AlphaSynth.Platform.TypeUtils.ClearShortArray=function(t){for(var e=0;e<t.length;e++)t[e]=0},AlphaSynth.Player=AlphaSynth.Player||{},AlphaSynth.Player.WebWorkerOutput=function(){this._worker=null,this.Ready=null,this.SamplesPlayed=null,this.SampleRequest=null,this.Finished=null},AlphaSynth.Player.WebWorkerOutput.prototype={get_SampleRate:function(){return AlphaSynth.Player.WebWorkerOutput.PreferredSampleRate},Open:function(){AlphaSynth.Util.Logger.Debug("Initializing webworker worker"),this._worker=self,this._worker.addEventListener("message",$CreateDelegate(this,this.HandleMessage),!1),this.Ready()},HandleMessage:function(t){var e=t.data;switch(e.cmd){case"alphaSynth.output.sampleRequest":this.SampleRequest();break;case"alphaSynth.output.finished":this.Finished();break;case"alphaSynth.output.samplesPlayed":this.SamplesPlayed(e.samples)}},add_Ready:function(t){this.Ready=$CombineDelegates(this.Ready,t)},remove_Ready:function(t){this.Ready=$RemoveDelegate(this.Ready,t)},add_SamplesPlayed:function(t){this.SamplesPlayed=$CombineDelegates(this.SamplesPlayed,t)},remove_SamplesPlayed:function(t){this.SamplesPlayed=$RemoveDelegate(this.SamplesPlayed,t)},add_SampleRequest:function(t){this.SampleRequest=$CombineDelegates(this.SampleRequest,t)},remove_SampleRequest:function(t){this.SampleRequest=$RemoveDelegate(this.SampleRequest,t)},add_Finished:function(t){this.Finished=$CombineDelegates(this.Finished,t)},remove_Finished:function(t){this.Finished=$RemoveDelegate(this.Finished,t)},SequencerFinished:function(){this._worker.postMessage({cmd:"alphaSynth.output.sequencerFinished"})},AddSamples:function(t){this._worker.postMessage({cmd:"alphaSynth.output.addSamples",samples:t})},Play:function(){this._worker.postMessage({cmd:"alphaSynth.output.play"})},Pause:function(){this._worker.postMessage({cmd:"alphaSynth.output.pause"})},ResetSamples:function(){this._worker.postMessage({cmd:"alphaSynth.output.resetSamples"})}},$StaticConstructor(function(){AlphaSynth.Player.WebWorkerOutput.CmdOutputPrefix="alphaSynth.output.",AlphaSynth.Player.WebWorkerOutput.CmdOutputSequencerFinished="alphaSynth.output.sequencerFinished",AlphaSynth.Player.WebWorkerOutput.CmdOutputAddSamples="alphaSynth.output.addSamples",AlphaSynth.Player.WebWorkerOutput.CmdOutputPlay="alphaSynth.output.play",AlphaSynth.Player.WebWorkerOutput.CmdOutputPause="alphaSynth.output.pause",AlphaSynth.Player.WebWorkerOutput.CmdOutputResetSamples="alphaSynth.output.resetSamples",AlphaSynth.Player.WebWorkerOutput.CmdOutputSampleRequest="alphaSynth.output.sampleRequest",AlphaSynth.Player.WebWorkerOutput.CmdOutputFinished="alphaSynth.output.finished",AlphaSynth.Player.WebWorkerOutput.CmdOutputSamplesPlayed="alphaSynth.output.samplesPlayed",AlphaSynth.Player.WebWorkerOutput.PreferredSampleRate=0}),AlphaSynth.Util=AlphaSynth.Util||{},AlphaSynth.Util.Extensions=function(){},AlphaSynth.Util.Logger=function(){},$StaticConstructor(function(){AlphaSynth.Util.Logger.LogLevel=AlphaSynth.Util.LogLevel.None,AlphaSynth.Util.Logger.LogHandler=null,AlphaSynth.Util.Logger.LogLevel=AlphaSynth.Util.LogLevel.Info,AlphaSynth.Util.Logger.LogHandler=function(t,e){switch(t){case AlphaSynth.Util.LogLevel.None:console.log(e);break;case AlphaSynth.Util.LogLevel.Debug:console.debug(e);break;case AlphaSynth.Util.LogLevel.Info:console.info(e);break;case AlphaSynth.Util.LogLevel.Warning:console.warn(e);break;case AlphaSynth.Util.LogLevel.Error:console.error(e)}}}),AlphaSynth.Util.Logger.Debug=function(t){AlphaSynth.Util.Logger.Log(AlphaSynth.Util.LogLevel.Debug,t)},AlphaSynth.Util.Logger.Warning=function(t){AlphaSynth.Util.Logger.Log(AlphaSynth.Util.LogLevel.Warning,t)},AlphaSynth.Util.Logger.Info=function(t){AlphaSynth.Util.Logger.Log(AlphaSynth.Util.LogLevel.Info,t)},AlphaSynth.Util.Logger.Error=function(t){AlphaSynth.Util.Logger.Log(AlphaSynth.Util.LogLevel.Error,t)},AlphaSynth.Util.Logger.Log=function(t,e){if(!(t<AlphaSynth.Util.Logger.LogLevel)){var n=arguments&&arguments.callee&&arguments.callee.caller&&arguments.callee.caller.caller?arguments.callee.caller.caller.name:"";null!=AlphaSynth.Util.Logger.LogHandler&&AlphaSynth.Util.Logger.LogHandler(t,n+"-"+e)}},AlphaSynth.Util.Logger.GetCaller=function(){return""},AlphaSynth.Util.LogLevel={None:0,Debug:1,Info:2,Warning:3,Error:4},AlphaSynth.AlphaSynth=function(){this._sequencer=null,this._synthesizer=null,this._outputIsReady=!1,this._state=AlphaSynth.PlayerState.Paused,this._logLevel=AlphaSynth.Util.LogLevel.None,this._isSoundFontLoaded=!1,this._isMidiLoaded=!1,this._tickPosition=0,this._timePosition=0,this.Finished=null,this.PlayerStateChanged=null,this.SoundFontLoaded=null,this.ReadyForPlayback=null,this.SoundFontLoadFailed=null,this.MidiLoaded=null,this.MidiLoadFailed=null,this.PositionChanged=null,this.Output=null,AlphaSynth.Util.Logger.Debug("Initializing player"),this._state=AlphaSynth.PlayerState.Paused,AlphaSynth.Util.Logger.Debug("Creating output"),this.Output=AlphaSynth.Platform.Platform.CreateOutput(),this.Output.add_Ready($CreateAnonymousDelegate(this,function(){this._outputIsReady=!0,this.CheckReadyForPlayback()})),this.Output.add_Finished($CreateAnonymousDelegate(this,function(){this.Stop(),AlphaSynth.Util.Logger.Debug("Finished playback"),this.OnFinished(this._sequencer.IsLooping),this._sequencer.IsLooping&&this.Play()})),this.Output.add_SampleRequest($CreateAnonymousDelegate(this,function(){this._sequencer.FillMidiEventQueue(),this._synthesizer.Synthesize(),this.Output.AddSamples(this._synthesizer.SampleBuffer),this._sequencer.CheckForStop()})),this.Output.add_SamplesPlayed($CreateDelegate(this,this.OnSamplesPlayed)),AlphaSynth.Util.Logger.Debug("Creating synthesizer"),this._synthesizer=new AlphaSynth.Synthesis.Synthesizer(this.Output.get_SampleRate(),2,441,3,100),this._sequencer=new AlphaSynth.MidiFileSequencer(this._synthesizer),this._sequencer.add_Finished($CreateDelegate(this.Output,this.Output.SequencerFinished)),AlphaSynth.Util.Logger.Debug("Opening output"),this.Output.Open()},AlphaSynth.AlphaSynth.prototype={get_IsReady:function(){return this._outputIsReady},get_IsReadyForPlayback:function(){return this.get_IsReady()&&this._isSoundFontLoaded&&this._isMidiLoaded},get_State:function(){return this._state},get_LogLevel:function(){return AlphaSynth.Util.Logger.LogLevel},set_LogLevel:function(t){AlphaSynth.Util.Logger.LogLevel=t},get_MasterVolume:function(){return this._synthesizer.MasterVolume},set_MasterVolume:function(t){t=AlphaSynth.Synthesis.SynthHelper.ClampF(t,0,10),this._synthesizer.MasterVolume=t},get_MetronomeVolume:function(){return this._synthesizer.get_MetronomeVolume()},set_MetronomeVolume:function(t){t=AlphaSynth.Synthesis.SynthHelper.ClampF(t,0,10),this._synthesizer.set_MetronomeVolume(t)},get_PlaybackSpeed:function(){return this._sequencer.PlaybackSpeed},set_PlaybackSpeed:function(t){t=AlphaSynth.Synthesis.SynthHelper.ClampD(t,.125,8);var e=this._sequencer.PlaybackSpeed;this._sequencer.PlaybackSpeed=t,this.UpdateTimePosition(this._timePosition*(e/t))},get_TickPosition:function(){return this._tickPosition},set_TickPosition:function(t){this.set_TimePosition(this._sequencer.TickPositionToTimePosition(t))},get_TimePosition:function(){return this._timePosition},set_TimePosition:function(t){AlphaSynth.Util.Logger.Debug("Seeking to position "+t+"ms"),this._sequencer.Seek(t),this.UpdateTimePosition(t),this.Output.ResetSamples()},get_PlaybackRange:function(){return this._sequencer.get_PlaybackRange()},set_PlaybackRange:function(t){this._sequencer.set_PlaybackRange(t),null!=t&&this.set_TickPosition(t.StartTick)},get_IsLooping:function(){return this._sequencer.IsLooping},set_IsLooping:function(t){this._sequencer.IsLooping=t},Play:function(){this.get_State()!=AlphaSynth.PlayerState.Playing&&this.get_IsReadyForPlayback()&&(AlphaSynth.Util.Logger.Debug("Starting playback"),this._state=AlphaSynth.PlayerState.Playing,this.OnPlayerStateChanged(new AlphaSynth.PlayerStateChangedEventArgs(this._state)),this.Output.Play())},Pause:function(){this.get_State()!=AlphaSynth.PlayerState.Paused&&this.get_IsReadyForPlayback()&&(AlphaSynth.Util.Logger.Debug("Pausing playback"),this._state=AlphaSynth.PlayerState.Paused,this.OnPlayerStateChanged(new AlphaSynth.PlayerStateChangedEventArgs(this._state)),this.Output.Pause(),this._synthesizer.NoteOffAll(!1))},PlayPause:function(){this.get_State()!=AlphaSynth.PlayerState.Playing&&this.get_IsReadyForPlayback()?this.Play():this.Pause()},Stop:function(){this.get_IsReadyForPlayback()&&(AlphaSynth.Util.Logger.Debug("Stopping playback"),this.Pause(),this.set_TickPosition(null!=this._sequencer.get_PlaybackRange()?this._sequencer.get_PlaybackRange().StartTick:0))},LoadSoundFont:function(t){this.Pause();var e=AlphaSynth.IO.ByteBuffer.FromBuffer(t);try{AlphaSynth.Util.Logger.Info("Loading soundfont from bytes");var n=new AlphaSynth.Bank.PatchBank;n.LoadSf2(e),this._synthesizer.LoadBank(n),this._isSoundFontLoaded=!0,this.OnSoundFontLoaded(),AlphaSynth.Util.Logger.Info("soundFont successfully loaded"),this.CheckReadyForPlayback()}catch(t){AlphaSynth.Util.Logger.Error("Could not load soundfont from bytes "+t),this.OnSoundFontLoadFailed()}},CheckReadyForPlayback:function(){this.get_IsReadyForPlayback()&&this.OnReadyForPlayback()},LoadMidi:function(t){this.Stop();var e=AlphaSynth.IO.ByteBuffer.FromBuffer(t);try{AlphaSynth.Util.Logger.Info("Loading midi from bytes");var n=new AlphaSynth.Midi.MidiFile;n.Load(e),this._sequencer.LoadMidi(n),this._isMidiLoaded=!0,this.OnMidiLoaded(),AlphaSynth.Util.Logger.Info("Midi successfully loaded"),this.CheckReadyForPlayback(),this.set_TickPosition(0)}catch(t){AlphaSynth.Util.Logger.Error("Could not load midi from bytes "+t),this.OnMidiLoadFailed()}},SetChannelMute:function(t,e){this._synthesizer.SetChannelMute(t,e)},ResetChannelStates:function(){this._synthesizer.ResetChannelStates()},SetChannelSolo:function(t,e){this._synthesizer.SetChannelSolo(t,e)},SetChannelVolume:function(t,e){e=AlphaSynth.Synthesis.SynthHelper.ClampD(e,0,10),this._synthesizer.SetChannelVolume(t,e)},SetChannelProgram:function(t,e){e=AlphaSynth.Synthesis.SynthHelper.ClampB(e,0,127),this._sequencer.SetChannelProgram(t,e),this._synthesizer.SetChannelProgram(t,e)},OnSamplesPlayed:function(t){var e=t/this._synthesizer.SampleRate*1e3;this.UpdateTimePosition(this._timePosition+e)},UpdateTimePosition:function(t){var e=this._timePosition=t,n=this._tickPosition=this._sequencer.TimePositionToTickPosition(e),a=this._sequencer.get_EndTime(),i=this._sequencer.EndTick;AlphaSynth.Util.Logger.Debug("Position changed: (time: "+e+"/"+a+", tick: "+n+"/"+a+")"),this.OnPositionChanged(new AlphaSynth.PositionChangedEventArgs(e,a,n,i))},add_Finished:function(t){this.Finished=$CombineDelegates(this.Finished,t)},remove_Finished:function(t){this.Finished=$RemoveDelegate(this.Finished,t)},OnFinished:function(t){var e=this.Finished;null!=e&&e(t)},add_PlayerStateChanged:function(t){this.PlayerStateChanged=$CombineDelegates(this.PlayerStateChanged,t)},remove_PlayerStateChanged:function(t){this.PlayerStateChanged=$RemoveDelegate(this.PlayerStateChanged,t)},OnPlayerStateChanged:function(t){var e=this.PlayerStateChanged;null!=e&&e(this,t)},add_SoundFontLoaded:function(t){this.SoundFontLoaded=$CombineDelegates(this.SoundFontLoaded,t)},remove_SoundFontLoaded:function(t){this.SoundFontLoaded=$RemoveDelegate(this.SoundFontLoaded,t)},OnSoundFontLoaded:function(){var t=this.SoundFontLoaded;null!=t&&t(this,AlphaSynth.EmptyEventArgs.Instance)},add_ReadyForPlayback:function(t){this.ReadyForPlayback=$CombineDelegates(this.ReadyForPlayback,t)},remove_ReadyForPlayback:function(t){this.ReadyForPlayback=$RemoveDelegate(this.ReadyForPlayback,t)},OnReadyForPlayback:function(){var t=this.ReadyForPlayback;null!=t&&t(this,AlphaSynth.EmptyEventArgs.Instance)},add_SoundFontLoadFailed:function(t){this.SoundFontLoadFailed=$CombineDelegates(this.SoundFontLoadFailed,t)},remove_SoundFontLoadFailed:function(t){this.SoundFontLoadFailed=$RemoveDelegate(this.SoundFontLoadFailed,t)},OnSoundFontLoadFailed:function(){var t=this.SoundFontLoadFailed;null!=t&&t(this,AlphaSynth.EmptyEventArgs.Instance)},add_MidiLoaded:function(t){this.MidiLoaded=$CombineDelegates(this.MidiLoaded,t)},remove_MidiLoaded:function(t){this.MidiLoaded=$RemoveDelegate(this.MidiLoaded,t)},OnMidiLoaded:function(){var t=this.MidiLoaded;null!=t&&t(this,AlphaSynth.EmptyEventArgs.Instance)},add_MidiLoadFailed:function(t){this.MidiLoadFailed=$CombineDelegates(this.MidiLoadFailed,t)},remove_MidiLoadFailed:function(t){this.MidiLoadFailed=$RemoveDelegate(this.MidiLoadFailed,t)},OnMidiLoadFailed:function(){var t=this.MidiLoadFailed;null!=t&&t(this,AlphaSynth.EmptyEventArgs.Instance)},add_PositionChanged:function(t){this.PositionChanged=$CombineDelegates(this.PositionChanged,t)},remove_PositionChanged:function(t){this.PositionChanged=$RemoveDelegate(this.PositionChanged,t)},OnPositionChanged:function(t){var e=this.PositionChanged;null!=e&&e(this,t)}},AlphaSynth.EmptyEventArgs=function(){},$StaticConstructor(function(){AlphaSynth.EmptyEventArgs.Instance=new AlphaSynth.EmptyEventArgs}),AlphaSynth.ProgressEventArgs=function(t,e){this.Loaded=0,this.Total=0,this.Loaded=t,this.Total=e},AlphaSynth.PlayerStateChangedEventArgs=function(t){this.State=AlphaSynth.PlayerState.Paused,this.State=t},AlphaSynth.PositionChangedEventArgs=function(t,e,n,a){this.CurrentTime=0,this.EndTime=0,this.CurrentTick=0,this.EndTick=0,this.CurrentTime=t,this.EndTime=e,this.CurrentTick=n,this.EndTick=a},AlphaSynth.Bank=AlphaSynth.Bank||{},AlphaSynth.Bank.AssetManager=function(){this.PatchAssets=null,this.SampleAssets=null,this.PatchAssets=[],this.SampleAssets=[]},AlphaSynth.Bank.AssetManager.prototype={FindPatch:function(t){for(var e=0;e<this.PatchAssets.length;e++){var n=this.PatchAssets[e];if(n.Name==t)return n}return null},FindSample:function(t){for(var e=0;e<this.SampleAssets.length;e++){var n=this.SampleAssets[e];if(n.Name==t)return n}return null}},AlphaSynth.Bank.Components=AlphaSynth.Bank.Components||{},AlphaSynth.Bank.Components.Generators=AlphaSynth.Bank.Components.Generators||{},AlphaSynth.Bank.Components.Generators.Generator=function(t){this.LoopMode=AlphaSynth.Bank.Components.Generators.LoopMode.NoLoop,this.LoopStartPhase=0,this.LoopEndPhase=0,this.StartPhase=0,this.EndPhase=0,this.Offset=0,this.Period=0,this.Frequency=0,this.RootKey=0,this.KeyTrack=0,this.VelocityTrack=0,this.Tune=0,this.LoopMode=t.LoopMethod,this.LoopStartPhase=t.LoopStartPhase,this.LoopEndPhase=t.LoopEndPhase,this.StartPhase=t.StartPhase,this.EndPhase=t.EndPhase,this.Offset=t.Offset,this.Period=t.Period,this.Frequency=0,this.RootKey=t.RootKey,this.KeyTrack=t.KeyTrack,this.VelocityTrack=t.VelTrack,this.Tune=t.Tune},AlphaSynth.Bank.Components.Generators.Generator.prototype={Release:function(t){this.LoopMode==AlphaSynth.Bank.Components.Generators.LoopMode.LoopUntilNoteOff&&(t.CurrentState=AlphaSynth.Bank.Components.Generators.GeneratorState.PostLoop,t.CurrentStart=this.StartPhase,t.CurrentEnd=this.EndPhase)},GetValues:function(t,e,n){var a=0;do{var i=0|Math.ceil((t.CurrentEnd-t.Phase)/n);if(i>e.length-a)for(;a<e.length;)e[a++]=this.GetValue(t.Phase),t.Phase+=n;else{for(var h=a+i;a<h;)e[a++]=this.GetValue(t.Phase),t.Phase+=n;switch(t.CurrentState){case AlphaSynth.Bank.Components.Generators.GeneratorState.PreLoop:t.CurrentStart=this.LoopStartPhase,t.CurrentEnd=this.LoopEndPhase,t.CurrentState=AlphaSynth.Bank.Components.Generators.GeneratorState.Loop;break;case AlphaSynth.Bank.Components.Generators.GeneratorState.Loop:t.Phase+=t.CurrentStart-t.CurrentEnd;break;case AlphaSynth.Bank.Components.Generators.GeneratorState.PostLoop:for(t.CurrentState=AlphaSynth.Bank.Components.Generators.GeneratorState.Finished;a<e.length;)e[a++]=0}}}while(a<e.length)}},AlphaSynth.Bank.Components.Generators.WhiteNoiseGenerator=function(t){AlphaSynth.Bank.Components.Generators.Generator.call(this,t),this.EndPhase<0&&(this.EndPhase=1),this.StartPhase<0&&(this.StartPhase=0),this.LoopEndPhase<0&&(this.LoopEndPhase=this.EndPhase),this.LoopStartPhase<0&&(this.LoopStartPhase=this.StartPhase),this.Period<0&&(this.Period=1),this.RootKey<0&&(this.RootKey=69),this.Frequency=440},AlphaSynth.Bank.Components.Generators.WhiteNoiseGenerator.prototype={GetValue:function(t){return 2*AlphaSynth.Platform.Std.Random()-1}},$Inherit(AlphaSynth.Bank.Components.Generators.WhiteNoiseGenerator,AlphaSynth.Bank.Components.Generators.Generator),AlphaSynth.Bank.Components.Generators.TriangleGenerator=function(t){AlphaSynth.Bank.Components.Generators.Generator.call(this,t),this.EndPhase<0&&(this.EndPhase=1.25),this.StartPhase<0&&(this.StartPhase=.25),this.LoopEndPhase<0&&(this.LoopEndPhase=this.EndPhase),this.LoopStartPhase<0&&(this.LoopStartPhase=this.StartPhase),this.Period<0&&(this.Period=1),this.RootKey<0&&(this.RootKey=69),this.Frequency=440},AlphaSynth.Bank.Components.Generators.TriangleGenerator.prototype={GetValue:function(t){return 4*Math.abs(t-Math.Floor(t+.5))-1}},$Inherit(AlphaSynth.Bank.Components.Generators.TriangleGenerator,AlphaSynth.Bank.Components.Generators.Generator),AlphaSynth.Bank.Components.Generators.SquareGenerator=function(t){AlphaSynth.Bank.Components.Generators.Generator.call(this,t),this.EndPhase<0&&(this.EndPhase=6.28318530717958),this.StartPhase<0&&(this.StartPhase=0),this.LoopEndPhase<0&&(this.LoopEndPhase=this.EndPhase),this.LoopStartPhase<0&&(this.LoopStartPhase=this.StartPhase),this.Period<0&&(this.Period=6.28318530717958),this.RootKey<0&&(this.RootKey=69),this.Frequency=440},AlphaSynth.Bank.Components.Generators.SquareGenerator.prototype={GetValue:function(t){return Math.Sign(Math.sin(t))}},$Inherit(AlphaSynth.Bank.Components.Generators.SquareGenerator,AlphaSynth.Bank.Components.Generators.Generator),AlphaSynth.Bank.Components.Generators.SineGenerator=function(t){AlphaSynth.Bank.Components.Generators.Generator.call(this,t),this.EndPhase<0&&(this.EndPhase=6.28318530717958),this.StartPhase<0&&(this.StartPhase=0),this.LoopEndPhase<0&&(this.LoopEndPhase=this.EndPhase),this.LoopStartPhase<0&&(this.LoopStartPhase=this.StartPhase),this.Period<0&&(this.Period=6.28318530717958),this.RootKey<0&&(this.RootKey=69),this.Frequency=440},AlphaSynth.Bank.Components.Generators.SineGenerator.prototype={GetValue:function(t){return Math.sin(t)}},$Inherit(AlphaSynth.Bank.Components.Generators.SineGenerator,AlphaSynth.Bank.Components.Generators.Generator),AlphaSynth.Bank.Components.Generators.SawGenerator=function(t){AlphaSynth.Bank.Components.Generators.Generator.call(this,t),this.EndPhase<0&&(this.EndPhase=1),this.StartPhase<0&&(this.StartPhase=0),this.LoopEndPhase<0&&(this.LoopEndPhase=this.EndPhase),this.LoopStartPhase<0&&(this.LoopStartPhase=this.StartPhase),this.Period<0&&(this.Period=1),this.RootKey<0&&(this.RootKey=69),this.Frequency=440},AlphaSynth.Bank.Components.Generators.SawGenerator.prototype={GetValue:function(t){return 2*(t-Math.Floor(t+.5))}},$Inherit(AlphaSynth.Bank.Components.Generators.SawGenerator,AlphaSynth.Bank.Components.Generators.Generator),AlphaSynth.Bank.Components.Generators.Interpolation={None:0,Linear:1,Cosine:2,CubicSpline:3,Sinc:4},AlphaSynth.Bank.Components.Generators.SampleGenerator=function(){this.Samples=null,AlphaSynth.Bank.Components.Generators.Generator.call(this,new AlphaSynth.Bank.Descriptors.GeneratorDescriptor)},AlphaSynth.Bank.Components.Generators.SampleGenerator.prototype={GetValue:function(t){return this.Samples.get_Item(0|t)},GetValues:function(t,e,n){var a=0;do{var i=0|Math.ceil((t.CurrentEnd-t.Phase)/n);if(i>e.length-a)return void this.Interpolate(t,e,n,a,e.length);var h=a+i;switch(this.Interpolate(t,e,n,a,h),a=h,t.CurrentState){case AlphaSynth.Bank.Components.Generators.GeneratorState.PreLoop:t.CurrentStart=this.LoopStartPhase,t.CurrentEnd=this.LoopEndPhase,t.CurrentState=AlphaSynth.Bank.Components.Generators.GeneratorState.Loop;break;case AlphaSynth.Bank.Components.Generators.GeneratorState.Loop:t.Phase+=t.CurrentStart-t.CurrentEnd;break;case AlphaSynth.Bank.Components.Generators.GeneratorState.PostLoop:for(t.CurrentState=AlphaSynth.Bank.Components.Generators.GeneratorState.Finished;a<e.length;)e[a++]=0}}while(a<e.length)},Interpolate:function(t,e,n,a,i){switch(1){case AlphaSynth.Bank.Components.Generators.Interpolation.Linear:for(u=t.CurrentState==AlphaSynth.Bank.Components.Generators.GeneratorState.Loop?this.LoopEndPhase-1:this.EndPhase-1;a<i&&t.Phase<u;)h=0|t.Phase,o=this.Samples.get_Item(h),r=this.Samples.get_Item(h+1),p=t.Phase-h,e[a++]=o+p*(r-o),t.Phase+=n;for(;a<i;)h=0|t.Phase,o=this.Samples.get_Item(h),r=t.CurrentState==AlphaSynth.Bank.Components.Generators.GeneratorState.Loop?this.Samples.get_Item(0|t.CurrentStart):o,p=t.Phase-h,e[a++]=o+p*(r-o),t.Phase+=n;break;case AlphaSynth.Bank.Components.Generators.Interpolation.Cosine:for(u=t.CurrentState==AlphaSynth.Bank.Components.Generators.GeneratorState.Loop?this.LoopEndPhase-1:this.EndPhase-1;a<i&&t.Phase<u;)h=0|t.Phase,o=this.Samples.get_Item(h),r=this.Samples.get_Item(h+1),p=.5*(1-Math.cos(3.14159265358979*(t.Phase-h))),e[a++]=o*(1-p)+r*p,t.Phase+=n;for(;a<i;)h=0|t.Phase,o=this.Samples.get_Item(h),r=t.CurrentState==AlphaSynth.Bank.Components.Generators.GeneratorState.Loop?this.Samples.get_Item(0|t.CurrentStart):o,p=.5*(1-Math.cos(3.14159265358979*(t.Phase-h))),e[a++]=o*(1-p)+r*p,t.Phase+=n;break;case AlphaSynth.Bank.Components.Generators.Interpolation.CubicSpline:for(var h,s,o,r,l,p,u=t.CurrentState==AlphaSynth.Bank.Components.Generators.GeneratorState.Loop?this.LoopStartPhase+1:this.StartPhase+1;a<i&&t.Phase<u;)h=0|t.Phase,s=t.CurrentState==AlphaSynth.Bank.Components.Generators.GeneratorState.Loop?this.Samples.get_Item(-1|t.CurrentEnd):this.Samples.get_Item(h),o=this.Samples.get_Item(h),r=this.Samples.get_Item(h+1),l=this.Samples.get_Item(h+2),p=t.Phase-h,e[a++]=(-.5*s+1.5*o-1.5*r+.5*l)*p*p*p+(s-2.5*o+2*r-.5*l)*p*p+(-.5*s+.5*r)*p+o,t.Phase+=n;for(u=t.CurrentState==AlphaSynth.Bank.Components.Generators.GeneratorState.Loop?this.LoopEndPhase-2:this.EndPhase-2;a<i&&t.Phase<u;)h=0|t.Phase,s=this.Samples.get_Item(h-1),o=this.Samples.get_Item(h),r=this.Samples.get_Item(h+1),l=this.Samples.get_Item(h+2),p=t.Phase-h,e[a++]=(-.5*s+1.5*o-1.5*r+.5*l)*p*p*p+(s-2.5*o+2*r-.5*l)*p*p+(-.5*s+.5*r)*p+o,t.Phase+=n;for(u+=1;a<i;)h=0|t.Phase,s=this.Samples.get_Item(h-1),o=this.Samples.get_Item(h),t.Phase<u?(r=this.Samples.get_Item(h+1),l=t.CurrentState==AlphaSynth.Bank.Components.Generators.GeneratorState.Loop?this.Samples.get_Item(0|t.CurrentStart):r):t.CurrentState==AlphaSynth.Bank.Components.Generators.GeneratorState.Loop?(r=this.Samples.get_Item(0|t.CurrentStart),l=this.Samples.get_Item(1|t.CurrentStart)):(r=o,l=o),p=t.Phase-h,e[a++]=(-.5*s+1.5*o-1.5*r+.5*l)*p*p*p+(s-2.5*o+2*r-.5*l)*p*p+(-.5*s+.5*r)*p+o,t.Phase+=n;break;default:for(;a<i;)e[a++]=this.Samples.get_Item(0|t.Phase),t.Phase+=n}}},$Inherit(AlphaSynth.Bank.Components.Generators.SampleGenerator,AlphaSynth.Bank.Components.Generators.Generator),AlphaSynth.Bank.Components.Generators.GeneratorParameters=function(){this.Phase=0,this.CurrentStart=0,this.CurrentEnd=0,this.CurrentState=AlphaSynth.Bank.Components.Generators.GeneratorState.PreLoop,this.Phase=0,this.CurrentStart=0,this.CurrentEnd=0,this.CurrentState=AlphaSynth.Bank.Components.Generators.GeneratorState.PreLoop},AlphaSynth.Bank.Components.Generators.GeneratorParameters.prototype={QuickSetup:function(t){switch(this.CurrentStart=t.StartPhase,this.Phase=this.CurrentStart+t.Offset,t.LoopMode){case AlphaSynth.Bank.Components.Generators.LoopMode.Continuous:case AlphaSynth.Bank.Components.Generators.LoopMode.LoopUntilNoteOff:this.Phase>=t.EndPhase?this.CurrentState=AlphaSynth.Bank.Components.Generators.GeneratorState.Finished:this.Phase>=t.LoopEndPhase?(this.CurrentState=AlphaSynth.Bank.Components.Generators.GeneratorState.PostLoop,this.CurrentEnd=t.EndPhase):this.Phase>=t.LoopStartPhase?(this.CurrentState=AlphaSynth.Bank.Components.Generators.GeneratorState.Loop,this.CurrentEnd=t.LoopEndPhase,this.CurrentStart=t.LoopStartPhase):(this.CurrentState=AlphaSynth.Bank.Components.Generators.GeneratorState.PreLoop,this.CurrentEnd=t.LoopStartPhase);break;default:this.CurrentEnd=t.EndPhase,this.Phase>=this.CurrentEnd?this.CurrentState=AlphaSynth.Bank.Components.Generators.GeneratorState.Finished:this.CurrentState=AlphaSynth.Bank.Components.Generators.GeneratorState.PostLoop}}},AlphaSynth.Bank.Components.Generators.LoopMode={NoLoop:0,OneShot:1,Continuous:2,LoopUntilNoteOff:3},AlphaSynth.Bank.Components.Generators.GeneratorState={PreLoop:0,Loop:1,PostLoop:2,Finished:3},AlphaSynth.Bank.Components.Generators.DefaultGenerators=function(){},$StaticConstructor(function(){AlphaSynth.Bank.Components.Generators.DefaultGenerators.DefaultSine=new AlphaSynth.Bank.Components.Generators.SineGenerator(new AlphaSynth.Bank.Descriptors.GeneratorDescriptor),AlphaSynth.Bank.Components.Generators.DefaultGenerators.DefaultSaw=new AlphaSynth.Bank.Components.Generators.SawGenerator(new AlphaSynth.Bank.Descriptors.GeneratorDescriptor),AlphaSynth.Bank.Components.Generators.DefaultGenerators.DefaultSquare=new AlphaSynth.Bank.Components.Generators.SquareGenerator(new AlphaSynth.Bank.Descriptors.GeneratorDescriptor),AlphaSynth.Bank.Components.Generators.DefaultGenerators.DefaultTriangle=new AlphaSynth.Bank.Components.Generators.TriangleGenerator(new AlphaSynth.Bank.Descriptors.GeneratorDescriptor)}),AlphaSynth.Bank.Components.LfoState={Delay:0,Sustain:1},AlphaSynth.Bank.Components.Lfo=function(){this._phase=0,this._increment=0,this._delayTime=0,this._generator=null,this.Frequency=0,this.CurrentState=AlphaSynth.Bank.Components.LfoState.Delay,this.Value=0,this.Depth=0,this.CurrentState=AlphaSynth.Bank.Components.LfoState.Delay,this._generator=AlphaSynth.Bank.Components.Generators.DefaultGenerators.DefaultSine,this._delayTime=0,this._increment=0,this._phase=0,this.Frequency=0,this.CurrentState=AlphaSynth.Bank.Components.LfoState.Delay,this.Value=0,this.Depth=0},AlphaSynth.Bank.Components.Lfo.prototype={QuickSetup:function(t,e){this._generator=e.Generator,this._delayTime=t*e.DelayTime|0,this.Frequency=e.Frequency,this._increment=this._generator.Period*this.Frequency/t,this.Depth=e.Depth,this.Reset()},Increment:function(t){this.CurrentState==AlphaSynth.Bank.Components.LfoState.Delay?(this._phase-=t,this._phase<=0&&(this._phase=this._generator.LoopStartPhase+this._increment*-this._phase,this.Value=this._generator.GetValue(this._phase),this.CurrentState=AlphaSynth.Bank.Components.LfoState.Sustain)):(this._phase+=this._increment*t,this._phase>=this._generator.LoopEndPhase&&(this._phase=this._generator.LoopStartPhase+(this._phase-this._generator.LoopEndPhase)%(this._generator.LoopEndPhase-this._generator.LoopStartPhase)),this.Value=this._generator.GetValue(this._phase))},Reset:function(){this.Value=0,this._delayTime>0?(this._phase=this._delayTime,this.CurrentState=AlphaSynth.Bank.Components.LfoState.Delay):(this._phase=0,this.CurrentState=AlphaSynth.Bank.Components.LfoState.Sustain)}},AlphaSynth.Bank.Components.FilterType={None:0,BiquadLowpass:1,BiquadHighpass:2,OnePoleLowpass:3},AlphaSynth.Bank.Components.Filter=function(){this._a1=0,this._a2=0,this._b1=0,this._b2=0,this._m1=0,this._m2=0,this._m3=0,this._cutOff=0,this._resonance=0,this.FilterMethod=AlphaSynth.Bank.Components.FilterType.None,this.CoeffNeedsUpdating=!1,this._a1=0,this._a2=0,this._b1=0,this._b2=0,this._m1=0,this._m2=0,this._m3=0,this.FilterMethod=AlphaSynth.Bank.Components.FilterType.None,this.set_CutOff(0),this.set_Resonance(0)},AlphaSynth.Bank.Components.Filter.prototype={get_CutOff:function(){return this._cutOff},set_CutOff:function(t){this._cutOff=t,this.CoeffNeedsUpdating=!0},get_Resonance:function(){return this._resonance},set_Resonance:function(t){this._resonance=t,this.CoeffNeedsUpdating=!0},get_Enabled:function(){return this.FilterMethod!=AlphaSynth.Bank.Components.FilterType.None},Disable:function(){this.FilterMethod=AlphaSynth.Bank.Components.FilterType.None},QuickSetup:function(t,e,n,a){this.CoeffNeedsUpdating=!1,this.set_CutOff(a.CutOff),this.set_Resonance(a.Resonance),this.FilterMethod=a.FilterMethod,this._a1=0,this._a2=0,this._b1=0,this._b2=0,this._m1=0,this._m2=0,this._m3=0,(this.get_CutOff()<=0||this.get_Resonance()<=0)&&(this.FilterMethod=AlphaSynth.Bank.Components.FilterType.None),this.FilterMethod!=AlphaSynth.Bank.Components.FilterType.None&&(this.set_CutOff(this.get_CutOff()*AlphaSynth.Synthesis.SynthHelper.CentsToPitch((e-a.RootKey)*a.KeyTrack+n*a.VelTrack|0)),this.UpdateCoefficients(t))},ApplyFilter:function(t){switch(this.FilterMethod){case AlphaSynth.Bank.Components.FilterType.BiquadHighpass:case AlphaSynth.Bank.Components.FilterType.BiquadLowpass:return this._m3=t-this._a1*this._m1-this._a2*this._m2,t=this._b2*(this._m3+this._m2)+this._b1*this._m1,this._m2=this._m1,this._m1=this._m3,t;case AlphaSynth.Bank.Components.FilterType.OnePoleLowpass:return this._m1+=this._a1*(t-this._m1),this._m1;default:return 0}},ApplyFilter:function(t){switch(this.FilterMethod){case AlphaSynth.Bank.Components.FilterType.BiquadHighpass:case AlphaSynth.Bank.Components.FilterType.BiquadLowpass:for(e=0;e<t.length;e++)this._m3=t[e]-this._a1*this._m1-this._a2*this._m2,t[e]=this._b2*(this._m3+this._m2)+this._b1*this._m1,this._m2=this._m1,this._m1=this._m3;break;case AlphaSynth.Bank.Components.FilterType.OnePoleLowpass:for(var e=0;e<t.length;e++)this._m1+=this._a1*(t[e]-this._m1),t[e]=this._m1}},ApplyFilterInterp:function(t,e){var n=this.GenerateFilterCoeff(this.get_CutOff()/e,this.get_Resonance()),a=(n[0]-this._a1)/t.length,i=(n[1]-this._a2)/t.length,h=(n[2]-this._b1)/t.length,s=(n[3]-this._b2)/t.length;switch(this.FilterMethod){case AlphaSynth.Bank.Components.FilterType.BiquadHighpass:case AlphaSynth.Bank.Components.FilterType.BiquadLowpass:for(o=0;o<t.length;o++)this._a1+=a,this._a2+=i,this._b1+=h,this._b2+=s,this._m3=t[o]-this._a1*this._m1-this._a2*this._m2,t[o]=this._b2*(this._m3+this._m2)+this._b1*this._m1,this._m2=this._m1,this._m1=this._m3;this._a1=n[0],this._a2=n[1],this._b1=n[2],this._b2=n[3];break;case AlphaSynth.Bank.Components.FilterType.OnePoleLowpass:for(var o=0;o<t.length;o++)this._a1+=a,this._m1+=this._a1*(t[o]-this._m1),t[o]=this._m1;this._a1=n[0]}this.CoeffNeedsUpdating=!1},UpdateCoefficients:function(t){var e=this.GenerateFilterCoeff(this.get_CutOff()/t,this.get_Resonance());this._a1=e[0],this._a2=e[1],this._b1=e[2],this._b2=e[3],this.CoeffNeedsUpdating=!1},GenerateFilterCoeff:function(t,e){t=AlphaSynth.Synthesis.SynthHelper.ClampD(t,1e-38,.49);var n=new Float32Array(4);switch(this.FilterMethod){case AlphaSynth.Bank.Components.FilterType.BiquadLowpass:var a=6.28318530717958*t,i=Math.cos(a),h=1/(1+(s=Math.sin(a)/(2*e)));n[0]=-2*i*h,n[1]=(1-s)*h,n[2]=(1-i)*h*(1/Math.sqrt(e)),n[3]=.5*this._b1;break;case AlphaSynth.Bank.Components.FilterType.BiquadHighpass:var a=6.28318530717958*t,i=Math.cos(a),s=Math.sin(a)/(2*e),h=1/(1+s),o=1/Math.sqrt(e);n[0]=-2*i*h,n[1]=(1-s)*h,n[2]=(-1-i)*h*o,n[3]=(1+i)*h*o*.5;break;case AlphaSynth.Bank.Components.FilterType.OnePoleLowpass:n[0]=1-Math.Exp(-6.28318530717959*t)}return n}},AlphaSynth.Bank.Components.EnvelopeState={Delay:0,Attack:1,Hold:2,Decay:3,Sustain:4,Release:5,None:6},AlphaSynth.Bank.Components.Envelope=function(){this._stages=null,this._index=0,this._stage=null,this.Value=0,this.CurrentStage=AlphaSynth.Bank.Components.EnvelopeState.Delay,this.Depth=0,this.Value=0,this.Depth=0,this._stages=new Array(7);for(var t=0;t<this._stages.length;t++)this._stages[t]=new AlphaSynth.Bank.Components.EnvelopeStage,this._stages[t].Graph=AlphaSynth.Util.Tables.EnvelopeTables(0);this._stages[3].Reverse=!0,this._stages[5].Reverse=!0,this._stages[6].Time=1e8,this.CurrentStage=AlphaSynth.Bank.Components.EnvelopeState.Delay,this._stage=this._stages[this.CurrentStage]},AlphaSynth.Bank.Components.Envelope.prototype={QuickSetupSf2:function(t,e,n,a,i,h){for(this.Depth=h.Depth,this._stages[0].Offset=0,this._stages[0].Scale=0,this._stages[0].Time=Math.max(0,t*h.DelayTime|0),this._stages[1].Offset=h.StartLevel,this._stages[1].Scale=h.PeakLevel-h.StartLevel,this._stages[1].Time=Math.max(0,t*h.AttackTime|0),this._stages[1].Graph=AlphaSynth.Util.Tables.EnvelopeTables(h.AttackGraph),this._stages[2].Offset=0,this._stages[2].Scale=h.PeakLevel,this._stages[2].Time=0|Math.max(0,t*h.HoldTime*Math.pow(2,(60-e)*n/1200)),this._stages[3].Offset=h.SustainLevel,this._stages[3].Scale=h.PeakLevel-h.SustainLevel,h.SustainLevel==h.PeakLevel?this._stages[3].Time=0:this._stages[3].Time=Math.max(0,t*h.DecayTime*Math.pow(2,(60-e)*a/1200)|0),this._stages[3].Graph=AlphaSynth.Util.Tables.EnvelopeTables(h.DecayGraph),this._stages[4].Offset=0,this._stages[4].Scale=h.SustainLevel,this._stages[4].Time=t*h.SustainTime|0,this._stages[5].Scale=0==this._stages[3].Time&&0==this._stages[4].Time?h.PeakLevel:this._stages[4].Scale,i?(this._stages[5].Offset=-100,this._stages[5].Scale+=100,this._stages[6].Scale=-100):(this._stages[5].Offset=0,this._stages[6].Scale=0),this._stages[5].Time=Math.max(0,t*h.ReleaseTime|0),this._stages[5].Graph=AlphaSynth.Util.Tables.EnvelopeTables(h.ReleaseGraph),this._index=0,this.Value=0,this.CurrentStage=AlphaSynth.Bank.Components.EnvelopeState.Delay;0==this._stages[this.CurrentStage].Time;)this.CurrentStage++;this._stage=this._stages[this.CurrentStage]},Increment:function(t){do{var e=this._stage.Time-this._index;if(e>t)this._index+=t,t=0;else{if(this._index=0,this.CurrentStage!=AlphaSynth.Bank.Components.EnvelopeState.None)do{this._stage=this._stages[++this.CurrentStage]}while(0==this._stage.Time);t-=e}}while(t>0);var n=this._stage.Graph.length*(this._index/this._stage.Time)|0;this._stage.Reverse?this.Value=(1-this._stage.Graph[n])*this._stage.Scale+this._stage.Offset:this.Value=this._stage.Graph[n]*this._stage.Scale+this._stage.Offset},Release:function(t){this.Value<=t?(this._index=0,this.CurrentStage=AlphaSynth.Bank.Components.EnvelopeState.None,this._stage=this._stages[this.CurrentStage]):this.CurrentStage<AlphaSynth.Bank.Components.EnvelopeState.Release&&(this._index=0,this.CurrentStage=AlphaSynth.Bank.Components.EnvelopeState.Release,this._stage=this._stages[this.CurrentStage],this._stage.Scale=this.Value)},ReleaseSf2VolumeEnvelope:function(){this.Value<=-100?(this._index=0,this.CurrentStage=AlphaSynth.Bank.Components.EnvelopeState.None,this._stage=this._stages[this.CurrentStage]):this.CurrentStage<AlphaSynth.Bank.Components.EnvelopeState.Release&&(this._index=0,this.CurrentStage=AlphaSynth.Bank.Components.EnvelopeState.Release,this._stage=this._stages[this.CurrentStage],this._stage.Offset=-100,this._stage.Scale=100+this.Value)}},AlphaSynth.Bank.Components.EnvelopeStage=function(){this.Time=0,this.Graph=null,this.Scale=0,this.Offset=0,this.Reverse=!1,this.Time=0,this.Graph=null,this.Scale=0,this.Offset=0,this.Reverse=!1},AlphaSynth.Bank.Components.PanFormulaEnum={Neg3dBCenter:0,Neg6dBCenter:1,ZeroCenter:2},AlphaSynth.Bank.Components.PanComponent=function(){this.Left=0,this.Right=0},AlphaSynth.Bank.Components.PanComponent.prototype={SetValue:function(t,e){t=AlphaSynth.Synthesis.SynthHelper.ClampF(t,-1,1);var n;switch(e){case AlphaSynth.Bank.Components.PanFormulaEnum.Neg3dBCenter:n=1.5707963267949*(t+1)/2,this.Left=Math.cos(n),this.Right=Math.sin(n);break;case AlphaSynth.Bank.Components.PanFormulaEnum.Neg6dBCenter:this.Left=.5+-.5*t,this.Right=.5+.5*t;break;case AlphaSynth.Bank.Components.PanFormulaEnum.ZeroCenter:n=1.5707963267949*(t+1)/2,this.Left=Math.cos(n)/.707106781186,this.Right=Math.sin(n)/.707106781186;break;default:throw $CreateException(new System.Exception.ctor$$String("Invalid pan law selected."),new Error)}}},AlphaSynth.Bank.Descriptors=AlphaSynth.Bank.Descriptors||{},AlphaSynth.Bank.Descriptors.LfoDescriptor=function(){this.DelayTime=0,this.Frequency=0,this.Depth=0,this.Generator=null,this.DelayTime=0,this.Frequency=8,this.Depth=1,this.Generator=AlphaSynth.Bank.Components.Generators.DefaultGenerators.DefaultSine},AlphaSynth.Bank.Descriptors.Waveform={Sine:0,Square:1,Saw:2,Triangle:3,SampleData:4,WhiteNoise:5},AlphaSynth.Bank.Descriptors.GeneratorDescriptor=function(){this.LoopMethod=AlphaSynth.Bank.Components.Generators.LoopMode.NoLoop,this.SamplerType=AlphaSynth.Bank.Descriptors.Waveform.Sine,this.AssetName=null,this.EndPhase=0,this.StartPhase=0,this.LoopEndPhase=0,this.LoopStartPhase=0,this.Offset=0,this.Period=0,this.RootKey=0,this.KeyTrack=0,this.VelTrack=0,this.Tune=0,this.LoopMethod=AlphaSynth.Bank.Components.Generators.LoopMode.NoLoop,this.SamplerType=AlphaSynth.Bank.Descriptors.Waveform.Sine,this.AssetName="null",this.EndPhase=-1,this.StartPhase=-1,this.LoopEndPhase=-1,this.LoopStartPhase=-1,this.Offset=0,this.Period=-1,this.RootKey=-1,this.KeyTrack=100,this.VelTrack=0,this.Tune=0},AlphaSynth.Bank.Descriptors.FilterDescriptor=function(){this.FilterMethod=AlphaSynth.Bank.Components.FilterType.None,this.CutOff=0,this.Resonance=0,this.RootKey=0,this.KeyTrack=0,this.VelTrack=0,this.FilterMethod=AlphaSynth.Bank.Components.FilterType.None,this.CutOff=-1,this.Resonance=1,this.RootKey=60,this.KeyTrack=0,this.VelTrack=0},AlphaSynth.Bank.Descriptors.EnvelopeDescriptor=function(){this.DelayTime=0,this.AttackTime=0,this.AttackGraph=0,this.HoldTime=0,this.DecayTime=0,this.DecayGraph=0,this.SustainTime=0,this.ReleaseTime=0,this.ReleaseGraph=0,this.SustainLevel=0,this.PeakLevel=0,this.StartLevel=0,this.Depth=0,this.Vel2Delay=0,this.Vel2Attack=0,this.Vel2Hold=0,this.Vel2Decay=0,this.Vel2Sustain=0,this.Vel2Release=0,this.Vel2Depth=0,this.DelayTime=0,this.AttackTime=0,this.AttackGraph=1,this.HoldTime=0,this.DecayTime=0,this.DecayGraph=1,this.SustainTime=3600,this.ReleaseTime=0,this.ReleaseGraph=1,this.SustainLevel=0,this.PeakLevel=1,this.StartLevel=0,this.Depth=1,this.Vel2Delay=0,this.Vel2Attack=0,this.Vel2Hold=0,this.Vel2Decay=0,this.Vel2Sustain=0,this.Vel2Release=0,this.Vel2Depth=0},AlphaSynth.Bank.Patch=AlphaSynth.Bank.Patch||{},AlphaSynth.Bank.Patch.Patch=function(t){this.ExclusiveGroupTarget=0,this.ExclusiveGroup=0,this.Name=null,this.Name=t,this.ExclusiveGroup=0,this.ExclusiveGroupTarget=0},AlphaSynth.Bank.Patch.Sf2Patch=function(t){this.iniFilterFc=0,this.filterQ=0,this.initialAttn=0,this.keyOverride=0,this.velOverride=0,this.keynumToModEnvHold=0,this.keynumToModEnvDecay=0,this.keynumToVolEnvHold=0,this.keynumToVolEnvDecay=0,this.pan=null,this.modLfoToPitch=0,this.vibLfoToPitch=0,this.modEnvToPitch=0,this.modLfoToFilterFc=0,this.modEnvToFilterFc=0,this.modLfoToVolume=0,this.gen=null,this.mod_env=null,this.vel_env=null,this.mod_lfo=null,this.vib_lfo=null,this.fltr=null,AlphaSynth.Bank.Patch.Patch.call(this,t)},AlphaSynth.Bank.Patch.Sf2Patch.prototype={Start:function(t){var e=this.keyOverride>-1?this.keyOverride:t.Note;this.velOverride>-1?this.velOverride:t.Velocity;return t.GeneratorParams[0].QuickSetup(this.gen),t.Envelopes[0].QuickSetupSf2(t.SynthParams.Synth.SampleRate,e,this.keynumToModEnvHold,this.keynumToModEnvDecay,!1,this.mod_env),t.Envelopes[1].QuickSetupSf2(t.SynthParams.Synth.SampleRate,e,this.keynumToVolEnvHold,this.keynumToVolEnvDecay,!0,this.vel_env),t.Filters[0].Disable(),t.Lfos[0].QuickSetup(t.SynthParams.Synth.SampleRate,this.mod_lfo),t.Lfos[1].QuickSetup(t.SynthParams.Synth.SampleRate,this.vib_lfo),t.PitchOffset=(e-this.gen.RootKey)*this.gen.KeyTrack+this.gen.Tune,t.PitchOffset+=100*(t.SynthParams.MasterCoarseTune+(t.SynthParams.MasterFineTune.get_Combined()-8192)/8192)|0,t.VolOffset=this.initialAttn,t.VolOffset-=96*AlphaSynth.Bank.Patch.Sf2Patch.CalculateModulator(AlphaSynth.Sf2.SourceTypeEnum.Concave,AlphaSynth.Sf2.TransformEnum.Linear,AlphaSynth.Sf2.DirectionEnum.MaxToMin,AlphaSynth.Sf2.PolarityEnum.Unipolar,t.Velocity,0,127),t.VolOffset-=96*AlphaSynth.Bank.Patch.Sf2Patch.CalculateModulator(AlphaSynth.Sf2.SourceTypeEnum.Concave,AlphaSynth.Sf2.TransformEnum.Linear,AlphaSynth.Sf2.DirectionEnum.MaxToMin,AlphaSynth.Sf2.PolarityEnum.Unipolar,t.SynthParams.Volume.get_Coarse(),0,127),t.GeneratorParams[0].CurrentState!=AlphaSynth.Bank.Components.Generators.GeneratorState.Finished&&t.Envelopes[1].CurrentStage!=AlphaSynth.Bank.Components.EnvelopeState.None},Stop:function(t){this.gen.Release(t.GeneratorParams[0]),this.gen.LoopMode!=AlphaSynth.Bank.Components.Generators.LoopMode.OneShot&&(t.Envelopes[0].Release(1e-38),t.Envelopes[1].ReleaseSf2VolumeEnvelope())},Process:function(t,e,n,a){for(var i=AlphaSynth.Synthesis.SynthHelper.CentsToPitch(t.SynthParams.CurrentPitch)*this.gen.Frequency*AlphaSynth.Synthesis.SynthHelper.CentsToPitch(t.PitchOffset)/t.SynthParams.Synth.SampleRate,h=a?0:t.SynthParams.Synth.MasterVolume*t.SynthParams.CurrentVolume*.35*t.SynthParams.MixVolume,s=e;s<n;s+=128){if(t.Envelopes[0].Increment(64),t.Envelopes[1].Increment(64),t.Lfos[0].Increment(64),t.Lfos[1].Increment(64),this.gen.GetValues(t.GeneratorParams[0],t.BlockBuffer,i*AlphaSynth.Synthesis.SynthHelper.CentsToPitch(t.Envelopes[0].Value*this.modEnvToPitch+t.Lfos[0].Value*this.modLfoToPitch+t.Lfos[1].Value*this.vibLfoToPitch|0)),t.Filters[0].get_Enabled()){var o=t.PData[0].getInt32(0,!0)+t.Lfos[0].Value*this.modLfoToFilterFc+t.Envelopes[0].Value*this.modEnvToFilterFc;o>13500&&(o=13500),t.Filters[0].set_CutOff(AlphaSynth.Synthesis.SynthHelper.KeyToFrequency(o/100,69)),t.Filters[0].CoeffNeedsUpdating?t.Filters[0].ApplyFilterInterp(t.BlockBuffer,t.SynthParams.Synth.SampleRate):t.Filters[0].ApplyFilter(t.BlockBuffer)}var r=AlphaSynth.Synthesis.SynthHelper.DBtoLinear(t.VolOffset+t.Envelopes[1].Value+t.Lfos[0].Value*this.modLfoToVolume)*h;if(t.MixMonoToStereoInterp(s,r*this.pan.Left*t.SynthParams.CurrentPan.Left,r*this.pan.Right*t.SynthParams.CurrentPan.Right),t.Envelopes[1].CurrentStage>AlphaSynth.Bank.Components.EnvelopeState.Hold&&r<=1e-5||t.GeneratorParams[0].CurrentState==AlphaSynth.Bank.Components.Generators.GeneratorState.Finished)return void(t.State=AlphaSynth.Synthesis.VoiceStateEnum.Stopped)}},Load:function(t,e){this.ExclusiveGroup=t.Generators[57],this.ExclusiveGroupTarget=this.ExclusiveGroup,this.iniFilterFc=t.Generators[8],this.filterQ=AlphaSynth.Synthesis.SynthHelper.DBtoLinear(t.Generators[9]/10),this.initialAttn=-t.Generators[48]/10,this.keyOverride=t.Generators[46],this.velOverride=t.Generators[47],this.keynumToModEnvHold=t.Generators[31],this.keynumToModEnvDecay=t.Generators[32],this.keynumToVolEnvHold=t.Generators[39],this.keynumToVolEnvDecay=t.Generators[40],this.pan=new AlphaSynth.Bank.Components.PanComponent,this.pan.SetValue(t.Generators[17]/500,AlphaSynth.Bank.Components.PanFormulaEnum.Neg3dBCenter),this.modLfoToPitch=t.Generators[5],this.vibLfoToPitch=t.Generators[6],this.modEnvToPitch=t.Generators[7],this.modLfoToFilterFc=t.Generators[10],this.modEnvToFilterFc=t.Generators[11],this.modLfoToVolume=t.Generators[13]/10,this.LoadGen(t,e),this.LoadEnvelopes(t),this.LoadLfos(t),this.LoadFilter(t)},LoadGen:function(t,e){var n=e.SampleAssets[t.Generators[53]];switch(this.gen=new AlphaSynth.Bank.Components.Generators.SampleGenerator,this.gen.EndPhase=n.End+t.Generators[1]+32768*t.Generators[12],this.gen.Frequency=n.SampleRate,this.gen.KeyTrack=t.Generators[56],this.gen.LoopEndPhase=n.LoopEnd+t.Generators[3]+32768*t.Generators[50],3&t.Generators[54]){case 0:case 2:this.gen.LoopMode=AlphaSynth.Bank.Components.Generators.LoopMode.NoLoop;break;case 1:this.gen.LoopMode=AlphaSynth.Bank.Components.Generators.LoopMode.Continuous;break;case 3:this.gen.LoopMode=AlphaSynth.Bank.Components.Generators.LoopMode.LoopUntilNoteOff}this.gen.LoopStartPhase=n.LoopStart+t.Generators[2]+32768*t.Generators[45],this.gen.Offset=0,this.gen.Period=1,t.Generators[58]>-1?this.gen.RootKey=t.Generators[58]:this.gen.RootKey=n.RootKey,this.gen.StartPhase=n.Start+t.Generators[0]+32768*t.Generators[4],this.gen.Tune=n.Tune+t.Generators[52]+100*t.Generators[51]|0,this.gen.VelocityTrack=0,this.gen.Samples=n.SampleData},LoadEnvelopes:function(t){this.mod_env=new AlphaSynth.Bank.Descriptors.EnvelopeDescriptor,this.mod_env.AttackTime=Math.pow(2,t.Generators[26]/1200),this.mod_env.AttackGraph=3,this.mod_env.DecayTime=Math.pow(2,t.Generators[28]/1200),this.mod_env.DelayTime=Math.pow(2,t.Generators[25]/1200),this.mod_env.HoldTime=Math.pow(2,t.Generators[27]/1200),this.mod_env.PeakLevel=1,this.mod_env.ReleaseTime=Math.pow(2,t.Generators[30]/1200),this.mod_env.StartLevel=0,this.mod_env.SustainLevel=1-AlphaSynth.Synthesis.SynthHelper.ClampS(t.Generators[29],0,1e3)/1e3,this.mod_env.AttackTime<.001?this.mod_env.AttackTime=.001:this.mod_env.AttackTime>100&&(this.mod_env.AttackTime=100),this.mod_env.DecayTime<.001?this.mod_env.DecayTime=0:this.mod_env.DecayTime>100&&(this.mod_env.DecayTime=100),this.mod_env.DelayTime<.001?this.mod_env.DelayTime=0:this.mod_env.DelayTime>20&&(this.mod_env.DelayTime=20),this.mod_env.HoldTime<.001?this.mod_env.HoldTime=0:this.mod_env.HoldTime>20&&(this.mod_env.HoldTime=20),this.mod_env.ReleaseTime<.001?this.mod_env.ReleaseTime=.001:this.mod_env.ReleaseTime>100&&(this.mod_env.ReleaseTime=100),this.vel_env=new AlphaSynth.Bank.Descriptors.EnvelopeDescriptor,this.vel_env.AttackTime=Math.pow(2,t.Generators[34]/1200),this.vel_env.AttackGraph=3,this.vel_env.DecayTime=Math.pow(2,t.Generators[36]/1200),this.vel_env.DelayTime=Math.pow(2,t.Generators[33]/1200),this.vel_env.HoldTime=Math.pow(2,t.Generators[35]/1200),this.vel_env.PeakLevel=0,this.vel_env.ReleaseTime=Math.pow(2,t.Generators[38]/1200),this.vel_env.StartLevel=-100,this.vel_env.SustainLevel=AlphaSynth.Synthesis.SynthHelper.ClampS(t.Generators[37],0,1e3)/-10,this.vel_env.AttackTime<.001?this.vel_env.AttackTime=.001:this.vel_env.AttackTime>100&&(this.vel_env.AttackTime=100),this.vel_env.DecayTime<.001?this.vel_env.DecayTime=0:this.vel_env.DecayTime>100&&(this.vel_env.DecayTime=100),this.vel_env.DelayTime<.001?this.vel_env.DelayTime=0:this.vel_env.DelayTime>20&&(this.vel_env.DelayTime=20),this.vel_env.HoldTime<.001?this.vel_env.HoldTime=0:this.vel_env.HoldTime>20&&(this.vel_env.HoldTime=20),this.vel_env.ReleaseTime<.001?this.vel_env.ReleaseTime=.001:this.vel_env.ReleaseTime>100&&(this.vel_env.ReleaseTime=100)},LoadLfos:function(t){this.mod_lfo=new AlphaSynth.Bank.Descriptors.LfoDescriptor,this.mod_lfo.DelayTime=Math.pow(2,t.Generators[21]/1200),this.mod_lfo.Frequency=8.176*Math.pow(2,t.Generators[22]/1200),this.mod_lfo.Generator=AlphaSynth.Bank.Components.Generators.DefaultGenerators.DefaultSine,this.vib_lfo=new AlphaSynth.Bank.Descriptors.LfoDescriptor,this.vib_lfo.DelayTime=Math.pow(2,t.Generators[23]/1200),this.vib_lfo.Frequency=8.176*Math.pow(2,t.Generators[24]/1200),this.vib_lfo.Generator=AlphaSynth.Bank.Components.Generators.DefaultGenerators.DefaultSine},LoadFilter:function(t){this.fltr=new AlphaSynth.Bank.Descriptors.FilterDescriptor,this.fltr.FilterMethod=AlphaSynth.Bank.Components.FilterType.BiquadLowpass,this.fltr.CutOff=AlphaSynth.Synthesis.SynthHelper.KeyToFrequency(t.Generators[8]/100,69),this.fltr.Resonance=AlphaSynth.Synthesis.SynthHelper.DBtoLinear(t.Generators[9]/10)}},AlphaSynth.Bank.Patch.Sf2Patch.CalculateModulator=function(t,e,n,a,i,h,s){var o,r=0;switch(i-=h,s-=h,n==AlphaSynth.Sf2.DirectionEnum.MaxToMin&&(i=s-i),t){case AlphaSynth.Sf2.SourceTypeEnum.Linear:r=i/s|0;break;case AlphaSynth.Sf2.SourceTypeEnum.Concave:o=127-i,r=Math.log(o*o/(s*s))/Math.LN10*-.208333333333333;break;case AlphaSynth.Sf2.SourceTypeEnum.Convex:o=i,r=1+Math.log(o*o/(s*s))/Math.LN10*.208333333333333;break;case AlphaSynth.Sf2.SourceTypeEnum.Switch:r=i<=(s/2|0)?0:1}return a==AlphaSynth.Sf2.PolarityEnum.Bipolar&&(r=2*r-1),e==AlphaSynth.Sf2.TransformEnum.AbsoluteValue&&(r=Math.abs(r)),r},$Inherit(AlphaSynth.Bank.Patch.Sf2Patch,AlphaSynth.Bank.Patch.Patch),AlphaSynth.Bank.Patch.MultiPatch=function(t){this._intervalType=AlphaSynth.Bank.Patch.IntervalType.ChannelKeyVelocity,this._intervalList=null,AlphaSynth.Bank.Patch.Patch.call(this,t),this._intervalType=AlphaSynth.Bank.Patch.IntervalType.ChannelKeyVelocity},AlphaSynth.Bank.Patch.MultiPatch.prototype={FindPatches:function(t,e,n,a){var i=0;switch(this._intervalType){case AlphaSynth.Bank.Patch.IntervalType.ChannelKeyVelocity:for(h=0;h<this._intervalList.length&&(!this._intervalList[h].CheckAllIntervals(t,e,n)||(a[i++]=this._intervalList[h].Patch,i!=a.length));h++);break;case AlphaSynth.Bank.Patch.IntervalType.ChannelKey:for(h=0;h<this._intervalList.length&&(!this._intervalList[h].CheckChannelAndKey(t,e)||(a[i++]=this._intervalList[h].Patch,i!=a.length));h++);break;case AlphaSynth.Bank.Patch.IntervalType.KeyVelocity:for(h=0;h<this._intervalList.length&&(!this._intervalList[h].CheckKeyAndVelocity(e,n)||(a[i++]=this._intervalList[h].Patch,i!=a.length));h++);break;case AlphaSynth.Bank.Patch.IntervalType.Key:for(var h=0;h<this._intervalList.length&&(!this._intervalList[h].CheckKey(e)||(a[i++]=this._intervalList[h].Patch,i!=a.length));h++);}return i},Start:function(t){return!1},Process:function(t,e,n,a){},Stop:function(t){},LoadSf2:function(t,e){this._intervalList=new Array(t.length);for(var n=0;n<t.length;n++){var a,i,h,s;AlphaSynth.Platform.TypeUtils.IsLittleEndian?(a=255&t[n].Generators[43],i=255&t[n].Generators[43]>>8,h=255&t[n].Generators[44],s=255&t[n].Generators[44]>>8):(i=255&t[n].Generators[43],a=255&t[n].Generators[43]>>8,s=255&t[n].Generators[44],h=255&t[n].Generators[44]>>8);var o=new AlphaSynth.Bank.Patch.Sf2Patch(this.Name+"_"+n);o.Load(t[n],e),this._intervalList[n]=new AlphaSynth.Bank.Patch.PatchInterval(o,0,15,a,i,h,s)}this.DetermineIntervalType()},DetermineIntervalType:function(){for(var t=!1,e=!1,n=0;n<this._intervalList.length&&(0==this._intervalList[n].StartChannel&&15==this._intervalList[n].EndChannel||!(t=!0)||!e)&&(0==this._intervalList[n].StartVelocity&&127==this._intervalList[n].EndVelocity||(e=!0,!t||!e));n++);this._intervalType=t&e?AlphaSynth.Bank.Patch.IntervalType.ChannelKeyVelocity:t?AlphaSynth.Bank.Patch.IntervalType.ChannelKey:e?AlphaSynth.Bank.Patch.IntervalType.KeyVelocity:AlphaSynth.Bank.Patch.IntervalType.Key}},$Inherit(AlphaSynth.Bank.Patch.MultiPatch,AlphaSynth.Bank.Patch.Patch),AlphaSynth.Bank.Patch.IntervalType={ChannelKeyVelocity:0,ChannelKey:1,KeyVelocity:2,Key:3},AlphaSynth.Bank.Patch.PatchInterval=function(t,e,n,a,i,h,s){this.Patch=null,this.StartChannel=0,this.StartKey=0,this.StartVelocity=0,this.EndChannel=0,this.EndKey=0,this.EndVelocity=0,this.Patch=t,this.StartChannel=e,this.EndChannel=n,this.StartKey=a,this.EndKey=i,this.StartVelocity=h,this.EndVelocity=s},AlphaSynth.Bank.Patch.PatchInterval.prototype={CheckAllIntervals:function(t,e,n){return t>=this.StartChannel&&t<=this.EndChannel&&e>=this.StartKey&&e<=this.EndKey&&n>=this.StartVelocity&&n<=this.EndVelocity},CheckChannelAndKey:function(t,e){return t>=this.StartChannel&&t<=this.EndChannel&&e>=this.StartKey&&e<=this.EndKey},CheckKeyAndVelocity:function(t,e){return t>=this.StartKey&&t<=this.EndKey&&e>=this.StartVelocity&&e<=this.EndVelocity},CheckKey:function(t){return t>=this.StartKey&&t<=this.EndKey}},AlphaSynth.Bank.SampleDataAsset=function(t,e){if(this.Name=null,this.Channels=0,this.SampleRate=0,this.RootKey=0,this.Tune=0,this.Start=0,this.End=0,this.LoopStart=0,this.LoopEnd=0,this.SampleData=null,this.Channels=1,this.Name=t.Name,this.SampleRate=t.SampleRate,this.RootKey=t.RootKey,this.Tune=t.Tune,this.Start=t.Start,this.End=t.End,this.LoopStart=t.StartLoop,this.LoopEnd=t.EndLoop,0!=(t.SoundFontSampleLink&AlphaSynth.Sf2.SFSampleLink.OggVobis))throw $CreateException(new System.Exception.ctor$$String("Ogg Vobis encoded soundfonts not supported"),new Error);this.SampleData=AlphaSynth.Util.PcmData.Create(e.BitsPerSample,e.SampleData,!0)},AlphaSynth.Bank.PatchBank=function(){this._bank=null,this._assets=null,this.Name=null,this.Comments=null,this.Reset()},AlphaSynth.Bank.PatchBank.prototype={Reset:function(){this._bank={},this._assets=new AlphaSynth.Bank.AssetManager,this.Name="",this.Comments=""},get_LoadedBanks:function(){for(var t=[],e=0,n=Object.keys(this._bank),a=n.length,i=n[e];e<a;e++,i=n[e])t.push(AlphaSynth.Platform.Std.ParseInt(i));return t.slice(0)},GetBank:function(t){return this._bank.hasOwnProperty(t)?this._bank[t]:null},GetPatchByNumber:function(t,e){return this._bank.hasOwnProperty(t)?this._bank[t][e]:null},GetPatchByName:function(t,e){if(this._bank.hasOwnProperty(t))for(var n=this._bank[t],a=0,i=n.length,h=n[a];a<i;a++,h=n[a])if(null!=h&&h.Name==e)return h;return null},IsBankLoaded:function(t){return this._bank.hasOwnProperty(t)},LoadSf2:function(t){this.Reset(),AlphaSynth.Util.Logger.Debug("Reading SF2");var e=new AlphaSynth.Sf2.SoundFont;e.Load(t),AlphaSynth.Util.Logger.Debug("Building patchbank"),this.Name=e.Info.BankName,this.Comments=e.Info.Comments;for(var n=0,a=e.Presets.SampleHeaders,i=a.length,h=a[n];n<i;n++,h=a[n])this._assets.SampleAssets.push(new AlphaSynth.Bank.SampleDataAsset(h,e.SampleData));for(var s=this.ReadSf2Instruments(e.Presets.Instruments),o=0,r=e.Presets.PresetHeaders,l=r.length,p=r[o];o<l;o++,p=r[o]){var u,y=null;0==p.Zones[0].Generators.length||p.Zones[0].Generators[p.Zones[0].Generators.length-1].GeneratorType!=AlphaSynth.Sf2.GeneratorEnum.Instrument?(y=p.Zones[0].Generators,u=1):u=0;for(var S=[];u<p.Zones.length;){var d=0,c=127,m=0,f=127;if(p.Zones[u].Generators[0].GeneratorType==AlphaSynth.Sf2.GeneratorEnum.KeyRange?(AlphaSynth.Platform.TypeUtils.IsLittleEndian?(d=255&p.Zones[u].Generators[0].get_AmountInt16(),c=255&p.Zones[u].Generators[0].get_AmountInt16()>>8):(c=255&p.Zones[u].Generators[0].get_AmountInt16(),d=255&p.Zones[u].Generators[0].get_AmountInt16()>>8),p.Zones[u].Generators.length>1&&p.Zones[u].Generators[1].GeneratorType==AlphaSynth.Sf2.GeneratorEnum.VelocityRange&&(AlphaSynth.Platform.TypeUtils.IsLittleEndian?(m=255&p.Zones[u].Generators[1].get_AmountInt16(),f=255&p.Zones[u].Generators[1].get_AmountInt16()>>8):(f=255&p.Zones[u].Generators[1].get_AmountInt16(),m=255&p.Zones[u].Generators[1].get_AmountInt16()>>8))):p.Zones[u].Generators[0].GeneratorType==AlphaSynth.Sf2.GeneratorEnum.VelocityRange&&(AlphaSynth.Platform.TypeUtils.IsLittleEndian?(m=255&p.Zones[u].Generators[0].get_AmountInt16(),f=255&p.Zones[u].Generators[0].get_AmountInt16()>>8):(f=255&p.Zones[u].Generators[0].get_AmountInt16(),m=255&p.Zones[u].Generators[0].get_AmountInt16()>>8)),p.Zones[u].Generators[p.Zones[u].Generators.length-1].GeneratorType==AlphaSynth.Sf2.GeneratorEnum.Instrument)for(var A=s[p.Zones[u].Generators[p.Zones[u].Generators.length-1].get_AmountInt16()],g=0,_=A.length,C=A[g];g<_;g++,C=A[g]){var v,P,k,E;if(AlphaSynth.Platform.TypeUtils.IsLittleEndian?(v=255&C.Generators[43],P=255&C.Generators[43]>>8,k=255&C.Generators[44],E=255&C.Generators[44]>>8):(P=255&C.Generators[43],v=255&C.Generators[43]>>8,E=255&C.Generators[44],k=255&C.Generators[44]>>8),v<=c&&d<=P&&k<=f&&m<=E){var M=new AlphaSynth.Sf2.Sf2Region;AlphaSynth.Platform.Std.ArrayCopy(C.Generators,0,M.Generators,0,M.Generators.length),this.ReadSf2Region(M,y,p.Zones[u].Generators,!0),S.push(M)}}u++}var T=new AlphaSynth.Bank.Patch.MultiPatch(p.Name);T.LoadSf2(S.slice(0),this._assets),this._assets.PatchAssets.push(new AlphaSynth.Bank.PatchAsset(T.Name,T)),this.AssignPatchToBank(T,p.BankNumber,p.PatchNumber,p.PatchNumber)}},ReadSf2Instruments:function(t){for(var e=new Array(t.length),n=0;n<t.length;n++){var a,i=null;0==t[n].Zones[0].Generators.length||t[n].Zones[0].Generators[t[n].Zones[0].Generators.length-1].GeneratorType!=AlphaSynth.Sf2.GeneratorEnum.SampleID?(i=t[n].Zones[0].Generators,a=1):a=0,e[n]=new Array(t[n].Zones.length-a);for(var h=0;h<e[n].length;h++){var s=new AlphaSynth.Sf2.Sf2Region;s.ApplyDefaultValues(),this.ReadSf2Region(s,i,t[n].Zones[h+a].Generators,!1),e[n][h]=s}}return e},ReadSf2Region:function(t,e,n,a){if(a){for(var i=[],h=0,s=n.length,o=n[h];h<s;h++,o=n[h])i.push(o);if(null!=e)for(c=0;c<e.length;c++){for(var r=!1,l=0;l<i.length;l++)if(i[l].GeneratorType==e[c].GeneratorType){r=!0;break}r||i.push(e[c])}for(c=0;c<i.length;c++){var p=i[c].GeneratorType;if(!(p<5||12==p||45==p||46==p||47==p||50==p||54==p||57==p||58==p))if(43==p||44==p){var u,y,S,d;if(AlphaSynth.Platform.TypeUtils.IsLittleEndian?(u=255&t.Generators[p],y=255&t.Generators[p]>>8,S=255&i[c].get_AmountInt16(),d=255&i[c].get_AmountInt16()>>8):(y=255&t.Generators[p],u=255&t.Generators[p]>>8,d=255&i[c].get_AmountInt16(),S=255&i[c].get_AmountInt16()>>8),u=Math.max(u,S),y=Math.min(y,d),u>y)throw $CreateException(new System.Exception.ctor$$String("Invalid sf2 region. The range generators do not intersect."),new Error);AlphaSynth.Platform.TypeUtils.IsLittleEndian?t.Generators[p]=AlphaSynth.Platform.TypeUtils.ToInt16(u|y<<8):t.Generators[p]=AlphaSynth.Platform.TypeUtils.ToInt16(u<<8|y)}else t.Generators[p]=AlphaSynth.Platform.TypeUtils.ToInt16(t.Generators[p]+i[c].get_AmountInt16())}}else{if(null!=e)for(c=0;c<e.length;c++)t.Generators[e[c].GeneratorType]=e[c].get_AmountInt16();for(var c=0;c<n.length;c++)t.Generators[n[c].GeneratorType]=n[c].get_AmountInt16()}},AssignPatchToBank:function(t,e,n,a){if(!(e<0)){if(n>a){var i=n;n=a,a=i}if(n<0||n>=128)throw $CreateException(new System.Exception.ctor$$String("startRange out of range"),new Error);if(a<0||a>=128)throw $CreateException(new System.Exception.ctor$$String("endRange out of range"),new Error);var h;this._bank.hasOwnProperty(e)?h=this._bank[e]:(h=new Array(128),this._bank[e]=h);for(var s=n;s<=a;s++)h[s]=t}}},$StaticConstructor(function(){AlphaSynth.Bank.PatchBank.DrumBank=128,AlphaSynth.Bank.PatchBank.BankSize=128}),AlphaSynth.Bank.PatchAsset=function(t,e){this.Name=null,this.Patch=null,this.Name=t,this.Patch=e},AlphaSynth.Ds=AlphaSynth.Ds||{},AlphaSynth.Ds.LinkedList=function(){this.First=null,this.Length=0,this.Length=0},AlphaSynth.Ds.LinkedList.prototype={AddFirst:function(t){var e=new AlphaSynth.Ds.LinkedListNode;e.Value=t,null==this.First?this.InsertNodeToEmptyList(e):(this.InsertNodeBefore(this.First,e),this.First=e)},AddLast:function(t){var e=new AlphaSynth.Ds.LinkedListNode;e.Value=t,null==this.First?this.InsertNodeToEmptyList(e):this.InsertNodeBefore(this.First,e)},RemoveFirst:function(){if(null==this.First)return null;var t=this.First.Value;return this.Remove(this.First),t},RemoveLast:function(){if(null==this.First)return null;var t=null!=this.First._prev?this.First._prev.Value:null;return this.Remove(this.First._prev),t},Remove:function(t){t._next==t?this.First=null:(t._next._prev=t._prev,t._prev._next=t._next,this.First==t&&(this.First=t._next)),t.Invalidate(),this.Length--},InsertNodeBefore:function(t,e){e._next=t,e._prev=t._prev,t._prev._next=e,t._prev=e,e._list=this,this.Length++},InsertNodeToEmptyList:function(t){t._next=t,t._prev=t,t._list=this,this.First=t,this.Length++}},AlphaSynth.Ds.LinkedListNode=function(){this._list=null,this._next=null,this._prev=null,this.Value=null},AlphaSynth.Ds.LinkedListNode.prototype={get_Next:function(){return null==this._next||this._list.First==this._next?null:this._next},get_Prev:function(){return null==this._prev||this==this._list.First?null:this._prev},Invalidate:function(){this._list=null,this._next=null,this._prev=null}},AlphaSynth.Ds.CircularSampleBuffer=function(t){this._buffer=null,this._writePosition=0,this._readPosition=0,this._sampleCount=0,this._buffer=new Float32Array(t),this._writePosition=0,this._readPosition=0,this._sampleCount=0},AlphaSynth.Ds.CircularSampleBuffer.prototype={get_Count:function(){return this._sampleCount},Clear:function(){this._readPosition=0,this._writePosition=0,this._sampleCount=0,this._buffer=new Float32Array(this._buffer.length)},Write:function(t,e,n){var a=0;n>this._buffer.length-this._sampleCount&&(n=this._buffer.length-this._sampleCount);var i=Math.min(this._buffer.length-this._writePosition,n);return this._buffer.set(t.subarray(e,e+i),this._writePosition),this._writePosition+=i,this._writePosition%=this._buffer.length,(a+=i)<n&&(this._buffer.set(t.subarray(e+a,e+a+n-a),this._writePosition),this._writePosition+=n-a,a=n),this._sampleCount+=a,a},Read:function(t,e,n){n>this._sampleCount&&(n=this._sampleCount);var a=0,i=Math.min(this._buffer.length-this._readPosition,n);return t.set(this._buffer.subarray(this._readPosition,this._readPosition+i),e),a+=i,this._readPosition+=i,this._readPosition%=this._buffer.length,a<n&&(t.set(this._buffer.subarray(this._readPosition,this._readPosition+n-a),e+a),this._readPosition+=n-a,a=n),this._sampleCount-=a,a}},AlphaSynth.IO=AlphaSynth.IO||{},AlphaSynth.IO.ByteBuffer=function(){this._buffer=null,this._capacity=0,this.Length=0,this.Position=0},AlphaSynth.IO.ByteBuffer.prototype={GetBuffer:function(){return this._buffer},Reset:function(){this.Position=0},Skip:function(t){this.Position+=t},SetCapacity:function(t){if(t!=this._capacity){if(t>0){var e=new Uint8Array(t);this.Length>0&&e.set(this._buffer.subarray(0,0+this.Length),0),this._buffer=e}else this._buffer=null;this._capacity=t}},ReadByte:function(){if(this.Length-this.Position<=0)return-1;var t=this._buffer[this.Position];return this.Position++,t},Read:function(t,e,n){var a=this.Length-this.Position;if(a>n&&(a=n),a<=0)return 0;if(a<=8)for(var i=a;--i>=0;)t[e+i]=this._buffer[this.Position+i];else t.set(this._buffer.subarray(this.Position,this.Position+a),e);return this.Position+=a,a},ToArray:function(){var t=new Uint8Array(this.Length);return t.set(this._buffer.subarray(0,0+this.Length),0),t}},AlphaSynth.IO.ByteBuffer.Empty=function(){return AlphaSynth.IO.ByteBuffer.WithCapactiy(0)},AlphaSynth.IO.ByteBuffer.WithCapactiy=function(t){var e=new AlphaSynth.IO.ByteBuffer;return e._buffer=new Uint8Array(t),e._capacity=t,e},AlphaSynth.IO.ByteBuffer.FromBuffer=function(t){var e=new AlphaSynth.IO.ByteBuffer;return e._buffer=t,e._capacity=e.Length=t.length,e},AlphaSynth.MidiFileSequencer=function(t){this._synthesizer=null,this._tempoChanges=null,this._firstProgramEventPerChannel=null,this._synthData=null,this._division=0,this._eventIndex=0,this._currentTime=0,this._playbackRange=null,this._playbackRangeStartTime=0,this._playbackRangeEndTime=0,this._endTime=0,this.Finished=null,this.IsLooping=!1,this.EndTick=0,this.PlaybackSpeed=0,this._synthesizer=t,this._firstProgramEventPerChannel={},this._tempoChanges=[],this.PlaybackSpeed=1},AlphaSynth.MidiFileSequencer.prototype={get_PlaybackRange:function(){return this._playbackRange},set_PlaybackRange:function(t){this._playbackRange=t,null!=t&&(this._playbackRangeStartTime=this.TickPositionToTimePositionWithSpeed(t.StartTick,1),this._playbackRangeEndTime=this.TickPositionToTimePositionWithSpeed(t.EndTick,1))},get_EndTime:function(){return this._endTime/this.PlaybackSpeed},Seek:function(t){t<0&&(t=0),t*=this.PlaybackSpeed,null!=this.get_PlaybackRange()&&(t<this._playbackRangeStartTime?t=this._playbackRangeStartTime:t>this._playbackRangeEndTime&&(t=this._playbackRangeEndTime)),t>this._currentTime?this.SilentProcess(t-this._currentTime):t<this._currentTime&&(this._currentTime=0,this._eventIndex=0,this._synthesizer.NoteOffAll(!0),this._synthesizer.ResetPrograms(),this._synthesizer.ResetSynthControls(),this.SilentProcess(t))},SilentProcess:function(t){if(!(t<=0))for(this._currentTime+=t;this._eventIndex<this._synthData.length&&this._synthData[this._eventIndex].Delta<this._currentTime;){var e=this._synthData[this._eventIndex];e.IsMetronome||this._synthesizer.ProcessMidiMessage(e.Event),this._eventIndex++}},LoadMidi:function(t){this._tempoChanges=[],(t.Tracks.length>1||0==t.Tracks[0].EndTime)&&t.CombineTracks(),this._division=t.Division,this._eventIndex=0,this._currentTime=0,this._synthData=[];for(var e=120,n=0,a=0,i=0,h=0,s=0,o=0;o<t.Tracks[0].MidiEvents.length;o++){var r=t.Tracks[0].MidiEvents[o],l=new AlphaSynth.Synthesis.SynthEvent(r);if(this._synthData.push(l),n+=r.DeltaTime,a+=r.DeltaTime*(6e4/(e*t.Division)),l.Delta=a,r.get_Command()==AlphaSynth.Midi.Event.MidiEventTypeEnum.Meta&&81==r.get_Data1())e=6e7/(p=r).Value,this._tempoChanges.push(new AlphaSynth.MidiFileSequencerTempoChange(e,n,0|a));else if(r.get_Command()==AlphaSynth.Midi.Event.MidiEventTypeEnum.Meta&&88==r.get_Data1()){var p=r,u=0|Math.pow(2,p.Data[1]);i=this._division*(4/u)|0}else if(r.get_Command()==AlphaSynth.Midi.Event.MidiEventTypeEnum.ProgramChange){var y=r.get_Channel();this._firstProgramEventPerChannel.hasOwnProperty(y)||(this._firstProgramEventPerChannel[y]=l)}if(i>0)for(;h<n;){var S=AlphaSynth.Synthesis.SynthEvent.NewMetronomeEvent(i);this._synthData.push(S),S.Delta=s,h+=i,s+=i*(6e4/(e*t.Division))}}this._synthData.sort($CreateAnonymousDelegate(this,function(t,e){return t.Delta-e.Delta|0})),this._endTime=a,this.EndTick=n},FillMidiEventQueue:function(){for(var t=this._synthesizer.MicroBufferSize/this._synthesizer.SampleRate*1e3*this.PlaybackSpeed,e=0;e<this._synthesizer.MicroBufferCount;e++)for(this._currentTime+=t;this._eventIndex<this._synthData.length&&this._synthData[this._eventIndex].Delta<this._currentTime;)this._synthesizer.DispatchEvent(e,this._synthData[this._eventIndex]),this._eventIndex++},TickPositionToTimePosition:function(t){return this.TickPositionToTimePositionWithSpeed(t,this.PlaybackSpeed)},TimePositionToTickPosition:function(t){return this.TimePositionToTickPositionWithSpeed(t,this.PlaybackSpeed)},TickPositionToTimePositionWithSpeed:function(t,e){for(var n=0,a=120,i=0,h=0;h<this._tempoChanges.length;h++){var s=this._tempoChanges[h];if(t<s.Ticks)break;n=s.Time,a=s.Bpm,i=s.Ticks}return t-=i,(n+=t*(6e4/(a*this._division)))/e},TimePositionToTickPositionWithSpeed:function(t,e){t*=e;for(var n=0,a=120,i=0,h=0;h<this._tempoChanges.length;h++){var s=this._tempoChanges[h];if(t<s.Time)break;n=s.Ticks,a=s.Bpm,i=s.Time}return t-=i,(n+=t/(6e4/(a*this._division))|0)+1},add_Finished:function(t){this.Finished=$CombineDelegates(this.Finished,t)},remove_Finished:function(t){this.Finished=$RemoveDelegate(this.Finished,t)},OnFinished:function(){var t=this.Finished;null!=t&&t()},CheckForStop:function(){null==this.get_PlaybackRange()&&this._currentTime>=this._endTime?(this._currentTime=0,this._eventIndex=0,this._synthesizer.NoteOffAll(!0),this._synthesizer.ResetPrograms(),this._synthesizer.ResetSynthControls(),this.OnFinished()):null!=this.get_PlaybackRange()&&this._currentTime>=this._playbackRangeEndTime&&(this._currentTime=this.get_PlaybackRange().StartTick,this._eventIndex=0,this._synthesizer.NoteOffAll(!0),this._synthesizer.ResetPrograms(),this._synthesizer.ResetSynthControls(),this.OnFinished())},SetChannelProgram:function(t,e){this._firstProgramEventPerChannel.hasOwnProperty(t)&&this._firstProgramEventPerChannel[t].Event.set_Data1(e)}},AlphaSynth.MidiFileSequencerTempoChange=function(t,e,n){this.Bpm=0,this.Ticks=0,this.Time=0,this.Bpm=t,this.Ticks=e,this.Time=n},AlphaSynth.Midi=AlphaSynth.Midi||{},AlphaSynth.Midi.Event=AlphaSynth.Midi.Event||{},AlphaSynth.Midi.Event.MidiEvent=function(t,e,n,a){this.Message=0,this.DeltaTime=0,this.DeltaTime=t,this.Message=e|n<<8|a<<16},AlphaSynth.Midi.Event.MidiEvent.prototype={get_Channel:function(){return 15&this.Message},get_Command:function(){return 240&this.Message},get_Data1:function(){return(65280&this.Message)>>8},set_Data1:function(t){this.Message&=-65281,this.Message|=t<<8},get_Data2:function(){return(16711680&this.Message)>>16},set_Data2:function(t){this.Message&=-16711681,this.Message|=t<<16}},AlphaSynth.Midi.Event.SystemCommonEvent=function(t,e,n,a){AlphaSynth.Midi.Event.MidiEvent.call(this,t,e,n,a)},AlphaSynth.Midi.Event.SystemCommonEvent.prototype={get_Channel:function(){return-1},get_Command:function(){return 255&this.Message}},$Inherit(AlphaSynth.Midi.Event.SystemCommonEvent,AlphaSynth.Midi.Event.MidiEvent),AlphaSynth.Midi.Event.SystemExclusiveEvent=function(t,e,n,a){this.Data=null,AlphaSynth.Midi.Event.SystemCommonEvent.call(this,t,e,255&n,n>>8),this.Data=a},AlphaSynth.Midi.Event.SystemExclusiveEvent.prototype={get_ManufacturerId:function(){return this.Message>>8}},$Inherit(AlphaSynth.Midi.Event.SystemExclusiveEvent,AlphaSynth.Midi.Event.SystemCommonEvent),AlphaSynth.Midi.Event.SystemCommonTypeEnum={SystemExclusive:240,MtcQuarterFrame:241,SongPosition:242,SongSelect:243,TuneRequest:246,SystemExclusive2:247},AlphaSynth.Midi.Event.RealTimeTypeEnum={MidiClock:248,MidiTick:249,MidiStart:250,MidiContinue:252,MidiStop:253,ActiveSense:254,Reset:255},AlphaSynth.Midi.Event.RealTimeEvent=function(t,e,n,a){AlphaSynth.Midi.Event.MidiEvent.call(this,t,e,n,a)},AlphaSynth.Midi.Event.RealTimeEvent.prototype={get_Channel:function(){return-1},get_Command:function(){return 255&this.Message}},$Inherit(AlphaSynth.Midi.Event.RealTimeEvent,AlphaSynth.Midi.Event.MidiEvent),AlphaSynth.Midi.Event.MidiEventTypeEnum={NoteOff:128,NoteOn:144,NoteAftertouch:160,Controller:176,ProgramChange:192,ChannelAftertouch:208,PitchBend:224,Meta:255},AlphaSynth.Midi.Event.ControllerTypeEnum={BankSelectCoarse:0,ModulationCoarse:1,BreathControllerCoarse:2,FootControllerCoarse:4,PortamentoTimeCoarse:5,DataEntryCoarse:6,VolumeCoarse:7,BalanceCoarse:8,PanCoarse:10,ExpressionControllerCoarse:11,EffectControl1Coarse:12,EffectControl2Coarse:13,GeneralPurposeSlider1:16,GeneralPurposeSlider2:17,GeneralPurposeSlider3:18,GeneralPurposeSlider4:19,BankSelectFine:32,ModulationFine:33,BreathControllerFine:34,FootControllerFine:36,PortamentoTimeFine:37,DataEntryFine:38,VolumeFine:39,BalanceFine:40,PanFine:42,ExpressionControllerFine:43,EffectControl1Fine:44,EffectControl2Fine:45,HoldPedal:64,Portamento:65,SostenutoPedal:66,SoftPedal:67,LegatoPedal:68,Hold2Pedal:69,SoundVariation:70,SoundTimbre:71,SoundReleaseTime:72,SoundAttackTime:73,SoundBrightness:74,SoundControl6:75,SoundControl7:76,SoundControl8:77,SoundControl9:78,SoundControl10:79,GeneralPurposeButton1:80,GeneralPurposeButton2:81,GeneralPurposeButton3:82,GeneralPurposeButton4:83,EffectsLevel:91,TremuloLevel:92,ChorusLevel:93,CelesteLevel:94,PhaseLevel:95,DataButtonIncrement:96,DataButtonDecrement:97,NonRegisteredParameterFine:98,NonRegisteredParameterCourse:99,RegisteredParameterFine:100,RegisteredParameterCourse:101,AllSoundOff:120,ResetControllers:121,LocalKeyboard:122,AllNotesOff:123,OmniModeOff:124,OmniModeOn:125,MonoMode:126,PolyMode:127},AlphaSynth.Midi.Event.MetaEvent=function(t,e,n,a){AlphaSynth.Midi.Event.MidiEvent.call(this,t,e,n,a)},AlphaSynth.Midi.Event.MetaEvent.prototype={get_Channel:function(){return-1},get_Command:function(){return 255&this.Message},get_MetaStatus:function(){return this.get_Data1()}},$Inherit(AlphaSynth.Midi.Event.MetaEvent,AlphaSynth.Midi.Event.MidiEvent),AlphaSynth.Midi.Event.MetaTextEvent=function(t,e,n,a){this.Text=null,AlphaSynth.Midi.Event.MetaEvent.call(this,t,e,n,0),this.Text=a},$Inherit(AlphaSynth.Midi.Event.MetaTextEvent,AlphaSynth.Midi.Event.MetaEvent),AlphaSynth.Midi.Event.MetaNumberEvent=function(t,e,n,a){this.Value=0,AlphaSynth.Midi.Event.MetaEvent.call(this,t,e,n,0),this.Value=a},$Inherit(AlphaSynth.Midi.Event.MetaNumberEvent,AlphaSynth.Midi.Event.MetaEvent),AlphaSynth.Midi.Event.MetaEventTypeEnum={SequenceNumber:0,TextEvent:1,CopyrightNotice:2,SequenceOrTrackName:3,InstrumentName:4,LyricText:5,MarkerText:6,CuePoint:7,PatchName:8,PortName:9,MidiChannel:32,MidiPort:33,EndOfTrack:47,Tempo:81,SmpteOffset:84,TimeSignature:88,KeySignature:89,SequencerSpecific:127},AlphaSynth.Midi.Event.MetaDataEvent=function(t,e,n,a){this.Data=null,AlphaSynth.Midi.Event.MetaEvent.call(this,t,e,n,0),this.Data=a},$Inherit(AlphaSynth.Midi.Event.MetaDataEvent,AlphaSynth.Midi.Event.MetaEvent),AlphaSynth.Midi.MidiTrack=function(t,e,n,a){this.Instruments=null,this.DrumInstruments=null,this.ActiveChannels=null,this.MidiEvents=null,this.NoteOnCount=0,this.EndTime=0,this.Instruments=t,this.DrumInstruments=e,this.ActiveChannels=n,this.MidiEvents=a,this.NoteOnCount=0,this.EndTime=0},AlphaSynth.Midi.MidiHelper=function(){},$StaticConstructor(function(){AlphaSynth.Midi.MidiHelper.MicroSecondsPerMinute=6e7,AlphaSynth.Midi.MidiHelper.MinChannel=0,AlphaSynth.Midi.MidiHelper.MaxChannel=15,AlphaSynth.Midi.MidiHelper.DrumChannel=9}),AlphaSynth.Midi.MidiFile=function(){this.Division=0,this.TrackFormat=AlphaSynth.Midi.MidiTrackFormat.SingleTrack,this.TimingStandard=AlphaSynth.Midi.MidiTimeFormat.TicksPerBeat,this.Tracks=null,this.Division=0,this.TrackFormat=AlphaSynth.Midi.MidiTrackFormat.SingleTrack,this.TimingStandard=AlphaSynth.Midi.MidiTimeFormat.TicksPerBeat},AlphaSynth.Midi.MidiFile.prototype={CombineTracks:function(){for(var t=this.MergeTracks(),e=new Array(this.Tracks.length),n=0;n<this.Tracks.length;n++){e[n]=new Array(this.Tracks[n].MidiEvents.length);for(var a=0,i=0;i<this.Tracks[n].MidiEvents.length;i++)e[n][i]=this.Tracks[n].MidiEvents[i],a+=e[n][i].DeltaTime,e[n][i].DeltaTime=a}var h=0,s=0,o=2147483647,r=new Int32Array(e.length);for(AlphaSynth.Platform.TypeUtils.ClearIntArray(r);h<t.MidiEvents.length;){for(p=0;p<e.length;p++){for(;r[p]<e[p].length&&e[p][r[p]].DeltaTime==s;)t.MidiEvents[h]=e[p][r[p]],h++,r[p]++;r[p]<e[p].length&&e[p][r[p]].DeltaTime<o&&(o=e[p][r[p]].DeltaTime)}s=o,o=2147483647}t.EndTime=t.MidiEvents[t.MidiEvents.length-1].DeltaTime;for(var l=0,p=0;p<t.MidiEvents.length;p++){var u=t.MidiEvents[p].DeltaTime;t.MidiEvents[p].DeltaTime-=l,l=u}this.Tracks=[t],this.TrackFormat=AlphaSynth.Midi.MidiTrackFormat.SingleTrack},MergeTracks:function(){for(var t=0,e=0,n=[],a=[],i=[],h=0;h<this.Tracks.length;h++){t+=this.Tracks[h].MidiEvents.length,e+=this.Tracks[h].NoteOnCount;for(s=0;s<this.Tracks[h].Instruments.length;s++){o=this.Tracks[h].Instruments[s];-1==Array.prototype.indexOf.call(n,o)&&n.push(o)}for(s=0;s<this.Tracks[h].DrumInstruments.length;s++){o=this.Tracks[h].DrumInstruments[s];-1==Array.prototype.indexOf.call(a,o)&&a.push(o)}for(var s=0;s<this.Tracks[h].ActiveChannels.length;s++){var o=this.Tracks[h].ActiveChannels[s];-1==Array.prototype.indexOf.call(i,o)&&i.push(o)}}var r=new AlphaSynth.Midi.MidiTrack(n.slice(0),a.slice(0),i.slice(0),new Array(t));return r.NoteOnCount=e,r},Load:function(t){if(!this.FindHead(t,500))throw $CreateException(new System.Exception.ctor$$String("Invalid midi file : MThd chunk could not be found."),new Error);this.ReadHeader(t);for(var e=0;e<this.Tracks.length;e++)this.Tracks[e]=this.ReadTrack(t)},FindHead:function(t,e){for(var n=0;e>0;){switch(t.ReadByte()){case 77:n=1;break;case 84:n=1==n?2:0;break;case 104:n=2==n?3:0;break;case 100:if(3==n)return!0;n=0}e--}return!1},ReadHeader:function(t){if(6!=AlphaSynth.Util.IOHelper.ReadInt32BE(t))throw $CreateException(new System.Exception.ctor$$String("Midi header is invalid."),new Error);this.TrackFormat=AlphaSynth.Util.IOHelper.ReadInt16BE(t),this.Tracks=new Array(AlphaSynth.Util.IOHelper.ReadInt16BE(t));var e=AlphaSynth.Util.IOHelper.ReadInt16BE(t);this.Division=32767&e,this.TimingStandard=(32768&e)>0?AlphaSynth.Midi.MidiTimeFormat.FramesPerSecond:AlphaSynth.Midi.MidiTimeFormat.TicksPerBeat},ReadTrack:function(t){for(var e=[],n=[],a=[],i=[],h=0,s=0;"MTrk"!=AlphaSynth.Util.IOHelper.Read8BitChars(t,4);)for(var o=AlphaSynth.Util.IOHelper.ReadInt32BE(t);o>0;)o--,t.ReadByte();for(var r=AlphaSynth.Util.IOHelper.ReadInt32BE(t)+t.Position,l=0;t.Position<r;){var p=AlphaSynth.Midi.MidiFile.ReadVariableLength(t);s+=p;var u=t.ReadByte();if(u>=128&&u<=239)l=u,i.push(AlphaSynth.Midi.MidiFile.ReadVoiceMessage(t,p,u,t.ReadByte())),h=AlphaSynth.Midi.MidiFile.TrackVoiceStats(i[i.length-1],e,n,a,h);else if(u>=240&&u<=247)l=0,i.push(AlphaSynth.Midi.MidiFile.ReadSystemCommonMessage(t,p,u));else if(u>=248&&u<=255)i.push(AlphaSynth.Midi.MidiFile.ReadRealTimeMessage(t,p,u));else if(0==l){for(;128!=(128&u);)u=t.ReadByte();u>=128&&u<=239?(l=u,i.push(AlphaSynth.Midi.MidiFile.ReadVoiceMessage(t,p,u,t.ReadByte())),h=AlphaSynth.Midi.MidiFile.TrackVoiceStats(i[i.length-1],e,n,a,h)):u>=240&&u<=247?i.push(AlphaSynth.Midi.MidiFile.ReadSystemCommonMessage(t,p,u)):u>=248&&u<=255&&i.push(AlphaSynth.Midi.MidiFile.ReadRealTimeMessage(t,p,u))}else i.push(AlphaSynth.Midi.MidiFile.ReadVoiceMessage(t,p,l,u)),h=AlphaSynth.Midi.MidiFile.TrackVoiceStats(i[i.length-1],e,n,a,h)}if(t.Position!=r)throw $CreateException(new System.Exception.ctor$$String("The track length was invalid for the current MTrk chunk."),new Error);-1!=Array.prototype.indexOf.call(a,9)?-1==Array.prototype.indexOf.call(n,0)&&n.push(0):-1==Array.prototype.indexOf.call(e,0)&&e.push(0);var y=new AlphaSynth.Midi.MidiTrack(e.slice(0),n.slice(0),a.slice(0),i.slice(0));return y.NoteOnCount=h,y.EndTime=s,y}},AlphaSynth.Midi.MidiFile.ReadMetaMessage=function(t,e,n){var a=t.ReadByte();switch(a){case AlphaSynth.Midi.Event.MetaEventTypeEnum.SequenceNumber:var i=t.ReadByte();if(0==i)return new AlphaSynth.Midi.Event.MetaNumberEvent(e,n,a,-1);if(2==i)return new AlphaSynth.Midi.Event.MetaNumberEvent(e,n,a,AlphaSynth.Util.IOHelper.ReadInt16BE(t));throw $CreateException(new System.Exception.ctor$$String("Invalid sequence number event."),new Error);case AlphaSynth.Midi.Event.MetaEventTypeEnum.TextEvent:case AlphaSynth.Midi.Event.MetaEventTypeEnum.CopyrightNotice:case AlphaSynth.Midi.Event.MetaEventTypeEnum.SequenceOrTrackName:case AlphaSynth.Midi.Event.MetaEventTypeEnum.InstrumentName:case AlphaSynth.Midi.Event.MetaEventTypeEnum.LyricText:case AlphaSynth.Midi.Event.MetaEventTypeEnum.MarkerText:case AlphaSynth.Midi.Event.MetaEventTypeEnum.CuePoint:case AlphaSynth.Midi.Event.MetaEventTypeEnum.PatchName:case AlphaSynth.Midi.Event.MetaEventTypeEnum.PortName:return new AlphaSynth.Midi.Event.MetaTextEvent(e,n,a,AlphaSynth.Midi.MidiFile.ReadString(t));case AlphaSynth.Midi.Event.MetaEventTypeEnum.MidiChannel:if(1!=t.ReadByte())throw $CreateException(new System.Exception.ctor$$String("Invalid midi channel event. Expected size of 1."),new Error);return new AlphaSynth.Midi.Event.MetaEvent(e,n,a,t.ReadByte());case AlphaSynth.Midi.Event.MetaEventTypeEnum.MidiPort:if(1!=t.ReadByte())throw $CreateException(new System.Exception.ctor$$String("Invalid midi port event. Expected size of 1."),new Error);return new AlphaSynth.Midi.Event.MetaEvent(e,n,a,t.ReadByte());case AlphaSynth.Midi.Event.MetaEventTypeEnum.EndOfTrack:return new AlphaSynth.Midi.Event.MetaEvent(e,n,a,t.ReadByte());case AlphaSynth.Midi.Event.MetaEventTypeEnum.Tempo:if(3!=t.ReadByte())throw $CreateException(new System.Exception.ctor$$String("Invalid tempo event. Expected size of 3."),new Error);return new AlphaSynth.Midi.Event.MetaNumberEvent(e,n,a,t.ReadByte()<<16|t.ReadByte()<<8|t.ReadByte());case AlphaSynth.Midi.Event.MetaEventTypeEnum.SmpteOffset:if(5!=t.ReadByte())throw $CreateException(new System.Exception.ctor$$String("Invalid smpte event. Expected size of 5."),new Error);return new AlphaSynth.Midi.Event.MetaTextEvent(e,n,a,t.ReadByte()+":"+t.ReadByte()+":"+t.ReadByte()+":"+t.ReadByte()+":"+t.ReadByte());case AlphaSynth.Midi.Event.MetaEventTypeEnum.TimeSignature:if(4!=t.ReadByte())throw $CreateException(new System.Exception.ctor$$String("Invalid time signature event. Expected size of 4."),new Error);return new AlphaSynth.Midi.Event.MetaDataEvent(e,n,a,new Uint8Array([t.ReadByte(),t.ReadByte(),t.ReadByte(),t.ReadByte()]));case AlphaSynth.Midi.Event.MetaEventTypeEnum.KeySignature:if(2!=t.ReadByte())throw $CreateException(new System.Exception.ctor$$String("Invalid key signature event. Expected size of 2."),new Error);return new AlphaSynth.Midi.Event.MetaTextEvent(e,n,a,t.ReadByte()+":"+t.ReadByte());case AlphaSynth.Midi.Event.MetaEventTypeEnum.SequencerSpecific:var h=AlphaSynth.Midi.MidiFile.ReadVariableLength(t),s=AlphaSynth.Util.IOHelper.ReadByteArray(t,h);return new AlphaSynth.Midi.Event.MetaDataEvent(e,n,a,s)}throw $CreateException(new System.Exception.ctor$$String("Not a valid meta message Status: "+n+" Meta: "+a),new Error)},AlphaSynth.Midi.MidiFile.ReadRealTimeMessage=function(t,e,n){switch(n){case AlphaSynth.Midi.Event.RealTimeTypeEnum.MidiClock:case AlphaSynth.Midi.Event.RealTimeTypeEnum.MidiTick:case AlphaSynth.Midi.Event.RealTimeTypeEnum.MidiStart:case AlphaSynth.Midi.Event.RealTimeTypeEnum.MidiContinue:case AlphaSynth.Midi.Event.RealTimeTypeEnum.MidiStop:case AlphaSynth.Midi.Event.RealTimeTypeEnum.ActiveSense:return new AlphaSynth.Midi.Event.RealTimeEvent(e,n,0,0);case AlphaSynth.Midi.Event.RealTimeTypeEnum.Reset:return AlphaSynth.Midi.MidiFile.ReadMetaMessage(t,e,n);default:throw $CreateException(new System.Exception.ctor$$String("The real time message was invalid or unsupported : "+n),new Error)}},AlphaSynth.Midi.MidiFile.ReadSystemCommonMessage=function(t,e,n){switch(n){case AlphaSynth.Midi.Event.SystemCommonTypeEnum.SystemExclusive2:case AlphaSynth.Midi.Event.SystemCommonTypeEnum.SystemExclusive:var a=AlphaSynth.Util.IOHelper.ReadInt16BE(t);if(0==a)a=AlphaSynth.Util.IOHelper.ReadInt16BE(t);else if(247==a)return null;for(var i=[],h=t.ReadByte();247!=h;)i.push(h),h=t.ReadByte();return new AlphaSynth.Midi.Event.SystemExclusiveEvent(e,n,a,i.slice(0));case AlphaSynth.Midi.Event.SystemCommonTypeEnum.MtcQuarterFrame:return new AlphaSynth.Midi.Event.SystemCommonEvent(e,n,t.ReadByte(),0);case AlphaSynth.Midi.Event.SystemCommonTypeEnum.SongPosition:return new AlphaSynth.Midi.Event.SystemCommonEvent(e,n,t.ReadByte(),t.ReadByte());case AlphaSynth.Midi.Event.SystemCommonTypeEnum.SongSelect:return new AlphaSynth.Midi.Event.SystemCommonEvent(e,n,t.ReadByte(),0);case AlphaSynth.Midi.Event.SystemCommonTypeEnum.TuneRequest:return new AlphaSynth.Midi.Event.SystemCommonEvent(e,n,0,0);default:throw $CreateException(new System.Exception.ctor$$String("The system common message was invalid or unsupported : "+n),new Error)}},AlphaSynth.Midi.MidiFile.ReadVoiceMessage=function(t,e,n,a){switch(240&n){case AlphaSynth.Midi.Event.MidiEventTypeEnum.NoteOff:return new AlphaSynth.Midi.Event.MidiEvent(e,n,a,t.ReadByte());case AlphaSynth.Midi.Event.MidiEventTypeEnum.NoteOn:var i=t.ReadByte();return 0==i&&(n=15&n|128),new AlphaSynth.Midi.Event.MidiEvent(e,n,a,i);case AlphaSynth.Midi.Event.MidiEventTypeEnum.NoteAftertouch:case AlphaSynth.Midi.Event.MidiEventTypeEnum.Controller:return new AlphaSynth.Midi.Event.MidiEvent(e,n,a,t.ReadByte());case AlphaSynth.Midi.Event.MidiEventTypeEnum.ProgramChange:case AlphaSynth.Midi.Event.MidiEventTypeEnum.ChannelAftertouch:return new AlphaSynth.Midi.Event.MidiEvent(e,n,a,0);case AlphaSynth.Midi.Event.MidiEventTypeEnum.PitchBend:return new AlphaSynth.Midi.Event.MidiEvent(e,n,a,t.ReadByte());default:throw $CreateException(new System.Exception.ctor$$String("The status provided was not that of a voice message."),new Error)}},AlphaSynth.Midi.MidiFile.TrackVoiceStats=function(t,e,n,a,i){if(t.get_Command()==AlphaSynth.Midi.Event.MidiEventTypeEnum.NoteOn){h=t.get_Channel();-1==Array.prototype.indexOf.call(a,h)&&a.push(h),i++}else if(t.get_Command()==AlphaSynth.Midi.Event.MidiEventTypeEnum.ProgramChange){var h=t.get_Channel(),s=t.get_Data1();9==h?-1==Array.prototype.indexOf.call(n,s)&&n.push(s):-1==Array.prototype.indexOf.call(e,s)&&e.push(s)}return i},AlphaSynth.Midi.MidiFile.ReadVariableLength=function(t){var e,n=0;do{n<<=7,n|=127&(e=t.ReadByte())}while(128==(128&e));return n},AlphaSynth.Midi.MidiFile.ReadString=function(t){var e=AlphaSynth.Midi.MidiFile.ReadVariableLength(t);return AlphaSynth.Util.IOHelper.Read8BitChars(t,e)},AlphaSynth.Midi.MidiTrackFormat={SingleTrack:0,MultiTrack:1,MultiSong:2},AlphaSynth.Midi.MidiTimeFormat={TicksPerBeat:0,FramesPerSecond:1},AlphaSynth.PlayerState={Paused:0,Playing:1},AlphaSynth.Sf2=AlphaSynth.Sf2||{},AlphaSynth.Sf2.Chunks=AlphaSynth.Sf2.Chunks||{},AlphaSynth.Sf2.Chunks.Chunk=function(t,e){this.Id=null,this.Size=0,this.Id=t,this.Size=e},AlphaSynth.Sf2.Chunks.ZoneChunk=function(t,e,n){this._zoneData=null,AlphaSynth.Sf2.Chunks.Chunk.call(this,t,e),this._zoneData=new Array(e/4|0);for(var a=null,i=0;i<this._zoneData.length;i++){var h=new AlphaSynth.Sf2.Chunks.RawZoneData;h.GeneratorIndex=AlphaSynth.Util.IOHelper.ReadUInt16LE(n),h.ModulatorIndex=AlphaSynth.Util.IOHelper.ReadUInt16LE(n),null!=a&&(a.GeneratorCount=h.GeneratorIndex-a.GeneratorIndex&65535,a.ModulatorCount=h.ModulatorIndex-a.ModulatorIndex&65535),this._zoneData[i]=h,a=h}},AlphaSynth.Sf2.Chunks.ZoneChunk.prototype={ToZones:function(t,e){for(var n=new Array(this._zoneData.length-1),a=0;a<n.length;a++){var i=this._zoneData[a],h=new AlphaSynth.Sf2.Zone;h.Generators=new Array(i.GeneratorCount),AlphaSynth.Platform.Std.ArrayCopy(e,i.GeneratorIndex,h.Generators,0,i.GeneratorCount),h.Modulators=new Array(i.ModulatorCount),AlphaSynth.Platform.Std.ArrayCopy(t,i.ModulatorIndex,h.Modulators,0,i.ModulatorCount),n[a]=h}return n}},$Inherit(AlphaSynth.Sf2.Chunks.ZoneChunk,AlphaSynth.Sf2.Chunks.Chunk),AlphaSynth.Sf2.Chunks.RawZoneData=function(){this.GeneratorIndex=0,this.ModulatorIndex=0,this.GeneratorCount=0,this.ModulatorCount=0},AlphaSynth.Sf2.Chunks.SampleHeaderChunk=function(t,e,n){if(this.SampleHeaders=null,AlphaSynth.Sf2.Chunks.Chunk.call(this,t,e),e%46!=0)throw $CreateException(new System.Exception.ctor$$String("Invalid SoundFont. The sample header chunk was invalid."),new Error);this.SampleHeaders=new Array(e/46-1|0);for(var a=0;a<this.SampleHeaders.length;a++)this.SampleHeaders[a]=new AlphaSynth.Sf2.SampleHeader(n);new AlphaSynth.Sf2.SampleHeader(n)},$Inherit(AlphaSynth.Sf2.Chunks.SampleHeaderChunk,AlphaSynth.Sf2.Chunks.Chunk),AlphaSynth.Sf2.Chunks.PresetHeaderChunk=function(t,e,n){if(this._rawPresets=null,AlphaSynth.Sf2.Chunks.Chunk.call(this,t,e),e%38!=0)throw $CreateException(new System.Exception.ctor$$String("Invalid SoundFont. The preset chunk was invalid."),new Error);this._rawPresets=new Array(e/38|0);for(var a=null,i=0;i<this._rawPresets.length;i++){var h=new AlphaSynth.Sf2.Chunks.RawPreset;h.Name=AlphaSynth.Util.IOHelper.Read8BitStringLength(n,20),h.PatchNumber=AlphaSynth.Util.IOHelper.ReadUInt16LE(n),h.BankNumber=AlphaSynth.Util.IOHelper.ReadUInt16LE(n),h.StartPresetZoneIndex=AlphaSynth.Util.IOHelper.ReadUInt16LE(n),h.Library=AlphaSynth.Util.IOHelper.ReadInt32LE(n),h.Genre=AlphaSynth.Util.IOHelper.ReadInt32LE(n),h.Morphology=AlphaSynth.Util.IOHelper.ReadInt32LE(n),null!=a&&(a.EndPresetZoneIndex=h.StartPresetZoneIndex-1&65535),this._rawPresets[i]=h,a=h}},AlphaSynth.Sf2.Chunks.PresetHeaderChunk.prototype={ToPresets:function(t){for(var e=new Array(this._rawPresets.length-1),n=0;n<e.length;n++){var a=this._rawPresets[n],i=new AlphaSynth.Sf2.PresetHeader;i.BankNumber=a.BankNumber,i.Genre=a.Genre,i.Library=a.Library,i.Morphology=a.Morphology,i.Name=a.Name,i.PatchNumber=a.PatchNumber,i.Zones=new Array(a.EndPresetZoneIndex-a.StartPresetZoneIndex+1),AlphaSynth.Platform.Std.ArrayCopy(t,a.StartPresetZoneIndex,i.Zones,0,i.Zones.length),e[n]=i}return e}},$Inherit(AlphaSynth.Sf2.Chunks.PresetHeaderChunk,AlphaSynth.Sf2.Chunks.Chunk),AlphaSynth.Sf2.Chunks.RawPreset=function(){this.Name=null,this.PatchNumber=0,this.BankNumber=0,this.StartPresetZoneIndex=0,this.EndPresetZoneIndex=0,this.Library=0,this.Genre=0,this.Morphology=0},AlphaSynth.Sf2.Chunks.ModulatorChunk=function(t,e,n){if(this.Modulators=null,AlphaSynth.Sf2.Chunks.Chunk.call(this,t,e),e%10!=0)throw $CreateException(new System.Exception.ctor$$String("Invalid SoundFont. The presetzone chunk was invalid."),new Error);this.Modulators=new Array((e/10|0)-1);for(var a=0;a<this.Modulators.length;a++)this.Modulators[a]=new AlphaSynth.Sf2.Modulator(n);new AlphaSynth.Sf2.Modulator(n)},$Inherit(AlphaSynth.Sf2.Chunks.ModulatorChunk,AlphaSynth.Sf2.Chunks.Chunk),AlphaSynth.Sf2.Chunks.InstrumentChunk=function(t,e,n){if(this._rawInstruments=null,AlphaSynth.Sf2.Chunks.Chunk.call(this,t,e),e%22!=0)throw $CreateException(new System.Exception.ctor$$String("Invalid SoundFont. The preset chunk was invalid."),new Error);this._rawInstruments=new Array(e/22|0);for(var a=null,i=0;i<this._rawInstruments.length;i++){var h=new AlphaSynth.Sf2.Chunks.RawInstrument;h.Name=AlphaSynth.Util.IOHelper.Read8BitStringLength(n,20),h.StartInstrumentZoneIndex=AlphaSynth.Util.IOHelper.ReadUInt16LE(n),null!=a&&(a.EndInstrumentZoneIndex=h.StartInstrumentZoneIndex-1&65535),this._rawInstruments[i]=h,a=h}},AlphaSynth.Sf2.Chunks.InstrumentChunk.prototype={ToInstruments:function(t){for(var e=new Array(this._rawInstruments.length-1),n=0;n<e.length;n++){var a=this._rawInstruments[n],i=new AlphaSynth.Sf2.Instrument;i.Name=a.Name,i.Zones=new Array(a.EndInstrumentZoneIndex-a.StartInstrumentZoneIndex+1),AlphaSynth.Platform.Std.ArrayCopy(t,a.StartInstrumentZoneIndex,i.Zones,0,i.Zones.length),e[n]=i}return e}},$Inherit(AlphaSynth.Sf2.Chunks.InstrumentChunk,AlphaSynth.Sf2.Chunks.Chunk),AlphaSynth.Sf2.Chunks.RawInstrument=function(){this.Name=null,this.StartInstrumentZoneIndex=0,this.EndInstrumentZoneIndex=0},AlphaSynth.Sf2.Chunks.GeneratorChunk=function(t,e,n){if(this.Generators=null,AlphaSynth.Sf2.Chunks.Chunk.call(this,t,e),e%4!=0)throw $CreateException(new System.Exception.ctor$$String("Invalid SoundFont. The presetzone chunk was invalid"),new Error);this.Generators=new Array(e/4-1|0);for(var a=0;a<this.Generators.length;a++)this.Generators[a]=new AlphaSynth.Sf2.Generator(n);new AlphaSynth.Sf2.Generator(n)},$Inherit(AlphaSynth.Sf2.Chunks.GeneratorChunk,AlphaSynth.Sf2.Chunks.Chunk),AlphaSynth.Sf2.Modulator=function(t){this._sourceModulationData=null,this._destinationGenerator=0,this._amount=0,this._sourceModulationAmount=null,this._sourceTransform=0,this._sourceModulationData=new AlphaSynth.Sf2.ModulatorType(t),this._destinationGenerator=AlphaSynth.Util.IOHelper.ReadUInt16LE(t),this._amount=AlphaSynth.Util.IOHelper.ReadInt16LE(t),this._sourceModulationAmount=new AlphaSynth.Sf2.ModulatorType(t),this._sourceTransform=AlphaSynth.Util.IOHelper.ReadUInt16LE(t)},AlphaSynth.Sf2.Zone=function(){this.Modulators=null,this.Generators=null},AlphaSynth.Sf2.SoundFontSampleData=function(t){this.BitsPerSample=0,this.SampleData=null;var e=AlphaSynth.Util.IOHelper.Read8BitChars(t,4),n=AlphaSynth.Util.IOHelper.ReadInt32LE(t);if("list"!=e.toLowerCase())throw $CreateException(new System.Exception.ctor$$String("Invalid soundfont. Could not find sdta LIST chunk."),new Error);var a=t.Position+n;if("sdta"!=(e=AlphaSynth.Util.IOHelper.Read8BitChars(t,4)).toLowerCase())throw $CreateException(new System.Exception.ctor$$String("Invalid soundfont. The LIST chunk is not of type sdta."),new Error);this.BitsPerSample=0;for(var i=null;t.Position<a;){var h=AlphaSynth.Util.IOHelper.Read8BitChars(t,4);switch(n=AlphaSynth.Util.IOHelper.ReadInt32LE(t),h.toLowerCase()){case"smpl":this.BitsPerSample=16,i=AlphaSynth.Util.IOHelper.ReadByteArray(t,n);break;case"sm24":if(null==i||n!=Math.ceil(this.SampleData.length/2))t.Skip(n);else{this.BitsPerSample=24;for(var s=0;s<this.SampleData.length;s++){var o=new Uint8Array(3);o[0]=t.ReadByte(),o[1]=i[2*s],o[2]=i[2*s+1]}}n%2==1&&0!=t.ReadByte()&&t.Position--;break;default:throw $CreateException(new System.Exception.ctor$$String("Invalid soundfont. Unknown chunk id: "+h+"."),new Error)}}if(16==this.BitsPerSample)this.SampleData=i;else if(24!=this.BitsPerSample)throw $CreateException(new System.Exception.ctor$$String("Only 16 and 24 bit samples are supported."),new Error)},AlphaSynth.Sf2.SoundFontPresets=function(t){this.SampleHeaders=null,this.PresetHeaders=null,this.Instruments=null;var e=AlphaSynth.Util.IOHelper.Read8BitChars(t,4),n=AlphaSynth.Util.IOHelper.ReadInt32LE(t);if("list"!=e.toLowerCase())throw $CreateException(new System.Exception.ctor$$String("Invalid soundfont. Could not find pdta LIST chunk."),new Error);var a=t.Position+n;if("pdta"!=(e=AlphaSynth.Util.IOHelper.Read8BitChars(t,4)).toLowerCase())throw $CreateException(new System.Exception.ctor$$String("Invalid soundfont. The LIST chunk is not of type pdta."),new Error);for(var i=null,h=null,s=null,o=null,r=null,l=null,p=null,u=null;t.Position<a;)switch(e=AlphaSynth.Util.IOHelper.Read8BitChars(t,4),n=AlphaSynth.Util.IOHelper.ReadInt32LE(t),e.toLowerCase()){case"phdr":p=new AlphaSynth.Sf2.Chunks.PresetHeaderChunk(e,n,t);break;case"pbag":r=new AlphaSynth.Sf2.Chunks.ZoneChunk(e,n,t);break;case"pmod":i=new AlphaSynth.Sf2.Chunks.ModulatorChunk(e,n,t).Modulators;break;case"pgen":h=new AlphaSynth.Sf2.Chunks.GeneratorChunk(e,n,t).Generators;break;case"inst":u=new AlphaSynth.Sf2.Chunks.InstrumentChunk(e,n,t);break;case"ibag":l=new AlphaSynth.Sf2.Chunks.ZoneChunk(e,n,t);break;case"imod":s=new AlphaSynth.Sf2.Chunks.ModulatorChunk(e,n,t).Modulators;break;case"igen":o=new AlphaSynth.Sf2.Chunks.GeneratorChunk(e,n,t).Generators;break;case"shdr":this.SampleHeaders=new AlphaSynth.Sf2.Chunks.SampleHeaderChunk(e,n,t).SampleHeaders;break;default:throw $CreateException(new System.Exception.ctor$$String("Invalid soundfont. Unrecognized sub chunk: "+e),new Error)}var y=r.ToZones(i,h);this.PresetHeaders=p.ToPresets(y);var S=l.ToZones(s,o);this.Instruments=u.ToInstruments(S)},AlphaSynth.Sf2.SoundFontInfo=function(t){this.RomVersionMajor=0,this.RomVersionMinor=0,this.SfVersionMajor=0,this.SfVersionMinor=0,this.SoundEngine=null,this.BankName=null,this.DataRom=null,this.CreationDate=null,this.Author=null,this.TargetProduct=null,this.Copyright=null,this.Comments=null,this.Tools=null,this.Tools="",this.Comments="",this.Copyright="",this.TargetProduct="",this.Author="",this.DataRom="",this.CreationDate="",this.BankName="",this.SoundEngine="";var e=AlphaSynth.Util.IOHelper.Read8BitChars(t,4),n=AlphaSynth.Util.IOHelper.ReadInt32LE(t);if("list"!=e.toLowerCase())throw $CreateException(new System.Exception.ctor$$String("Invalid soundfont. Could not find INFO LIST chunk."),new Error);var a=t.Position+n;if("info"!=(e=AlphaSynth.Util.IOHelper.Read8BitChars(t,4)).toLowerCase())throw $CreateException(new System.Exception.ctor$$String("Invalid soundfont. The LIST chunk is not of type INFO."),new Error);for(;t.Position<a;)switch(e=AlphaSynth.Util.IOHelper.Read8BitChars(t,4),n=AlphaSynth.Util.IOHelper.ReadInt32LE(t),e.toLowerCase()){case"ifil":this.SfVersionMajor=AlphaSynth.Util.IOHelper.ReadInt16LE(t),this.SfVersionMinor=AlphaSynth.Util.IOHelper.ReadInt16LE(t);break;case"isng":this.SoundEngine=AlphaSynth.Util.IOHelper.Read8BitStringLength(t,n);break;case"inam":this.BankName=AlphaSynth.Util.IOHelper.Read8BitStringLength(t,n);break;case"irom":this.DataRom=AlphaSynth.Util.IOHelper.Read8BitStringLength(t,n);break;case"iver":this.RomVersionMajor=AlphaSynth.Util.IOHelper.ReadInt16LE(t),this.RomVersionMinor=AlphaSynth.Util.IOHelper.ReadInt16LE(t);break;case"icrd":this.CreationDate=AlphaSynth.Util.IOHelper.Read8BitStringLength(t,n);break;case"ieng":this.Author=AlphaSynth.Util.IOHelper.Read8BitStringLength(t,n);break;case"iprd":this.TargetProduct=AlphaSynth.Util.IOHelper.Read8BitStringLength(t,n);break;case"icop":this.Copyright=AlphaSynth.Util.IOHelper.Read8BitStringLength(t,n);break;case"icmt":this.Comments=AlphaSynth.Util.IOHelper.Read8BitStringLength(t,n);break;case"isft":this.Tools=AlphaSynth.Util.IOHelper.Read8BitStringLength(t,n);break;default:throw $CreateException(new System.Exception.ctor$$String("Invalid soundfont. The Chunk: "+e+" was not expected."),new Error)}},AlphaSynth.Sf2.SoundFont=function(){this.Info=null,this.SampleData=null,this.Presets=null},AlphaSynth.Sf2.SoundFont.prototype={Load:function(t){var e=AlphaSynth.Util.IOHelper.Read8BitChars(t,4);AlphaSynth.Util.IOHelper.ReadInt32LE(t);if("riff"!=e.toLowerCase())throw $CreateException(new System.Exception.ctor$$String("Invalid soundfont. Could not find RIFF header."),new Error);if("sfbk"!=(e=AlphaSynth.Util.IOHelper.Read8BitChars(t,4)).toLowerCase())throw $CreateException(new System.Exception.ctor$$String("Invalid soundfont. Riff type is invalid."),new Error);AlphaSynth.Util.Logger.Debug("Reading info chunk"),this.Info=new AlphaSynth.Sf2.SoundFontInfo(t),AlphaSynth.Util.Logger.Debug("Reading sampledata chunk"),this.SampleData=new AlphaSynth.Sf2.SoundFontSampleData(t),AlphaSynth.Util.Logger.Debug("Reading preset chunk"),this.Presets=new AlphaSynth.Sf2.SoundFontPresets(t)}},AlphaSynth.Sf2.Sf2Region=function(){this.Generators=null,this.Generators=new Int16Array(61)},AlphaSynth.Sf2.Sf2Region.prototype={ApplyDefaultValues:function(){this.Generators[0]=0,this.Generators[1]=0,this.Generators[2]=0,this.Generators[3]=0,this.Generators[4]=0,this.Generators[5]=0,this.Generators[6]=0,this.Generators[7]=0,this.Generators[8]=13500,this.Generators[9]=0,this.Generators[10]=0,this.Generators[11]=0,this.Generators[12]=0,this.Generators[13]=0,this.Generators[15]=0,this.Generators[16]=0,this.Generators[17]=0,this.Generators[21]=-12e3,this.Generators[22]=0,this.Generators[23]=-12e3,this.Generators[24]=0,this.Generators[25]=-12e3,this.Generators[26]=-12e3,this.Generators[27]=-12e3,this.Generators[28]=-12e3,this.Generators[29]=0,this.Generators[30]=-12e3,this.Generators[31]=0,this.Generators[32]=0,this.Generators[33]=-12e3,this.Generators[34]=-12e3,this.Generators[35]=-12e3,this.Generators[36]=-12e3,this.Generators[37]=0,this.Generators[38]=-12e3,this.Generators[39]=0,this.Generators[40]=0,this.Generators[43]=32512,this.Generators[44]=32512,this.Generators[45]=0,this.Generators[46]=-1,this.Generators[47]=-1,this.Generators[48]=0,this.Generators[50]=0,this.Generators[51]=0,this.Generators[52]=0,this.Generators[54]=0,this.Generators[56]=100,this.Generators[57]=0,this.Generators[58]=-1}},AlphaSynth.Sf2.SampleHeader=function(t){this.Name=null,this.Start=0,this.End=0,this.StartLoop=0,this.EndLoop=0,this.SampleRate=0,this.RootKey=0,this.Tune=0,this.SampleLink=0,this.SoundFontSampleLink=AlphaSynth.Sf2.SFSampleLink.MonoSample,this.Name=AlphaSynth.Util.IOHelper.Read8BitStringLength(t,20),this.Start=AlphaSynth.Util.IOHelper.ReadInt32LE(t),this.End=AlphaSynth.Util.IOHelper.ReadInt32LE(t),this.StartLoop=AlphaSynth.Util.IOHelper.ReadInt32LE(t),this.EndLoop=AlphaSynth.Util.IOHelper.ReadInt32LE(t),this.SampleRate=AlphaSynth.Util.IOHelper.ReadInt32LE(t),this.RootKey=t.ReadByte(),this.Tune=AlphaSynth.Platform.TypeUtils.ToInt16(t.ReadByte()),this.SampleLink=AlphaSynth.Util.IOHelper.ReadUInt16LE(t),this.SoundFontSampleLink=AlphaSynth.Util.IOHelper.ReadUInt16LE(t)},AlphaSynth.Sf2.PresetHeader=function(){this.Name=null,this.PatchNumber=0,this.BankNumber=0,this.Library=0,this.Genre=0,this.Morphology=0,this.Zones=null},AlphaSynth.Sf2.ModulatorType=function(t){this._controllerSource=0,this.Polarity=AlphaSynth.Sf2.PolarityEnum.Unipolar,this.Direction=AlphaSynth.Sf2.DirectionEnum.MinToMax,this.SourceType=0,this.IsMidiContinuousController=!1;var e=AlphaSynth.Util.IOHelper.ReadUInt16LE(t);this.Polarity=512==(512&e)?AlphaSynth.Sf2.PolarityEnum.Bipolar:AlphaSynth.Sf2.PolarityEnum.Unipolar,this.Direction=256==(256&e)?AlphaSynth.Sf2.DirectionEnum.MaxToMin:AlphaSynth.Sf2.DirectionEnum.MinToMax,this.IsMidiContinuousController=128==(128&e),this.SourceType=(64512&e)>>10,this._controllerSource=127&e},AlphaSynth.Sf2.Instrument=function(){this.Name=null,this.Zones=null},AlphaSynth.Sf2.Generator=function(t){this._rawAmount=0,this.GeneratorType=AlphaSynth.Sf2.GeneratorEnum.StartAddressOffset,this.GeneratorType=AlphaSynth.Util.IOHelper.ReadUInt16LE(t),this._rawAmount=AlphaSynth.Util.IOHelper.ReadUInt16LE(t)},AlphaSynth.Sf2.Generator.prototype={get_AmountInt16:function(){return AlphaSynth.Platform.TypeUtils.ToInt16(this._rawAmount)},set_AmountInt16:function(t){this._rawAmount=65535&t},get_LowByteAmount:function(){return 255&this._rawAmount},set_LowByteAmount:function(t){this._rawAmount=(65280&this._rawAmount)+(255&t)&65535},get_HighByteAmount:function(){return(65280&this._rawAmount)>>8&255},set_HighByteAmount:function(t){this._rawAmount=(255&this._rawAmount)+((255&t)<<8)&65535}},AlphaSynth.Sf2.SFSampleLink={MonoSample:1,RightSample:2,LeftSample:4,LinkedSample:8,OggVobis:16,RomMonoSample:32769,RomRightSample:32770,RomLeftSample:32772,RomLinkedSample:32776},AlphaSynth.Sf2.GeneratorEnum={StartAddressOffset:0,EndAddressOffset:1,StartLoopAddressOffset:2,EndLoopAddressOffset:3,StartAddressCoarseOffset:4,ModulationLFOToPitch:5,VibratoLFOToPitch:6,ModulationEnvelopeToPitch:7,InitialFilterCutoffFrequency:8,InitialFilterQ:9,ModulationLFOToFilterCutoffFrequency:10,ModulationEnvelopeToFilterCutoffFrequency:11,EndAddressCoarseOffset:12,ModulationLFOToVolume:13,Unused1:14,ChorusEffectsSend:15,ReverbEffectsSend:16,Pan:17,Unused2:18,Unused3:19,Unused4:20,DelayModulationLFO:21,FrequencyModulationLFO:22,DelayVibratoLFO:23,FrequencyVibratoLFO:24,DelayModulationEnvelope:25,AttackModulationEnvelope:26,HoldModulationEnvelope:27,DecayModulationEnvelope:28,SustainModulationEnvelope:29,ReleaseModulationEnvelope:30,KeyNumberToModulationEnvelopeHold:31,KeyNumberToModulationEnvelopeDecay:32,DelayVolumeEnvelope:33,AttackVolumeEnvelope:34,HoldVolumeEnvelope:35,DecayVolumeEnvelope:36,SustainVolumeEnvelope:37,ReleaseVolumeEnvelope:38,KeyNumberToVolumeEnvelopeHold:39,KeyNumberToVolumeEnvelopeDecay:40,Instrument:41,Reserved1:42,KeyRange:43,VelocityRange:44,StartLoopAddressCoarseOffset:45,KeyNumber:46,Velocity:47,InitialAttenuation:48,Reserved2:49,EndLoopAddressCoarseOffset:50,CoarseTune:51,FineTune:52,SampleID:53,SampleModes:54,Reserved3:55,ScaleTuning:56,ExclusiveClass:57,OverridingRootKey:58,Unused5:59,UnusedEnd:60},AlphaSynth.Sf2.TransformEnum={Linear:0,AbsoluteValue:2},AlphaSynth.Sf2.ControllerSourceEnum={NoController:0,NoteOnVelocity:2,NoteOnKeyNumber:3,PolyPressure:10,ChannelPressure:13,PitchWheel:14,PitchWheelSensitivity:16,Link:127},AlphaSynth.Sf2.DirectionEnum={MinToMax:0,MaxToMin:1},AlphaSynth.Sf2.PolarityEnum={Unipolar:0,Bipolar:1},AlphaSynth.Sf2.SourceTypeEnum={Linear:0,Concave:1,Convex:2,Switch:3},AlphaSynth.Synthesis=AlphaSynth.Synthesis||{},AlphaSynth.Synthesis.CCValue=function(t,e){this._coarseValue=0,this._fineValue=0,this._combined=0,this._coarseValue=t,this._fineValue=e,this._combined=0,this.UpdateCombined()},AlphaSynth.Synthesis.CCValue=function(t){this._coarseValue=0,this._fineValue=0,this._combined=0,this._coarseValue=0,this._fineValue=0,this._combined=t,this.UpdateCoarseFinePair()},AlphaSynth.Synthesis.CCValue.prototype={get_Coarse:function(){return this._coarseValue},set_Coarse:function(t){this._coarseValue=t,this.UpdateCombined()},get_Fine:function(){return this._fineValue},set_Fine:function(t){this._fineValue=t,this.UpdateCombined()},get_Combined:function(){return this._combined},set_Combined:function(t){this._combined=t,this.UpdateCoarseFinePair()},UpdateCombined:function(){AlphaSynth.Platform.TypeUtils.IsLittleEndian?this._combined=this._coarseValue<<7|this._fineValue|0:this._combined=this._fineValue<<7|this._coarseValue|0},UpdateCoarseFinePair:function(){AlphaSynth.Platform.TypeUtils.IsLittleEndian?(this._coarseValue=this._combined>>7,this._fineValue=127&this._combined):(this._fineValue=this._combined>>7,this._coarseValue=127&this._combined)}},AlphaSynth.Synthesis.PlaybackRange=function(){this.StartTick=0,this.EndTick=0},AlphaSynth.Synthesis.SynthParameters=function(t){this.Program=0,this.BankSelect=0,this.ChannelAfterTouch=0,this.Pan=null,this.Volume=null,this.Expression=null,this.ModRange=null,this.PitchBend=null,this.PitchBendRangeCoarse=0,this.PitchBendRangeFine=0,this.MasterCoarseTune=0,this.MasterFineTune=null,this.HoldPedal=!1,this.LegatoPedal=!1,this.Rpn=null,this.Synth=null,this.CurrentVolume=0,this.CurrentPitch=0,this.CurrentMod=0,this.CurrentPan=null,this.MixVolume=0,this.Synth=t,this.Pan=new AlphaSynth.Synthesis.CCValue(0),this.Volume=new AlphaSynth.Synthesis.CCValue(0),this.Expression=new AlphaSynth.Synthesis.CCValue(0),this.ModRange=new AlphaSynth.Synthesis.CCValue(0),this.PitchBend=new AlphaSynth.Synthesis.CCValue(0),this.MasterFineTune=new AlphaSynth.Synthesis.CCValue(0),this.Rpn=new AlphaSynth.Synthesis.CCValue(0),this.MixVolume=1,this.CurrentPan=new AlphaSynth.Bank.Components.PanComponent,this.ResetControllers()},AlphaSynth.Synthesis.SynthParameters.prototype={ResetControllers:function(){this.Program=0,this.BankSelect=0,this.ChannelAfterTouch=0,this.Pan.set_Combined(8192),this.Volume.set_Fine(0),this.Volume.set_Coarse(100),this.Expression.set_Combined(16383),this.ModRange.set_Combined(0),this.PitchBend.set_Combined(8192),this.PitchBendRangeCoarse=2,this.PitchBendRangeFine=0,this.MasterCoarseTune=0,this.MasterFineTune.set_Combined(8192),this.HoldPedal=!1,this.LegatoPedal=!1,this.Rpn.set_Combined(16383),this.UpdateCurrentPan(),this.UpdateCurrentPitch(),this.UpdateCurrentVolumeFromExpression()},UpdateCurrentPitch:function(){this.CurrentPitch=(this.PitchBend.get_Combined()-8192)/8192*(100*this.PitchBendRangeCoarse+this.PitchBendRangeFine)|0},UpdateCurrentMod:function(){this.CurrentMod=this.ModRange.get_Combined()/16383*100|0},UpdateCurrentPan:function(){var t=this.Pan.get_Combined()/16383*1.5707963267949;this.CurrentPan.Left=Math.cos(t),this.CurrentPan.Right=Math.sin(t)},UpdateCurrentVolumeFromVolume:function(){this.CurrentVolume=this.Volume.get_Combined()/16383,this.CurrentVolume*=this.CurrentVolume},UpdateCurrentVolumeFromExpression:function(){this.CurrentVolume=this.Expression.get_Combined()/16383,this.CurrentVolume*=this.CurrentVolume}},AlphaSynth.Synthesis.VoiceParameters=function(){this.mix1=0,this.mix2=0,this.Channel=0,this.Note=0,this.Velocity=0,this.NoteOffPending=!1,this.State=AlphaSynth.Synthesis.VoiceStateEnum.Stopped,this.PitchOffset=0,this.VolOffset=0,this.BlockBuffer=null,this.PData=null,this.SynthParams=null,this.GeneratorParams=null,this.Envelopes=null,this.Filters=null,this.Lfos=null,this.BlockBuffer=new Float32Array(64),this.PData=new Array(4),this.GeneratorParams=new Array(4),this.Envelopes=new Array(4),this.Filters=new Array(4),this.Lfos=new Array(4);for(var t=0;t<4;t++)this.GeneratorParams[t]=new AlphaSynth.Bank.Components.Generators.GeneratorParameters,this.Envelopes[t]=new AlphaSynth.Bank.Components.Envelope,this.Filters[t]=new AlphaSynth.Bank.Components.Filter,this.Lfos[t]=new AlphaSynth.Bank.Components.Lfo},AlphaSynth.Synthesis.VoiceParameters.prototype={get_CombinedVolume:function(){return this.mix1+this.mix2},Reset:function(){this.NoteOffPending=!1,this.PitchOffset=0,this.VolOffset=0;for(var t=0;t<this.PData.length;t++)this.PData[t]=new DataView(new ArrayBuffer(8));this.mix1=0,this.mix2=0},MixMonoToMonoInterp:function(t,e){for(var n=(e-this.mix1)/64,a=0;a<this.BlockBuffer.length;a++)this.mix1+=n,this.SynthParams.Synth.SampleBuffer[t+a]+=this.BlockBuffer[a]*this.mix1;this.mix1=e},MixMonoToStereoInterp:function(t,e,n){for(var a=(e-this.mix1)/64,i=(n-this.mix2)/64,h=0;h<this.BlockBuffer.length;h++)this.mix1+=a,this.mix2+=i,this.SynthParams.Synth.SampleBuffer[t]+=this.BlockBuffer[h]*this.mix1,this.SynthParams.Synth.SampleBuffer[t+1]+=this.BlockBuffer[h]*this.mix2,t+=2;this.mix1=e,this.mix2=n},MixStereoToStereoInterp:function(t,e,n){for(var a=(e-this.mix1)/64,i=(n-this.mix2)/64,h=0;h<this.BlockBuffer.length;h++)this.mix1+=a,this.mix2+=i,this.SynthParams.Synth.SampleBuffer[t+h]+=this.BlockBuffer[h]*this.mix1,h++,this.SynthParams.Synth.SampleBuffer[t+h]+=this.BlockBuffer[h]*this.mix2;this.mix1=e,this.mix2=n}},AlphaSynth.Synthesis.VoiceNode=function(){this.Value=null,this.Next=null},AlphaSynth.Synthesis.VoiceManager=function(t){this._voicePool=null,this._vNodes=null,this.Polyphony=0,this.FreeVoices=null,this.ActiveVoices=null,this.Registry=null,this.Polyphony=t,this._voicePool=new Array(t),this._vNodes=new AlphaSynth.Ds.LinkedList,this.FreeVoices=new AlphaSynth.Ds.LinkedList,this.ActiveVoices=new AlphaSynth.Ds.LinkedList;for(n=0;n<t;n++){var e=new AlphaSynth.Synthesis.Voice;this._voicePool[n]=e,this._vNodes.AddLast(new AlphaSynth.Synthesis.VoiceNode),this.FreeVoices.AddLast(e)}this.Registry=new Array(17);for(var n=0;n<this.Registry.length;n++)this.Registry[n]=new Array(128)},AlphaSynth.Synthesis.VoiceManager.prototype={GetFreeVoice:function(){if(this.FreeVoices.Length>0){var t=this.FreeVoices.First.Value;return this.FreeVoices.RemoveFirst(),t}return this.StealQuietestVoice()},AddToRegistry:function(t){var e=this._vNodes.RemoveLast();e.Value=t,e.Next=this.Registry[t.VoiceParams.Channel][t.VoiceParams.Note],this.Registry[t.VoiceParams.Channel][t.VoiceParams.Note]=e},RemoveFromRegistry:function(t,e){for(var n=this.Registry[t][e];null!=n;)this._vNodes.AddLast(n),n=n.Next;this.Registry[t][e]=null},RemoveVoiceFromRegistry:function(t){var e=this.Registry[t.VoiceParams.Channel][t.VoiceParams.Note];if(null!=e)if(e.Value==t)this.Registry[t.VoiceParams.Channel][t.VoiceParams.Note]=e.Next,this._vNodes.AddLast(e);else{var n=e;for(e=e.Next;null!=e;){if(e.Value==t)return n.Next=e.Next,void this._vNodes.AddLast(e);n=e,e=e.Next}}},ClearRegistry:function(){for(var t=this.ActiveVoices.First;null!=t;){for(var e=this.Registry[t.Value.VoiceParams.Channel][t.Value.VoiceParams.Note];null!=e;)this._vNodes.AddLast(e),e=e.Next;this.Registry[t.Value.VoiceParams.Channel][t.Value.VoiceParams.Note]=null,t=t.get_Next()}},UnloadPatches:function(){for(var t=0,e=this._voicePool,n=e.length,a=e[t];t<n;t++,a=e[t]){a.Configure(0,0,0,null,null);for(var i=this._vNodes.First;null!=i;)i.Value.Value=null,i=i.get_Next()}},StealQuietestVoice:function(){for(var t=1e3,e=null,n=this.ActiveVoices.First;null!=n;){if(n.Value.VoiceParams.State!=AlphaSynth.Synthesis.VoiceStateEnum.Playing){var a=n.Value.VoiceParams.get_CombinedVolume();a<t&&(e=n,t=a)}n=n.get_Next()}return null==e&&(e=this.ActiveVoices.First),this.RemoveVoiceFromRegistry(e.Value),this.ActiveVoices.Remove(e),e.Value.VoiceParams.State=AlphaSynth.Synthesis.VoiceStateEnum.Stopped,e.Value}},AlphaSynth.Synthesis.VoiceStateEnum={Stopped:0,Stopping:1,Playing:2},AlphaSynth.Synthesis.Voice=function(){this.Patch=null,this.VoiceParams=null,this.VoiceParams=new AlphaSynth.Synthesis.VoiceParameters},AlphaSynth.Synthesis.Voice.prototype={Start:function(){this.VoiceParams.State==AlphaSynth.Synthesis.VoiceStateEnum.Stopped&&this.Patch.Start(this.VoiceParams)&&(this.VoiceParams.State=AlphaSynth.Synthesis.VoiceStateEnum.Playing)},Stop:function(){this.VoiceParams.State==AlphaSynth.Synthesis.VoiceStateEnum.Playing&&(this.VoiceParams.State=AlphaSynth.Synthesis.VoiceStateEnum.Stopping,this.Patch.Stop(this.VoiceParams))},StopImmediately:function(){this.VoiceParams.State=AlphaSynth.Synthesis.VoiceStateEnum.Stopped},Process:function(t,e,n){this.VoiceParams.State!=AlphaSynth.Synthesis.VoiceStateEnum.Stopped&&this.Patch.Process(this.VoiceParams,t,e,n)},Configure:function(t,e,n,a,i){this.VoiceParams.Reset(),this.VoiceParams.Channel=t,this.VoiceParams.Note=e,this.VoiceParams.Velocity=n,this.VoiceParams.SynthParams=i,this.Patch=a}},AlphaSynth.Synthesis.SynthHelper=function(){},AlphaSynth.Synthesis.SynthHelper.ClampB=function(t,e,n){return t<=e?e:t>=n?n:t},AlphaSynth.Synthesis.SynthHelper.ClampD=function(t,e,n){return t<=e?e:t>=n?n:t},AlphaSynth.Synthesis.SynthHelper.ClampF=function(t,e,n){return t<=e?e:t>=n?n:t},AlphaSynth.Synthesis.SynthHelper.ClampI=function(t,e,n){return t<=e?e:t>=n?n:t},AlphaSynth.Synthesis.SynthHelper.ClampS=function(t,e,n){return t<=e?e:t>=n?n:t},AlphaSynth.Synthesis.SynthHelper.NearestPowerOfTwo=function(t){return Math.pow(2,Math.Round(Math.Log(t,2)))},AlphaSynth.Synthesis.SynthHelper.SamplesFromTime=function(t,e){return t*e},AlphaSynth.Synthesis.SynthHelper.TimeFromSamples=function(t,e){return e/t},AlphaSynth.Synthesis.SynthHelper.DBtoLinear=function(t){return Math.pow(10,t/20)},AlphaSynth.Synthesis.SynthHelper.LineartoDB=function(t){return Math.log(t)/Math.LN10*20},AlphaSynth.Synthesis.SynthHelper.FrequencyToKey=function(t,e){return 12*Math.Log(t/440,2)+e},AlphaSynth.Synthesis.SynthHelper.KeyToFrequency=function(t,e){return 440*Math.pow(2,(t-e)/12)},AlphaSynth.Synthesis.SynthHelper.SemitoneToPitch=function(t){return t<-127?t=-127:t>127&&(t=127),AlphaSynth.Util.Tables.SemitoneTable(127+t)},AlphaSynth.Synthesis.SynthHelper.CentsToPitch=function(t){var e=t/100|0;return t-=100*e,e<-127?e=-127:e>127&&(e=127),AlphaSynth.Util.Tables.SemitoneTable(127+e)*AlphaSynth.Util.Tables.CentTable(100+t)},AlphaSynth.Synthesis.SynthEvent=function(t){this.Event=null,this.IsMetronome=!1,this.Delta=0,this.Event=t},AlphaSynth.Synthesis.SynthEvent.NewMetronomeEvent=function(t){var e=new AlphaSynth.Synthesis.SynthEvent(null);return e.IsMetronome=!0,e},AlphaSynth.Synthesis.Synthesizer=function(t,e,n,a,i){this._voiceManager=null,this._synthChannels=null,this._layerList=null,this._midiEventQueue=null,this._midiEventCounts=null,this._metronomeChannel=0,this._mutedChannels=null,this._soloChannels=null,this._isAnySolo=!1,this._syn=0,this.MidiEventProcessed=null,this.MicroBufferSize=0,this.MicroBufferCount=0,this.SampleBuffer=null,this.SoundBank=null,this.SampleRate=0,this.MasterVolume=0;this.MasterVolume=1,this.SampleRate=AlphaSynth.Synthesis.SynthHelper.ClampI(t,8e3,96e3),this.MicroBufferSize=AlphaSynth.Synthesis.SynthHelper.ClampI(n,.001*t|0,.05*t|0),this.MicroBufferSize=64*Math.ceil(this.MicroBufferSize/64)|0,this.MicroBufferCount=Math.max(1,a),this.SampleBuffer=new Float32Array(this.MicroBufferSize*this.MicroBufferCount*e),this._synthChannels=new Array(17);for(var h=0;h<this._synthChannels.length;h++)this._synthChannels[h]=new AlphaSynth.Synthesis.SynthParameters(this);this._metronomeChannel=this._synthChannels.length-1,this._voiceManager=new AlphaSynth.Synthesis.VoiceManager(AlphaSynth.Synthesis.SynthHelper.ClampI(i,5,250)),this._midiEventQueue=new AlphaSynth.Ds.LinkedList,this._midiEventCounts=new Int32Array(this.MicroBufferCount),this._layerList=new Array(15),this._mutedChannels={},this._soloChannels={},this.ResetSynthControls()},AlphaSynth.Synthesis.Synthesizer.prototype={get_MetronomeVolume:function(){return this._synthChannels[this._metronomeChannel].MixVolume},set_MetronomeVolume:function(t){this._synthChannels[this._metronomeChannel].MixVolume=t},LoadBank:function(t){this.UnloadBank(),this.SoundBank=t},UnloadBank:function(){null!=this.SoundBank&&(this.NoteOffAll(!0),this._voiceManager.UnloadPatches(),this.SoundBank=null)},ResetSynthControls:function(){for(var t=0,e=this._synthChannels,n=e.length,a=e[t];t<n;t++,a=e[t])a.ResetControllers();this._synthChannels[9].BankSelect=128,this.ReleaseAllHoldPedals(),this._synthChannels[this._metronomeChannel].Volume.set_Coarse(128),this._synthChannels[this._metronomeChannel].UpdateCurrentVolumeFromVolume(),this._synthChannels[this._metronomeChannel].BankSelect=128},ResetPrograms:function(){for(var t=0,e=this._synthChannels,n=e.length,a=e[t];t<n;t++,a=e[t])a.Program=0},Synthesize:function(){this.SampleBuffer=new Float32Array(this.SampleBuffer.length),this.FillWorkingBuffer()},FillWorkingBuffer:function(){for(var t=0,e=this._isAnySolo,n=0;n<this.MicroBufferCount;n++){if(this._midiEventQueue.Length>0)for(var a=0;a<this._midiEventCounts[n];a++){var i=this._midiEventQueue.RemoveLast();i.IsMetronome?(this.NoteOff(this._metronomeChannel,37),this.NoteOn(this._metronomeChannel,37,95)):this.ProcessMidiMessage(i.Event)}for(var h=this._voiceManager.ActiveVoices.First;null!=h;){var s=h.Value.VoiceParams.Channel,o=this._mutedChannels.hasOwnProperty(s)||e&&!this._soloChannels.hasOwnProperty(s);if(h.Value.Process(t,t+2*this.MicroBufferSize,o),h.Value.VoiceParams.State==AlphaSynth.Synthesis.VoiceStateEnum.Stopped){var r=h;h=h.get_Next(),this._voiceManager.RemoveVoiceFromRegistry(r.Value),this._voiceManager.ActiveVoices.Remove(r),this._voiceManager.FreeVoices.AddFirst(r.Value)}else h=h.get_Next()}t+=2*this.MicroBufferSize}AlphaSynth.Platform.TypeUtils.ClearIntArray(this._midiEventCounts)},NoteOn:function(t,e,n){var a=this._synthChannels[t],i=this.SoundBank.GetPatchByNumber(a.BankSelect,a.Program);if(null!=i){var h;if(h=i.FindPatches(t,e,n,this._layerList),null!=this._voiceManager.Registry[t][e]){for(r=this._voiceManager.Registry[t][e];null!=r;)r.Value.Stop(),r=r.Next;this._voiceManager.RemoveFromRegistry(t,e)}for(p=0;p<h;p++){for(var s=!0,o=p-1;o>=0;o--)if(this._layerList[p].ExclusiveGroupTarget==this._layerList[o].ExclusiveGroupTarget){s=!1;break}if(0!=this._layerList[p].ExclusiveGroupTarget&&s)for(var r=this._voiceManager.ActiveVoices.First;null!=r;)this._layerList[p].ExclusiveGroupTarget==r.Value.Patch.ExclusiveGroup&&(r.Value.Stop(),this._voiceManager.RemoveVoiceFromRegistry(r.Value)),r=r.get_Next()}for(p=0;p<h;p++){var l=this._voiceManager.GetFreeVoice();if(null==l)break;l.Configure(t,e,n,this._layerList[p],this._synthChannels[t]),this._voiceManager.AddToRegistry(l),this._voiceManager.ActiveVoices.AddLast(l),l.Start()}for(var p=0;p<h;p++)this._layerList[p]=null}},NoteOff:function(t,e){if(this._synthChannels[t].HoldPedal)for(n=this._voiceManager.Registry[t][e];null!=n;)n.Value.VoiceParams.NoteOffPending=!0,n=n.Next;else{for(var n=this._voiceManager.Registry[t][e];null!=n;)n.Value.Stop(),n=n.Next;this._voiceManager.RemoveFromRegistry(t,e)}},NoteOffAll:function(t){var e=this._voiceManager.ActiveVoices.First;if(t)for(this._voiceManager.ClearRegistry();null!=e;){e.Value.StopImmediately();var n=e;e=e.get_Next(),this._voiceManager.ActiveVoices.Remove(n),this._voiceManager.FreeVoices.AddFirst(n.Value)}else for(;null!=e;){var a=e.Value.VoiceParams;a.State==AlphaSynth.Synthesis.VoiceStateEnum.Playing&&(this._synthChannels[a.Channel].HoldPedal?a.NoteOffPending=!0:(e.Value.Stop(),this._voiceManager.RemoveVoiceFromRegistry(e.Value))),e=e.get_Next()}},NoteOffAllChannel:function(t,e){for(var n=this._voiceManager.ActiveVoices.First;null!=n;)if(t==n.Value.VoiceParams.Channel)if(e){n.Value.StopImmediately();var a=n;n=n.get_Next(),this._voiceManager.ActiveVoices.Remove(a),this._voiceManager.FreeVoices.AddFirst(a.Value)}else this._synthChannels[t].HoldPedal?n.Value.VoiceParams.NoteOffPending=!0:n.Value.Stop(),n=n.get_Next()},ProcessMidiMessage:function(t){var e=t.get_Command(),n=t.get_Channel(),a=t.get_Data1(),i=t.get_Data2();switch(e){case AlphaSynth.Midi.Event.MidiEventTypeEnum.NoteOff:this.NoteOff(n,a);break;case AlphaSynth.Midi.Event.MidiEventTypeEnum.NoteOn:0==i?this.NoteOff(n,a):this.NoteOn(n,a,i);break;case AlphaSynth.Midi.Event.MidiEventTypeEnum.NoteAftertouch:break;case AlphaSynth.Midi.Event.MidiEventTypeEnum.Controller:switch(a){case AlphaSynth.Midi.Event.ControllerTypeEnum.BankSelectCoarse:9==n&&(i+=128),this.SoundBank.IsBankLoaded(i)?this._synthChannels[n].BankSelect=i:this._synthChannels[n].BankSelect=9==n?128:0;break;case AlphaSynth.Midi.Event.ControllerTypeEnum.ModulationCoarse:this._synthChannels[n].ModRange.set_Coarse(i),this._synthChannels[n].UpdateCurrentMod();break;case AlphaSynth.Midi.Event.ControllerTypeEnum.ModulationFine:this._synthChannels[n].ModRange.set_Fine(i),this._synthChannels[n].UpdateCurrentMod();break;case AlphaSynth.Midi.Event.ControllerTypeEnum.VolumeCoarse:this._synthChannels[n].Volume.set_Coarse(i),this._synthChannels[n].UpdateCurrentVolumeFromVolume();break;case AlphaSynth.Midi.Event.ControllerTypeEnum.VolumeFine:this._synthChannels[n].Volume.set_Fine(i),this._synthChannels[n].UpdateCurrentVolumeFromVolume();break;case AlphaSynth.Midi.Event.ControllerTypeEnum.PanCoarse:this._synthChannels[n].Pan.set_Coarse(i),this._synthChannels[n].UpdateCurrentPan();break;case AlphaSynth.Midi.Event.ControllerTypeEnum.PanFine:this._synthChannels[n].Pan.set_Fine(i),this._synthChannels[n].UpdateCurrentPan();break;case AlphaSynth.Midi.Event.ControllerTypeEnum.ExpressionControllerCoarse:this._synthChannels[n].Expression.set_Coarse(i),this._synthChannels[n].UpdateCurrentVolumeFromExpression();break;case AlphaSynth.Midi.Event.ControllerTypeEnum.ExpressionControllerFine:this._synthChannels[n].Expression.set_Fine(i),this._synthChannels[n].UpdateCurrentVolumeFromExpression();break;case AlphaSynth.Midi.Event.ControllerTypeEnum.HoldPedal:!this._synthChannels[n].HoldPedal||i>63||this.ReleaseHoldPedal(n),this._synthChannels[n].HoldPedal=i>63;break;case AlphaSynth.Midi.Event.ControllerTypeEnum.LegatoPedal:this._synthChannels[n].LegatoPedal=i>63;break;case AlphaSynth.Midi.Event.ControllerTypeEnum.NonRegisteredParameterCourse:case AlphaSynth.Midi.Event.ControllerTypeEnum.NonRegisteredParameterFine:this._synthChannels[n].Rpn.set_Combined(16383);break;case AlphaSynth.Midi.Event.ControllerTypeEnum.RegisteredParameterCourse:this._synthChannels[n].Rpn.set_Coarse(i);break;case AlphaSynth.Midi.Event.ControllerTypeEnum.RegisteredParameterFine:this._synthChannels[n].Rpn.set_Fine(i);break;case AlphaSynth.Midi.Event.ControllerTypeEnum.AllNotesOff:this.NoteOffAll(!1);break;case AlphaSynth.Midi.Event.ControllerTypeEnum.DataEntryCoarse:switch(this._synthChannels[n].Rpn.get_Combined()){case 0:this._synthChannels[n].PitchBendRangeCoarse=i,this._synthChannels[n].UpdateCurrentPitch();break;case 1:this._synthChannels[n].MasterFineTune.set_Coarse(i);break;case 2:this._synthChannels[n].MasterCoarseTune=i-64|0}break;case AlphaSynth.Midi.Event.ControllerTypeEnum.DataEntryFine:switch(this._synthChannels[n].Rpn.get_Combined()){case 0:this._synthChannels[n].PitchBendRangeFine=i,this._synthChannels[n].UpdateCurrentPitch();break;case 1:this._synthChannels[n].MasterFineTune.set_Fine(i)}break;case AlphaSynth.Midi.Event.ControllerTypeEnum.ResetControllers:this._synthChannels[n].Expression.set_Combined(16383),this._synthChannels[n].ModRange.set_Combined(0),this._synthChannels[n].HoldPedal&&this.ReleaseHoldPedal(n),this._synthChannels[n].HoldPedal=!1,this._synthChannels[n].LegatoPedal=!1,this._synthChannels[n].Rpn.set_Combined(16383),this._synthChannels[n].PitchBend.set_Combined(8192),this._synthChannels[n].ChannelAfterTouch=0,this._synthChannels[n].UpdateCurrentPitch(),this._synthChannels[n].UpdateCurrentVolumeFromExpression();break;default:return}break;case AlphaSynth.Midi.Event.MidiEventTypeEnum.ProgramChange:this._synthChannels[n].Program=a;break;case AlphaSynth.Midi.Event.MidiEventTypeEnum.ChannelAftertouch:this._synthChannels[n].ChannelAfterTouch=i;break;case AlphaSynth.Midi.Event.MidiEventTypeEnum.PitchBend:this._synthChannels[n].PitchBend.set_Coarse(i),this._synthChannels[n].PitchBend.set_Fine(a),this._synthChannels[n].UpdateCurrentPitch()}this.OnMidiEventProcessed(t)},add_MidiEventProcessed:function(t){this.MidiEventProcessed=$CombineDelegates(this.MidiEventProcessed,t)},remove_MidiEventProcessed:function(t){this.MidiEventProcessed=$RemoveDelegate(this.MidiEventProcessed,t)},OnMidiEventProcessed:function(t){var e=this.MidiEventProcessed;null!=e&&e(t)},ReleaseAllHoldPedals:function(){for(var t=this._voiceManager.ActiveVoices.First;null!=t;)t.Value.VoiceParams.NoteOffPending&&(t.Value.Stop(),this._voiceManager.RemoveVoiceFromRegistry(t.Value)),t=t.get_Next()},ReleaseHoldPedal:function(t){for(var e=this._voiceManager.ActiveVoices.First;null!=e;)e.Value.VoiceParams.Channel==t&&e.Value.VoiceParams.NoteOffPending&&(e.Value.Stop(),this._voiceManager.RemoveVoiceFromRegistry(e.Value)),e=e.get_Next()},DispatchEvent:function(t,e){this._midiEventQueue.AddFirst(e),this._midiEventCounts[t]++},SetChannelMute:function(t,e){e?this._mutedChannels[t]=!0:delete this._mutedChannels[t]},ResetChannelStates:function(){this._mutedChannels={},this._soloChannels={},this._isAnySolo=!1},SetChannelSolo:function(t,e){e?this._soloChannels[t]=!0:delete this._soloChannels[t],this._isAnySolo=Object.keys(this._soloChannels).length>0},SetChannelProgram:function(t,e){t<0||t>=this._synthChannels.length||(this._synthChannels[t].Program=e)},SetChannelVolume:function(t,e){t<0||t>=this._synthChannels.length||(this._synthChannels[t].MixVolume=e)}},AlphaSynth.Util.PcmData=function(t,e,n){this.Data=null,this.Length=0,this.BytesPerSample=0,this.BytesPerSample=t/8|0,this.Data=e,this.Length=this.Data.length/this.BytesPerSample|0,AlphaSynth.Platform.TypeUtils.IsLittleEndian!=n&&AlphaSynth.Util.WaveHelper.SwapEndianess(this.Data,t)},AlphaSynth.Util.PcmData.prototype={get_BitsPerSample:function(){return 8*this.BytesPerSample}},AlphaSynth.Util.PcmData.Create=function(t,e,n){switch(t){case 8:return new AlphaSynth.Util.PcmData8Bit(t,e,n);case 16:return new AlphaSynth.Util.PcmData16Bit(t,e,n);case 24:return new AlphaSynth.Util.PcmData24Bit(t,e,n);case 32:return new AlphaSynth.Util.PcmData32Bit(t,e,n);default:throw $CreateException(new System.Exception.ctor$$String("Invalid PCM format. "+t+"bit pcm data is not supported."),new Error)}},AlphaSynth.Util.PcmData8Bit=function(t,e,n){AlphaSynth.Util.PcmData.call(this,t,e,n)},AlphaSynth.Util.PcmData8Bit.prototype={get_Item:function(t){return this.Data[t]/255*2-1}},$Inherit(AlphaSynth.Util.PcmData8Bit,AlphaSynth.Util.PcmData),AlphaSynth.Util.PcmData16Bit=function(t,e,n){AlphaSynth.Util.PcmData.call(this,t,e,n)},AlphaSynth.Util.PcmData16Bit.prototype={get_Item:function(t){return t*=2,((this.Data[t]|this.Data[t+1]<<8)<<16>>16)/32768}},$Inherit(AlphaSynth.Util.PcmData16Bit,AlphaSynth.Util.PcmData),AlphaSynth.Util.PcmData24Bit=function(t,e,n){AlphaSynth.Util.PcmData.call(this,t,e,n)},AlphaSynth.Util.PcmData24Bit.prototype={get_Item:function(t){return t*=3,((this.Data[t]|this.Data[t+1]<<8|this.Data[t+2]<<16)<<12>>12)/8388608}},$Inherit(AlphaSynth.Util.PcmData24Bit,AlphaSynth.Util.PcmData),AlphaSynth.Util.PcmData32Bit=function(t,e,n){AlphaSynth.Util.PcmData.call(this,t,e,n)},AlphaSynth.Util.PcmData32Bit.prototype={get_Item:function(t){return t*=4,(this.Data[t]|this.Data[t+1]<<8|this.Data[t+2]<<16|this.Data[t+3]<<24)/2147484e3}},$Inherit(AlphaSynth.Util.PcmData32Bit,AlphaSynth.Util.PcmData),AlphaSynth.Util.Tables=function(){},$StaticConstructor(function(){AlphaSynth.Util.Tables._isInitialized=!1,AlphaSynth.Util.Tables._envelopeTables=null,AlphaSynth.Util.Tables._semitoneTable=null,AlphaSynth.Util.Tables._centTable=null,AlphaSynth.Util.Tables._sincTable=null}),AlphaSynth.Util.Tables.EnvelopeTables=function(t){return AlphaSynth.Util.Tables._isInitialized||AlphaSynth.Util.Tables.Init(),AlphaSynth.Util.Tables._envelopeTables[t]},AlphaSynth.Util.Tables.SemitoneTable=function(t){return AlphaSynth.Util.Tables._isInitialized||AlphaSynth.Util.Tables.Init(),AlphaSynth.Util.Tables._semitoneTable[t]},AlphaSynth.Util.Tables.CentTable=function(t){return AlphaSynth.Util.Tables._isInitialized||AlphaSynth.Util.Tables.Init(),AlphaSynth.Util.Tables._centTable[t]},AlphaSynth.Util.Tables.SincTable=function(t){return AlphaSynth.Util.Tables._isInitialized||AlphaSynth.Util.Tables.Init(),AlphaSynth.Util.Tables._sincTable[t]},AlphaSynth.Util.Tables.Init=function(){AlphaSynth.Util.Tables._envelopeTables=new Array(4),AlphaSynth.Util.Tables._envelopeTables[0]=AlphaSynth.Util.Tables.RemoveDenormals(AlphaSynth.Util.Tables.CreateSustainTable(64)),AlphaSynth.Util.Tables._envelopeTables[1]=AlphaSynth.Util.Tables.RemoveDenormals(AlphaSynth.Util.Tables.CreateLinearTable(64)),AlphaSynth.Util.Tables._envelopeTables[2]=AlphaSynth.Util.Tables.RemoveDenormals(AlphaSynth.Util.Tables.CreateExponentialTable(64,.09)),AlphaSynth.Util.Tables._envelopeTables[3]=AlphaSynth.Util.Tables.RemoveDenormals(AlphaSynth.Util.Tables.CreateSineTable(64)),AlphaSynth.Util.Tables._centTable=AlphaSynth.Util.Tables.CreateCentTable(),AlphaSynth.Util.Tables._semitoneTable=AlphaSynth.Util.Tables.CreateSemitoneTable(),AlphaSynth.Util.Tables._sincTable=AlphaSynth.Util.Tables.CreateSincTable(16,64,.43,AlphaSynth.Util.Tables.HammingWindow),AlphaSynth.Util.Tables._isInitialized=!0},AlphaSynth.Util.Tables.CreateSquareTable=function(t,e){for(var n=new Float32Array(t),a=1/t,i=0,h=0;h<t;h++){for(var s=0,o=1;o<e+1;o++){var r=2*o-1;s+=Math.sin(6.28318530717958*r*i)/r}n[h]=AlphaSynth.Synthesis.SynthHelper.ClampF(1.27323954473516*s,-1,1),i+=a}return n},AlphaSynth.Util.Tables.CreateCentTable=function(){for(var t=new Float32Array(201),e=0;e<t.length;e++)t[e]=Math.pow(2,(e-100)/1200);return t},AlphaSynth.Util.Tables.CreateSemitoneTable=function(){for(var t=new Float32Array(255),e=0;e<t.length;e++)t[e]=Math.pow(2,(e-127)/12);return t},AlphaSynth.Util.Tables.CreateSustainTable=function(t){for(var e=new Float32Array(t),n=0;n<t;n++)e[n]=1;return e},AlphaSynth.Util.Tables.CreateLinearTable=function(t){for(var e=new Float32Array(t),n=0;n<t;n++)e[n]=n/(t-1);return e},AlphaSynth.Util.Tables.CreateExponentialTable=function(t,e){e=AlphaSynth.Synthesis.SynthHelper.ClampF(e,.001,.9);for(var n=new Float32Array(t),a=0,i=0;i<t;i++)n[i]=a,a+=e*(1.58730158730159-a);for(i=0;i<t;i++)n[i]=n[i]/n[n.length-1];return n},AlphaSynth.Util.Tables.CreateSineTable=function(t){for(var e=new Float32Array(t),n=4.712389/(t-1),a=0,i=0;i<t;i++)e[i]=Math.abs(Math.sin(a)),a+=n;return e},AlphaSynth.Util.Tables.RemoveDenormals=function(t){for(var e=0;e<t.length;e++)Math.abs(t[e])<1e-38&&(t[e]=0);return t},AlphaSynth.Util.Tables.VonHannWindow=function(t,e){return.5-.5*Math.cos(6.28318530717958*(.5+t/e))},AlphaSynth.Util.Tables.HammingWindow=function(t,e){return.54-.46*Math.cos(6.28318530717958*t/e)},AlphaSynth.Util.Tables.BlackmanWindow=function(t,e){return.42659-.49656*Math.cos(6.28318530717958*t/e)+.076849*Math.cos(12.5663706143592*t/e)},AlphaSynth.Util.Tables.CreateSincTable=function(t,e,n,a){for(var i=1+(t/2|0),h=new Float32Array(i*e),s=2*n,o=0;o<i;o++)for(var r=0;r<e;r++){var l=o+r/e,p=6.28318530717958*n*l;p=Math.abs(p)>1e-5?Math.sin(p)/p:1,h[64*o+r]=s*p*a(l,t)}return h},AlphaSynth.Util.SynthConstants=function(){},$StaticConstructor(function(){AlphaSynth.Util.SynthConstants.InterpolationMode=AlphaSynth.Bank.Components.Generators.Interpolation.Linear,AlphaSynth.Util.SynthConstants.AudioChannels=2,AlphaSynth.Util.SynthConstants.Pi=3.14159265358979,AlphaSynth.Util.SynthConstants.TwoPi=6.28318530717958,AlphaSynth.Util.SynthConstants.HalfPi=1.5707963267949,AlphaSynth.Util.SynthConstants.InverseSqrtOfTwo=.707106781186,AlphaSynth.Util.SynthConstants.DefaultLfoFrequency=8,AlphaSynth.Util.SynthConstants.DefaultModDepth=100,AlphaSynth.Util.SynthConstants.DefaultPolyphony=40,AlphaSynth.Util.SynthConstants.MinPolyphony=5,AlphaSynth.Util.SynthConstants.MaxPolyphony=250,AlphaSynth.Util.SynthConstants.DefaultBlockSize=64,AlphaSynth.Util.SynthConstants.MaxBufferSize=.05,AlphaSynth.Util.SynthConstants.MinBufferSize=.001,AlphaSynth.Util.SynthConstants.DenormLimit=1e-38,AlphaSynth.Util.SynthConstants.NonAudible=1e-5,AlphaSynth.Util.SynthConstants.SincWidth=16,AlphaSynth.Util.SynthConstants.SincResolution=64,AlphaSynth.Util.SynthConstants.MaxVoiceComponents=4,AlphaSynth.Util.SynthConstants.DefaultChannelCount=17,AlphaSynth.Util.SynthConstants.DefaultKeyCount=128,AlphaSynth.Util.SynthConstants.DefaultMixGain=.35,AlphaSynth.Util.SynthConstants.MinVolume=0,AlphaSynth.Util.SynthConstants.MaxVolume=10,AlphaSynth.Util.SynthConstants.MinProgram=0,AlphaSynth.Util.SynthConstants.MaxProgram=127,AlphaSynth.Util.SynthConstants.MinPlaybackSpeed=.125,AlphaSynth.Util.SynthConstants.MaxPlaybackSpeed=8}),AlphaSynth.Util.IOHelper=function(){},AlphaSynth.Util.IOHelper.ReadInt32LE=function(t){var e=t.ReadByte(),n=t.ReadByte(),a=t.ReadByte();return t.ReadByte()<<24|a<<16|n<<8|e<<0},AlphaSynth.Util.IOHelper.ReadUInt16LE=function(t){var e=t.ReadByte();return t.ReadByte()<<8|e<<0&65535},AlphaSynth.Util.IOHelper.ReadInt16LE=function(t){var e=t.ReadByte(),n=t.ReadByte();return AlphaSynth.Platform.TypeUtils.ToInt16(n<<8|e<<0)},AlphaSynth.Util.IOHelper.ReadInt32BE=function(t){return t.ReadByte()<<24|t.ReadByte()<<16|t.ReadByte()<<8|t.ReadByte()<<0},AlphaSynth.Util.IOHelper.ReadUInt16BE=function(t){return t.ReadByte()<<8|t.ReadByte()<<0&65535},AlphaSynth.Util.IOHelper.ReadInt16BE=function(t){var e=t.ReadByte(),n=t.ReadByte();return AlphaSynth.Platform.TypeUtils.ToInt16(e<<8|n<<0)},AlphaSynth.Util.IOHelper.ReadByteArray=function(t,e){var n=new Uint8Array(e);return t.Read(n,0,e),n},AlphaSynth.Util.IOHelper.Read8BitChars=function(t,e){for(var n=new Array,a=0;a<e;a++)n.push(String.fromCharCode(t.ReadByte()));return n.join("")},AlphaSynth.Util.IOHelper.Read8BitString=function(t){for(var e=new Array,n=t.ReadByte();0!=n;)e.push(String.fromCharCode(n)),n=t.ReadByte();return e.join("")},AlphaSynth.Util.IOHelper.Read8BitStringLength=function(t,e){for(var n=new Array,a=-1,i=0;i<e;i++){var h=t.ReadByte();0==h&&-1==a&&(a=i),n.push(String.fromCharCode(h))}var s=n.join("");return a>=0?s.substr(0,a):s},AlphaSynth.Util.IOHelper.ReadSInt8=function(t){var e=t.ReadByte();return-256*((255&e)>>7)+(255&e)},AlphaSynth.Util.IOHelper.ReadUInt32=function(t){return t.ReadByte()<<24|t.ReadByte()<<16|t.ReadByte()<<8|t.ReadByte()<<0},AlphaSynth.Util.IOHelper.ReadInt24=function(t,e){var n;return AlphaSynth.Platform.TypeUtils.IsLittleEndian?8388608==(8388608&(n=t[e]|t[e+1]<<8|t[e+2]<<16))&&(n|=-16777216):256==(256&(n=t[e]<<16|t[e+1]<<8|t[e+2]))&&(n|=255),n},AlphaSynth.Util.IOHelper.ReadInt16=function(t,e){return AlphaSynth.Platform.TypeUtils.IsLittleEndian?AlphaSynth.Platform.TypeUtils.ToInt16(t[e]|t[e+1]<<8):AlphaSynth.Platform.TypeUtils.ToInt16(t[e]<<8|t[e+1])},AlphaSynth.Util.WaveHelper=function(){},AlphaSynth.Util.WaveHelper.SwapEndianess=function(t,e){for(var n=new Uint8Array(e/=8),a=0;a<t.length;a+=e)n.set(t.subarray(a,a+e),0),AlphaSynth.Platform.Std.Reverse(n),t.set(n.subarray(0,0+e),a)};for(var i=0;i<$StaticConstructors.length;i++)$StaticConstructors[i]();